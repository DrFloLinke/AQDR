<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Data Visualization |  Analysing Quantitative Data with R  </title>
<meta name="generator" content="bookdown 0.43 with bs4_book()">
<meta property="og:title" content="7 Data Visualization |  Analysing Quantitative Data with R  ">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Data Visualization |  Analysing Quantitative Data with R  ">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lexend-0.4.10/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.9.0/transition.js"></script><script src="libs/bs3compat-0.9.0/tabs.js"></script><script src="libs/bs3compat-0.9.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/font-awesome-6.7.2/js/script.js"></script><link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding-0.33/datatables.js"></script><link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="Chapter script Chapter markdown  7.1 Content The final chapter in this part focuses on data visualization. While some techniques for presenting data were already described in the chapter on...">
<meta property="og:description" content="Chapter script Chapter markdown  7.1 Content The final chapter in this part focuses on data visualization. While some techniques for presenting data were already described in the chapter on...">
<meta name="twitter:description" content="Chapter script Chapter markdown  7.1 Content The final chapter in this part focuses on data visualization. While some techniques for presenting data were already described in the chapter on...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title=""><p><img src="images/Crest_white.png" width="75" style="display:block; margin:auto; margin-bottom:3em;"> Analysing Quantitative Data with R <br></p></a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="accessibility.html">Accessibility</a></li>
<li class="book-part">THE BASICS</li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="basics.html"><span class="header-section-number">2</span> Basics of R Programming</a></li>
<li><a class="" href="datastructures.html"><span class="header-section-number">3</span> Data structures</a></li>
<li><a class="" href="exploratory.html"><span class="header-section-number">4</span> Exploratory Data Analysis</a></li>
<li class="book-part">ADVANCED DATA MANIPULATION</li>
<li><a class="" href="programming.html"><span class="header-section-number">5</span> Key Programming Concepts</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">6</span> Data Manipulation</a></li>
<li><a class="active" href="visualization.html"><span class="header-section-number">7</span> Data Visualization</a></li>
<li class="book-part">DATA ANALYSIS</li>
<li><a class="" href="association.html"><span class="header-section-number">8</span> Statistical Inference and Association</a></li>
<li><a class="" href="ols.html"><span class="header-section-number">9</span> Linear Regression</a></li>
<li><a class="" href="logit.html"><span class="header-section-number">10</span> Logistic Regression</a></li>
<li class="book-part">ADVANCED TOPICS</li>
<li><a class="" href="rmarkdown.html"><span class="header-section-number">11</span> R Markdown</a></li>
<li><a class="" href="course-summary.html"><span class="header-section-number">12</span> Course summary</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><script src="sidebar-link.js"></script><div id="visualization" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Data Visualization<a class="anchor" aria-label="anchor" href="#visualization"><i class="fas fa-link"></i></a>
</h1>
<button class="btn btn-default" onclick="
    async function downloadFile(event) {
      event.preventDefault();
      try {
        const response = await fetch('data:text/plain;base64,IycgIyBEYXRhIFZpc3VhbGl6YXRpb24gCgojJyAKIycgCiMnIAojJyAKIycgIyMgQ29udGVudAojJyAKIycgVGhlIGZpbmFsIGNoYXB0ZXIgaW4gdGhpcyBwYXJ0IGZvY3VzZXMgb24gZGF0YSB2aXN1YWxpemF0aW9uLiBXaGlsZSBzb21lIHRlY2huaXF1ZXMgZm9yIHByZXNlbnRpbmcgZGF0YSB3ZXJlIGFscmVhZHkgZGVzY3JpYmVkIGluIHRoZSBjaGFwdGVyIG9uIFtFeHBsb3JhdG9yeSBkYXRhIGFuYWx5c2lzXSgjZXhwbG9yYXRvcnkpLCB0aGlzIGNoYXB0ZXIgd2lsbCBjb3ZlciB0aGUgdG9waWMgaW4gbW9yZSBkZXB0aCBhbmQgaW50cm9kdWNlIHlvdSB0byB0aGUgbW9zdCBjb21tb25seSB1c2VkIHRvb2wgZm9yIGRhdGEgdmlzdWFsaXphdGlvbiBpbiBSIC0gdGhlIGBnZ3Bsb3QyYCBwYWNrYWdlLiBUaGUgbWFpbiBhZHZhbnRhZ2Ugb2YgYGdncGxvdDJgIGluIGNvbXBhcmlzb24gd2l0aCBzb21lIG9mIHRoZSBvdXQtb2YtdGhlLWJveCBwbG90dGluZyBjYXBhYmlsaXRpZXMgY29taW5nIHdpdGggUiBpcyB0aGUgc2ltcGxpY2l0eSBvZiBjcmVhdGluZyByZWxhdGl2ZWx5IGNvbXBsZXggYW5kIG5pY2UgbG9va2luZyBwbG90LCB3aGljaCB3b3VsZCBvZnRlbiB0YWtlIG11Y2ggbG9uZ2VyIHRvIHByb2R1Y2Ugd2l0aCBSIGJhc2UgZ3JhcGhpY3MuIAojJyAKIycgVGhlIGBnZ3Bsb3QyYCBwYWNrYWdlIGlzIGEgcGFydCBvZiBgdGlkeXZlcnNlYCwgd2hpY2ggd2FzIGludHJvZHVjZWQgaW4gdGhlIFtwcmV2aW91cyBjaGFwdGVyXSgjZHBseXIpLCBhbmQgaXQgaXMgb2Z0ZW4gdXNlZnVsIGluIGNvbmp1bmN0aW9uIHdpdGggc29tZSBvZiB0aGUgZGF0YSBtYW5pcHVsYXRpb24gdG9vbHMgb2ZmZXJlZCBieSBvdGhlciBgdGlkeXZlcnNlYCBwYWNrYWdlcy4gWW91IGNhbiBsb2FkIHRoZSBsaWJyYXJ5IGRpcmVjdGx5OgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmxpYnJhcnkoZ2dwbG90MikKCiMnIAojJyBIb3dldmVyIHlvdSBtYXkgYWxzbyBhdHRhY2ggaXQgYWxvbmcgd2l0aCBvdGhlciBgdGlkeXZlcnNlYCBwYWNrYWdlczoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsaWJyYXJ5KHRpZHl2ZXJzZSkKCiMnIAojJyBXZSB3aWxsIGFsc28gbG9hZCB0aGUgYHNhbGFyaWVzYCBkYXRhc2V0LCB3aGljaCBkZXNjcmliZXMgdGhlIHNhbGFyaWVzIG9mIFVTIHByb2Zlc3NvcnMuIFRvIGRvIHRoaXMsIHlvdSB3aWxsIG5lZWQgdG8gaW5zdGFsbCB0aGUgcGFja2FnZSB1c2luZyB0aGUgYGNhckRhdGFgIHBhY2thZ2UgdXNpbmcgdGhlIGBpbnN0YWxsLnBhY2thZ2VzYCBmdW5jdGlvbjoKIycgCiMnIAojJyAKIycgCiMnIFRvIGxvYWQgdGhlIGRhdGEsIHNpbXB5IGV4ZWN1dGUgdGhlIGJlbG93IGNvZGUuIFRoZSBkYXRhZnJhbWUgd2lsbCBiZSBhdHRhY2hlZCB0byB5b3VyIGdsb2JhbCBlbnZpcm9ubWVudC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpkYXRhKCdTYWxhcmllcycsIHBhY2thZ2UgPSAnY2FyRGF0YScpCmdsaW1wc2UoU2FsYXJpZXMpCgojJyAKIycgVGhlIGRhdGEgY29uc2lzdHMgb2YgNiB2YXJpYWJsZXMsIGRlc2NyaWJpbmcgYWNhZGVtaWNzIHJhbmssIGRpc2NpcGxpbmUgKEEgZm9yIHRoZW9yZXRpY2FsIGFuZCBCIGZvciBhcHBsaWVkKSwgZXhwZXJpZW5jZSBtZWFzdXJlZCBpbiB5ZWFycyBpbiBzZXJ2aWNlIGFuZCB5ZWFycyBzaW5jZSBQaEQgYXR0YWlubWVudCwgdGhlIHN1YmplY3RzIHNleCBhbmQgc2FsYXJ5LiBUbyBzZWUgbW9yZSBkZXRhaWxzIGFib3V0IHRoZSBkYXRhLCB1c2UgYD9jYXJEYXRhOjpTYWxhcmllc2AKIycgCiMnICMjIyBUaGUgcGxvdHRpbmcgc3ludGF4IAoKIycgCiMnIFNpbWlsYXJpbHkgdG8gdGhlIG90aGVyIGB0aWR5dmVyc2VgIHRvb2xzIGV4cGxvcmVkIGluIHRoZSBwcmV2aW91cyBjaGFwdGVyLCBnZ3Bsb3QgdXNlcyBpdHMgb3duLCBvcmlnaW5hbCBhcHByb2FjaCB0byBjcmVhdGluZyBwbG90cywgd2hpY2ggaXMgcXVpdGUgZGlmZmVyZW50IGZyb20gd2hhdCB5b3UgaGF2ZSBwcmV2aW91c2x5IGVuY291bmV0ZXJkIGluIHRoZSBleHBsb3JhdG9yeSBkYXRhIGFuYWx5c2lzIGxlc3Nvbi4gVG8gaW5pdGlhbGl6ZSBhIGdncGxvdCBvYmplY3QsIHlvdSBfYWx3YXlzXyBjYWxsIHRoZSBgZ2dwbG90YCBmdW5jdGlvbiwgc3BlY2lmeWluZyB0aGUgbmFtZSBvZiB5b3VyIGRhdGEgZnJhbWUgYXMgdGhlIGZpcnN0IGFyZ3VtZW50LgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcykKCiMnIAojJyBBcyB5b3UgY2FuIHNlZSB0aGlzIGluaXRpYXRlcyBhbiBlbXB0eSBwbG90LiBXZSB0aGVuIGZ1cmh0ZXIgc3BlY2lmeSB0aGUgdmFyaWFibGVzIHdlIHdhbnQgdG8gYXNzb2NpYXRlIHdpdGggdGhlIG9iamVjdCB1c2luZyB0aGUgYGFlcygpYCBmdW5jdGlvbi4gVGhlIGFlcyBhYmJyZXZpYXRpb24gc3RhbmRzIGZvciBhZXN0aGV0aWMgbWFwcGluZ3MuIEl0IGRlZmluZXMgYmluZGluZ3MgYmV0d2VlbiB2YXJpYWJsZXMgaW4gdGhlIGRhdGFmcmFtZSBzcGVjaWZpZWQgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IG9mIHRoZSBnZ3Bsb3Qgb2JqZWN0IGFuZCBhZXN0aGV0aWMgZWxlbWVudHMgb2YgdGhlIG9iamVjdCAtIGZvciBleGFtcGxlLCB0aGUgeCBhbmQgeSBheGVzIG9mIHRoZSBwbG90LCBsaW5lL3BvaW50IGNvbG9ycyBhbmQgc2hhcGVzIG9yIGJhciBmaWxscy4gRm9yIGV4YW1wbGUsIGBhZXMoeCA9IGFic2VuY2VzKWAgY2FuIGJlIGludGVycHJldGVkIGFzIF8ibGluayB0aGUgdmFyaWFibGUgYWJzZW5jZXMgd2l0aCB0aGUgeC1heGlzIG9mIHRoaXMgcGxvdCJfLiAKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkKCiMnIAojJyBOb3cgdGhlIGZpZ3VyZSBpbmNsdWRlcyBhbiB4IGF4aXMsIHdpdGggc29tZSBhdXRvbWF0aWNhbGx5IGNob3NlbiB0aWNrIGxvY2F0aW9ucy4gVGhlIGZpbmFsIHN0ZXAgaXMgdG8gY3JlYXRlIGFuIGFjdHVhbCBwbG90LiBUaGlzIGlzIGRvbmUgYnkgImFkZGluZyIgYSBzby1jYWxsZWQgX2dlb21fIHRvIHRoZSBwbG90IHNrZWxldG9uIHdlIGhhdmUgY3JlYXRlZCBzbyBmYXIuIEdlb21zIGFyZSBzaW1wbHkgZnVuY3Rpb25zIHVzZWQgdG8gY3JlYXRlIGRpZmZlcmVudCBwbG90IHR5cGVzIHJlcHJlc2VudGluZyB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggYSBnZ3Bsb3Qgb2JqZWN0IHRocm91Z2ggYGdncGxvdGAgYW5kIGBhZXNgIC0gZm9yIGV4YW1wbGUsIGBnZW9tX2hpc3RvZ3JhbWAgaXMgdXNlZCB0byBjcmVhdGUgYSBbaGlzdG9ncmFtXSgjaGlzdG9ncmFtcykgYW5kIGBnZW9tX2JveHBsb3RgIHRvIGNyZWF0ZSBhIFtib3hwbG90XSgjYm94cGxvdHMpLiBHZW9tcyBhcmUgImFkZGVkIiB0byB0aGUgYGdncGxvdGAgb2JqZWN0IHVzaW5nIHRoZSBgK2Agb3BlcmF0b3IuCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpICsgCiAgZ2VvbV9oaXN0b2dyYW0oKQoKIycgCiMnIFdlIGNhbiBzZWUgbm93IHRoYXQgdGhlIGhpc3RvZ3JhbSBvZiB0aGUgdmFyaWFibGUgYXBwZWFycyBvbiB0aGUgcGxvdC4gVGhlIHBsb3QgYWxzbyBjb21lcyB3aXRoIGEgbWVzc2FnZSBwcm9tcHRpbmcgdXMgdG8gbWFudWFsbHkgc3BlY2lmeSB0aGUgYmluIHdpZHRoIGZvciB0aGUgaGlzdG9ncmFtLCB3aGljaCBjYW4gYmUgZG9uZSB0aHJvdWdoIHRoZSBhcmd1bWVudHMgb2YgdGhlIGBnZW9tYCBmdW5jdGlvbiAtIGVpdGhlciBieSBzcGVjaWZ5aW5nIHRoZSBudW1iZXIgb2YgYmlucyB0aHJvdWdoIGBiaW5zYCBvciB0aGUgd2lkdGggb2YgaW5kaXZpZHVhbCBiaW5zIHRocm91Z2ggYGJpbndpZHRoYC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2hpc3RvZ3JhbShiaW5zID0gNDApCgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzYWxhcnkpKSArIAogIGdlb21faGlzdG9ncmFtKGJpbndpZHRoID0gNTAwMCkKCiMnIAojJyBXZSBjYW4gYWxzbyBjaGFuZ2UgdG8gY29sb3JzIG9mIHRoZSBiaW5zIGFzIHdlbGwgYXMgdGhlaXIgYm9yZGVyczoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2hpc3RvZ3JhbShiaW53aWR0aCA9IDUwMDAsIGZpbGwgPSAnYmx1ZScsIGNvbG9yID0gJ2JsYWNrJykKCiMnIAojJyBBcyBtZW50aW9uZWQgZWFybGllciwgdGhlIGFlc3RoZXRpYyBjaGFyYWN0ZXJpc3RpY3Mgb2YgdGhlIHBsb3Qgc3VjaCBhcyBib3JkZXIgY29sb3Igb3IgZmlsbCBjYW4gYmUgdHJlYXRlZCBhcyBhIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBkYXRhLCBub3Qgb25seSB0aGUgdmlzdWFsIGNoYXJhY3RlcmlzdGljcyBvZiB0aGUgcGxvdC4gRm9yIGV4YW1wbGUsIGNvbnRpbnVpbmcgd2l0aCB0aGUgYGFic2VuY2VzYCBleGFtcGxlIHdlIG1heSBzZWUgdGhlIGJyZWFrIG91ZiBvZiB0aGUgYWJzZW5jZXMgYmV0d2VlbiBtYWxlIGFuZCBmZW1hbGUgc3R1ZGVudHMsIGJ5IHNwZWNpZnlpbmcgdGhlIGBmaWxsYCBhcmd1bWVudCBpbiB0aGUgYWVzdGhldGljIG1hcHBpbmc6CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSwgZmlsbCA9IHNleCkpICsgCiAgZ2VvbV9oaXN0b2dyYW0oYmlud2lkdGggPSA1MDAwLCBjb2xvciA9ICdibGFjaycpCgojJyAKIycgVGhpcyBhbHNvIGF1dG9tYXRpY2FsbHkgYWRkcyBhIGxlZ2VuZCBvbiB0aGUgc2lkZSBvZiB0aGUgcGxvdC4gVGhlIGJsdWUgY29sb3IgcmVwcmVzZW50cyB0aGUgcHJvcG9ydGlvbiBvZiBlYWNoIGJpbiByZXByZXNlbnRlZCBieSBtYWxlIHN0dWRlbnRzIGFuZCB0aGUgcmVkIC0gYnkgZmVtYWxlIHN0dWRlbnRzLgojJyAKIycgQW4gaW1wb3J0YW50IHRoaW5nIHRvIG5vdGUgaXMgdGhhdCB0aGUgYWVzdGhldGljIG1hcHBpbmcgY3JlYXRlZCBieSB0aGUgYGFlcygpYCBmdW5jdGlvbiBjYW4gYmUgZGVmaW5lZCAgX2dsb2JhbGx5XyBpLmUuIGZvciB0aGUgZW50aXJlIGdncGxvdCBmaWd1cmUsIGFzIGluIHRoZSBjYXNlIGFib3ZlIChgZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpYCksIGFzIHdlbGwgYXMgYSBfbG9jYWxseV8sIGkuZS4gb25seSBmb3Igb25lIHNwZWNpZmljIGdlb20gKGBnZW9tX2hpc3RvZ3JhbShhZXMoeCA9IHNhbGFyeSlgKS4gSW4gdGhlIGZvcm1lciBjYXNlLCB0aGUgZW50aXJlIGZpZ3VyZSB3aWxsIHVzZSB0aGUgc2V0IGFlc3RoZXRpYyBtYXBwaW5nLCB3aGlsZSBpbiB0aGUgbGF0dGVyLCBpdCB3aWxsIGFwcGx5IG9ubHkgdG8gdGhlIHNwZWNpZmljIGdlb20uCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzKSArIAogIGdlb21faGlzdG9ncmFtKGFlcyh4ID0gc2FsYXJ5LCBmaWxsID0gc2V4KSwgYmlud2lkdGggPSA1MDAwLGNvbG9yID0gJ2JsYWNrJykKCiMnIAojJyBOb3RlIHRoYXQgdGhhdCBpbiB0aGlzIGNhc2UsIGJvdGggZ2xvYmFsIGFuZCBsb2NhbCBtYXBwaW5ncyBwcm9kdWNlIGV4YWN0bHkgdGhlIHNhbWUgb3V0cHV0LiBIb3dldmVyLCB3aGVuIGFkZGluZyBtdWx0aXBsZSBnZW9tIHN0cnVjdHVyZXMgdG8gb25lIHBsb3QsIGFzIHdlIHdpbGwgc2VlIGxhdGVyLCB1c2luZyBhIGdsb2JhbCB2cyBsb2NhbCBhZXN0aGV0aWMgbWFwcGluZyBjYW4gbGVhZCB0byB2ZXJ5IGRpZmZlcmVudCByZXN1bHRzLiAKIycgCiMnICMjIyBBbGwgYWJvdXQgZ2VvbXMgLSBwbG90IHR5cGVzIGluIGdncGxvdDIgCgojJyAKIycgSW4gdGhpcyBzZWN0aW9uLCB3ZSB3aWxsIGV4cGxvcmUgc29tZSBvZiB0aGUgYmFzaWMgcGxvdCB0eXBlcyAob3IgX2dlb21zXykgb2ZmZXJlZCBieSB0aGUgYGdncGxvdDJgIHBhY2thZ2UuIFRoZSBudW1iZXIgb2YgZ2VvbXMgYXZhaWxhYmxlIGlzIHZhc3QsIGFuZCB0aGlzIGlzbid0IGJ5IGFueSBtZWFucyBhbiBleGhhdXN0aXZlIGRpc2N1c3Npb24gb2YgdGhlIHRvcGljIC0geW91IGNhbiBmaW5kIHRoZSBmdWxsIGxpc3QgaW4gdGhlIGdncGxvdDIgW2NoZWF0c2hlZXRdKGh0dHBzOi8vZ2l0aHViLmNvbS9yc3R1ZGlvL2NoZWF0c2hlZXRzL2Jsb2IvbWFzdGVyL2RhdGEtdmlzdWFsaXphdGlvbi0yLjEucGRmKS4gRXZlbiBtb3JlIGNhbiBiZSBmb3VuZCB0aHJvdWdoIGV4dGVybmFsLCBnZ3Bsb3QtYmFzZWQgcGFja2FnZXMuIEhvd2V2ZXIsIGxlYXJuaW5nIHRoZSBiYXNpY3Mgb2YganVzdCBjb3VwbGUgb2YgdGhlbSBzaG91bGQgaGVscCB5b3UgZ2FpbiBhIHN1ZmZpY2llbnQgdW5kZXJzdGFuZGluZyBvZiBnZ3Bsb3QncyBwbG90dGluZyBwaGlsb3NvcGh5IHRvIGJlIGFibGUgdG8gZXhwbG9yZSB0aGUgcmVzdCBieSB5b3Vyc2VsZiBhbmQgdXNlIHRoZW0gd2hlbmV2ZXIgeW91IG5lZWQgdG8uIAojJyAKIycgIyMjIyBEZW5zaXR5IGVzdGltYXRlIAoKIycgCiMnIFRoZSBkZW5zaXR5IGVzdGltYXRlIGlzIGFuIGFsdGVybmF0aXZlIHdheSB0byBkcmF3IGEgaGlzdG9ncmFtIG9mIHRoZSBkYXRhLiBJdCByZXByZXNlbnRzIHRoZSBkaXN0cmlidXRpb24gb2YgYSBjb250aW5vdXMgdmFyaWFibGUgYnkgZHJhd2luZyBhIGxpbmUuIFlvdSBjYW4gc2VlIHRoYXQgdGhlIHNoYXBlIG9mIHRoZSBkZW5zaXR5IHBsb3Qgb2YgYGFic2VuY2VzYCBiZWxvdyBkaXJlY3RseSBjb3JyZXNwb25kcyB3aXRoIHRoZSBoaXN0b2dyYW0gb2YgdGhpcyB2YXJpYWJsZSBmcm9tIHRoZSBwcmV2aW91cyBleGFtcGxlLiAKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2RlbnNpdHkoKSAKCiMnIAojJyAKIycgS2VybmVsIGRlbnNpdHkgZXN0aW1hdGVzIGFyZSBwYXJ0aWN1bGFybHkgdXNlZnVsIHRvIGNvbXBhcmUgdGhlIGRpc3RyaWJ1dGlvbiBvZiBhIHZhcmlhYmxlIGJldHdlZW4gZGlmZmVyZW50IHZhbHVlcyBvZiBhIGdyb3VwaW5nIHZhcmlhYmxlLiBGb3IgZXhhbXBsZSwgd2UgY2FuIGV4YW1pbmUgdGhlIGRpZmZlcmVuY2UgaW4gdGhlIGRpc3RyaWJ1dGlvbnMgb2YgdGhlIHNhbGFyeSBkZXBlbmRpbmcgb24gdGhlIHBvc2l0aW9uIGhlbGQgYnkgdGhlIGluZGl2aWR1YWw6CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSwgZmlsbCA9IHJhbmspKSArIAogIGdlb21fZGVuc2l0eShhbHBoYSA9IDAuMykKCiMnIAojJyBUaGUgZGlmZmVyZW5jZXMgYXJlIGNsZWFyLWN1dCAtIGl0IGFwcGVhcnMgdGhhdCBhcyBleHBlY3RlZCwgaGlnaGVyIHBvc2l0aW9uIGhlbGQgZ2VuZXJhbGx5IGxlYWRzIHRvIGhpZ2hlciBtZWRpYW4gb2YgZWFybmluZ3MuIEhvd2V2ZXIsIGVhY2ggcG9zaXRpb24gYWxzbyBoYXMgaGlnaGVyIHZhcmlhYmlsaXR5IGluIGluY29tZSwgd2l0aCB0aGUgc3ByZWFkIG9mIFByb2Zlc3NvcnMgZWFybmluZ3MgbW9yZSB0aGFuIHR3aWNlIGFzIGxhcmdlIGFzIGZvciBBc3Npc3RhbnQgUHJvZmVzc29ycy4KIycgCiMnICMjIyMgQmFycGxvdHMgCgojJyAKIycgSGlzdG9ncmFtcyBhbmQga2VybmVsIGRlbnNpdHkgZXN0aW1hdGVzIGFyZSB1c2VmdWwgaW4gcmVwcmVzZW50aW5nIGNvbnRpbnVvdXMgdmFyaWFibGVzLCBzdWNoIGFzIHRlbXBlcmF0dXJlLCBHRFAgb3IgaG91cnMgb2YgYWJzZW5jZS4gSW4gY2FzZSBvZiBkaXNjcmV0ZSB2YXJpYWJsZXMsIHdoaWNoIG9ubHkgdGFrZSBhIGZpbml0ZSBhbmQgdW5vcmRlcmVkIHNldCBvZiB2YWx1ZXMsIGl0J3Mgb2Z0ZW4gYmV0dGVyIHRvIHVzZSBiYXIgcGxvdHMuIFdpdGggYGdncGxvdDJgLCB0aGVzZSBjYW4gYmUgZWFzaWx5IG9idGFpbmVkIHVzaW5nICBgZ2VvbV9iYXJgLiBGb3IgZXhhbXBsZSwgd2UgY2FuIHVzZSBpdCB0byByZXByZXNlbnQgdGhlIG9mIGFjYWRlbWljIHJhbmtzIHdpdGhpbiBvdXIgZGF0YXNldC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gcmFuaykpICsgCiAgZ2VvbV9iYXIod2lkdGggPSAwLjUsIGZpbGwgPSAnZm9yZXN0Z3JlZW4nKQoKIycgCiMnIFlvdSBtYXkgYWxzbyB3YW50IHRvIG1ha2UgdGhlIGJhciBwbG90cyBob3Jpem9udGFsLiBUaGVyZSBhcmUgdHdvIHdheXMgdG8gdG8gdGhpczogdGhlIG9sZCBhcHByb2FjaCBpcyBzaW1wbHkgdG8gYWRkIGBjb29yZF9mbGlwKClgIHRvIHlvdXIgYGdncGxvdGAgb2JqZWN0LiBZb3UgbWF5IHN0aWxsIGVuY291bnRlciB0aGlzIHdheSBvZiBwbG90dGluZyBob3Jpem9udGFsIGJhciBwbG90cyBpbiBvdGhlciB1c2VycyBjb2RlLgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSByYW5rKSkgKyAKICBnZW9tX2Jhcih3aWR0aCA9IDAuNSwgZmlsbCA9ICdmb3Jlc3RncmVlbicpICsKICBjb29yZF9mbGlwKCkKCiMnIAojJyBIb3dldmVyLCBzaW5jZSBgZ2dwbG90YCB2ZXJzaW9uIDMuMy4wLCBwcm92aWRpbmcgdGhlIHkgYXhpcyBpbnN0ZWFkIG9mIHggYXhpcyBsZWFkcyB0byB0aGUgc2FtZSByZXN1bHQuIEZ1cnRoZXJtb3JlLCBpdCBkb2Vzbid0IGNhdXNlIHVubmVjZXNzYXJ5IGNvbmZ1c2lvbiBjYXVzZWQgYnkgZmxpcHBpbmcgdGhlIGF4aXMgKGZvciBleGFtcGxlLCB0aGUgeS1heGlzIGxhYmVsIG5lZWRzIHRvIGJlIHNwZWNpZmllZCBhcyB0aGUgeC1heGlzIGxhYmVsIHdoZW4gYGNvb3JkX2ZsaXAoKWAgaXMgYXBwbGllZCkuIFRodXMgaXQgaXMgcmVjb21tZW5kZWQgdG8gdXNlIHRoZSBzZWNvbmQgYXBwcm9hY2gsIHByb3ZpZGVkIHRoYXQgeW91IGhhdmUgdGhlIG1vc3QgdXAtdG8tZGF0ZSB2ZXJzaW9uIG9mIGB0aWR5dmVyc2VgIGluc3RhbGxlZC4KIycgCiMnIAojJyAKIycgCiMnIEFnYWluLCB3ZSBjYW4gYWxzbyBmaWxsIHRoZSBiYXJzIHdpdGggYW5vdGhlciB2YXJpYWJsZSwgc2ltcGx5IGJ5IHNwZWNpZnlpbmcgdGhlIGBmaWxsYCBhcmd1bWVudCBpbiB0aGUgYWVzdGhldGljIG1hcHBpbmcgZGVmaW5pdGlvbjoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gcmFuaywgZmlsbCA9IHNleCkpICsgCiAgZ2VvbV9iYXIod2lkdGggPSAwLjUpCgojJyAKIycgVGhlIGJhcnMgY2FuIGFsc28gYmUgcGxhY2VkIHNpZGUtYnktc2lkZSB0byBpbXByb3ZlIGNvbXBhcmlzb24uIFRvIGRvIHRoYXQsIHdlIHNpbXBseSBzcGVjaWZ5IGEgbmFtZWQgYXJndW1lbnQgYHBvc2l0aW9uYCB0byB0aGUgYGdlb21fYmFyYCBmdW5jdGlvbiBhbmQgc2V0IGl0IHRvIGAnZG9kZ2UnYCwgYXMgc2VlbiBpbiB0aGUgZXhhbXBsZSBiZWxvdy4gVGhpcyBtZWFucywgdGhhdCBvbmUgYmFyIHNob3VsZCAnZG9kZ2UnIGFub3RoZXIsIGFuZCBiZSBwbGFjZWQgbmV4dCB0byBpdC4gVGhlIGRlZmF1bHQgdmFsdWUgb2YgdGhlIGBwb3NpdGlvbmAgYXJndW1lbnQgaXMgYCdzdGFja2VkJ2AsIHdoaWNoIGlzIHByZXR0eSBzZWxmLWV4cGxhbmF0b3J5IGFuZCBjYW4gYmUgc2VlbiBpbiB0aGUgcHJldmlvdXMgZXhhbXBsZS4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gcmFuaywgZmlsbCA9IGRpc2NpcGxpbmUpKSArIAogIGdlb21fYmFyKHBvc2l0aW9uID0gJ2RvZGdlJykKCiMnIAojJyBXZSBjYW4gYWxzbyB1c2UgYmFycGxvdHMgdG8gcHJlc2VudCBzdW1tYXJ5IHN0YXRpc3RpY3MgdmlzdWFsbHkgLSBmb3IgZXhhbXBsZSwgdGhlIGF2ZXJhZ2Ugc2FsYXJ5IG9mIGEgcHJvZmVzc29yIGdpdmVuIGhpcyBvciBoZXIgcmFuay4gVG8gZG8gdGhhdCwgd2UgZmlyc3QgY29uc3RydWN0IGEgc3VtbWFyeSBkYXRhIGZyYW1lLCB1c2luZyB0b29scyBjb3ZlcmVkIGluIHRoZSBwcmV2aW91cyBjaGFwdGVyLCBhbmQgdGhlbiBwbG90IHRoZSByZXN1bHQuCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0Kc2FsYXJ5X2J5X3JhbmsgPC0gU2FsYXJpZXMgJT4lIAogIGdyb3VwX2J5KHJhbmspICU+JQogIHN1bW1hcmlzZShhdmdfc2FsYXJ5ID0gbWVhbihzYWxhcnkpKSAlPiUKICB1bmdyb3VwKCkKCmdncGxvdChzYWxhcnlfYnlfcmFuaywgYWVzKHggPSByYW5rLCB5ID0gYXZnX3NhbGFyeSkpICsgCiAgZ2VvbV9iYXIoc3RhdCA9ICdpZGVudGl0eScsIHdpZHRoID0gMC41LCBmaWxsID0gJ2ZpcmVicmljaycpCgojJyAKIycgCiMnIE5vdGUgdGhhdCBpbiB0aGlzIGNhc2Ugd2UgbmVlZCB0byBzcGVjaWZ5IGJvdGggeCBhbmQgeSBhZXN0aGV0aWNzLCBhcyB4IHJlcHJlc2VudHMgdGhlIG5hbWUgb2YgdGhlIGdyb3VwIChpbiB0aGlzIGNhc2UgdGhlIHByb2Zlc3NvcnMnIHJhbmspIGFuZCB5IC0gdGhlIGFzc29jaWF0ZWQgdmFsdWUsIGluZGljYXRlZCBieSB0aGUgaGVpZ2h0IG9mIGVhY2ggYmFyLiBNb3Jlb3Zlciwgd2UgbmVlZCB0byBzZXR0aGUgYHN0YXRgIGFyZ3VtZW50IG9mIGBnZW9tX2JhcmAgdG8gYGlkZW50aXR5YC4gVGhpcyBpcyBiZWNhdXNlIHRoZSBkZWZhdWx0IHNldHRpbmcsIGBzdGF0ID0gY291bnRgIGltcGxpZXMgdGhhdCBnZ3Bsb3QgdGFrZXMgb25seSBvbmUsIGRpc2NyZXRlIHZhcmlhYmxlIGFzIGFyZ3VtZW50cyBhbmQgY291bnRzIHRoZSBudW1iZXIgb2Ygb2JzZXJ2YXRpb25zIGluIGVhY2ggb2YgdGhlIGdyb3VwIGRlZmluZWQgYnkgdGhlIGxldmVscyBvZiB0aGUgdmFyaWFibGUgLSBhbiBvcGVyYXRpb24gdmVyeSBzaW1pbGFyIHRvIHRoZSBvdXRwdXQgb2YgYHRhYmxlKG1hdGgkaGVhbHRoKWAuIFdlIGNhbiBhbHNvIHVzZSBgZ2VvbV9jb2xgLCB3aGljaCBpcyBhIHNob3J0LWhhbmQgZm9yIGBnZW9tX2JhcihzdGF0ID0gJ2lkZW50aXR5JylgIGFuZCBwcm9kdWNlcyB0aGUgc2FtZSBvdXRwdXQ6CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KHNhbGFyeV9ieV9yYW5rLCBhZXMoeCA9IHJhbmssIHkgPSBhdmdfc2FsYXJ5KSkgKyAKICBnZW9tX2NvbCh3aWR0aCA9IDAuNSwgZmlsbCA9ICdmaXJlYnJpY2snKQoKIycgCiMnIAojJyAKIycgCiMnICMjIyMgQm94cGxvdHMgCgojJyAKIycgQW5vdGhlciB3YXkgdG8gY29tcGFyZSBhIHZhcmlhYmxlIGFjcm9zcyBncm91cHMgaXMgdGhyb3VnaCB0aGUgdXNlIG9mIGJveHBsb3RzLiBCb3hwbG90cyB3ZXJlIGRlc2NyaWJlZCBpbiB0aGUgY2hhcHRlciBvbiBbZXhwbG9yYXRvcnkgZGF0YSBhbmFseXNpc10oI2V4cGxvcmF0b3J5KSBhcyBhIHdheSBvZiBldmFsdWF0aW5nIHRoZSBkaXN0cmlidXRpb24gb2YgYSBjb250aW51b3VzIHZhcmlhYmxlLiBUaGV5IGFyZSBhbHNvIGltcGxlbWVudGVkIGluIHRoZSBgZ2dwbG90MmAgcGFja2FnZSBhbmQgY2FuIGJlIHVzZWQgZm9yIGNvbXBhcmlzb25zIG9mIHRoZSBjb250aW51b3VzIHZhcmlhYmxlcyBkaXN0cmlidXRpb25zIGFjcm9zcyBtdWx0aXBsZSBncm91cHMgZGVmaW5lZCBieSBhIGRpc2NyZXRlIHZhcmlhYmxlLiBUaGlzIGNhbiBiZSBkb25lIGJ5IHNwZWNpZnlpbmcgdGhlIGdyb3VwaW5nIHZhcmlhYmxlIHRvIHRoZSB4IGFlc3RoZXRpYyBhbmQgdGhlIGNvbnRpbnVvdXMgdmFyaWFibGUgd2hpY2ggd2Ugd2FudCB0byBleGFtaW5lIHRvIHRoZSB5IGFlc3RoZXRpYy4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2V4LCB5ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2JveHBsb3Qod2lkdGggPSAwLjUpCgojJyAKIycgV2UgY2FuIHNlZSB0aGF0IHdoaWxlIHRoZSBtZWRpYW5zIG9mIE1hbGUgYW5kIEZlbWFsZSBwcm9mZXNzb3IncyB3YWdlcyBpbiBvdXIgc2FtcGxlIGFyZSBzaW1pbGFyLCB0aGUgaW50ZXJxdWFudGlsZSByYW5nZSBpcyBtdWNoIGhpZ2hlciBmb3IgbWVuLiBBdCB0aGUgc2FtZSB0aW1lLCB0aGUgZGlzdHJpYnV0aW9uIG9mIG1hbGUgd2FnZXMgaXMgbW9yZSBzcHJlYWQgb3V0LCBhcyBpbmRpY2F0ZWQgYnkgbGFyZ2VyIGJveCwgbG9uZ2VyIHRhaWxzLiBJdCBhbHNvIGluY2x1ZGVzIHNvbWUgb3V0bGllcnMuCiMnIAojJyBXZSBjYW4gYWxzbyBkcmF3IGFuIGFyYml0cmFyeSBzdW1tYXJ5IHN0YXRpc3RpYyAtIHN1Y2ggYXMgdGhlIG1lYW4gLSBvbiB0aGUgcGxvdCwgYnkgdXNpbmcgdGhlIGBzdGF0X3N1bW1hcnlgIGZ1bmN0aW9uIC0gd2Ugc3BlY2lmeSB0aGUgc3RhdGlzdGljIHdlIHdhbnQgdG8gdXNlIHdpdGggdGhlIGBmdW5gIGtleXdvcmQgYXJndW1lbnQgYW5kIHRoZSBnZW9tIHVzaW5nIHRoZSBgZ2VvbWAgYXJndW1lbnQuIEluIHRoaXMgY2FzZSwgd2UgYWRkIGEgY3Jvc3MgdG8gaW5kaWNhdGUgdGhlIG1lYW4gc2FsYXJ5IGZvciBib3RoIHNleGVzIG9uIHRoZSBwbG90OgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzZXgsIHkgPSBzYWxhcnkpKSArIAogIGdlb21fYm94cGxvdCh3aWR0aCA9IDAuNSkgKyAKICBzdGF0X3N1bW1hcnkoZnVuID0gIm1lYW4iLCBnZW9tID0gInBvaW50IiwgCiAgICAgICAgICAgICAgIHNoYXBlID0gMywgY29sb3IgPSAicmVkIikKCiMnIAojJyAjIyMjIFZpb2xpbiBwbG90cyAKCiMnIAojJyBWaW9saW4gcGxvdHMgYXJlIGNsb3NlbHkgcmVsYXRlZCB0byBib3ggcGxvdHMsIGhvd2V2ZXIgdGhleSBkZXBpY3QgdGhlIHNoYXBlIG9mIHRoZSB2YXJpYWJsZXMnIGRpc3RyaWJ1dGlvbi4gQXMgc3VjaCwgdGhleSBvdmVyY29tZSB0aGUgaXNzdWUgcmVsYXRlZCB0byB0aGUgdXNlIG9mIGJveHBsb3RzIGRlY3JpYmVkIGluIHRoZSBbZXhwbG9yYXRvcnkgYW5hbHlzaXMgY2hhcHRlcl0oI2V4cGxvcmF0b3J5KSAtIG5hbWVseSB0aGF0IHR3byBkaXN0cmlidXRpb25zIGNhbiBoYXZlIGlkZW50aWNhbCBib3ggcGxvdHMsIHlldCB2ZXJ5IGRpZmZlcmVudCB1bmRlcmx5aW5nIHNoYXBlcy4gVGhlIHZpb2xpbiBwbG90cyBhdm9pZCBpdCBieSBjb25uZWN0aW5nIGJveHBsb3RzIHdpdGgga2VybmVsIGRlbnNpdHkgZXN0aW1hdGVzLCBnaXZpbmcgYSBiZXR0ZXIgYXBwcm94aW1hdGlvbiBvZiB0aGUgc2hhcGUgb2YgYSB2YXJpYWJsZSdzIGRpc3RyaWJ1dGlvbi4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2V4LCB5ID0gc2FsYXJ5KSkgKyAKICBnZW9tX3Zpb2xpbih3aWR0aCA9IDAuNSkKCiMnIAojJyBXZSBjYW4gc2VlIHRoZSBzdHJlbmd0aCBvZiB0aGF0IGJ5IGNvbWluZyBiYWNrIHRvIHRoZSBtaXNsZWFkaW5nIGV4YW1wbGUgZnJvbSB0aGUgcHJldmlvdXMgY2hhcHRlci4gU3VwcG9zZSB3ZSBoYXZlIHRoZSAKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsaWJyYXJ5KGdub3JtKQp4IDwtIHJub3JtKDEwMDAsIC0yLCAwLjcpCnkgPC0gcm5vcm0oMTAwMCwgMiwgMC43KQp6IDwtIHJnbm9ybSgyMDAwLCAwLCAzLjUsIGJldGEgPSA4KQp2YXJpYWJsZSA8LSBjKHJlcCgiT25lIiwgbGVuZ3RoKHgpICsgbGVuZ3RoKHkpKSwgCiAgICAgICAgICAgICAgcmVwKCJUd28iLCBsZW5ndGgoeikpKQpkdCA8LSB0aWJibGUodmFsdWUgPSBjKHgsIHksIHopLCBjYXRlZ29yeSA9IHZhcmlhYmxlKQpnZ3Bsb3QoZHQsIGFlcyh4ID0gdmFsdWUsIGZpbGwgPSBjYXRlZ29yeSkpICsgCiAgZ2VvbV9kZW5zaXR5KGFscGhhID0gMC4zKQoKIycgCiMnIFRoZSBib3hwbG90cyBsb29rIHZlcnkgYWxpa2U6CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KGR0LCBhZXMoeCA9IGNhdGVnb3J5LCB5ID0gdmFsdWUpKSArIAogIGdlb21fYm94cGxvdCgpCgojJyAKIycgCiMnIEhvd2V2ZXIsIHRoZSB2aW9saW4gcGxvdCBnaXZlIGF3YXkgdGhlIGVudGlyZSBzdG9yeSAtIG5hbWVseSB0aGUgZmFjdCB0aGF0IHRoZSBmaXJzdCBjYXRlZ29yeSBoYXMgdHdvIHBlYWtzIChpLmUuIGNvbWVzIGZyb20gYSBiaW1vZGFsIGRpc3RyaWJ1dGlvbiwgdXNpbmcgdGhlIHByb3BlciBzdGF0aXN0aWNhbCB0ZXJtcyksIGFuZCBpdCBpcyB1bmxpa2VseSB0aGF0IHdlIG9ic2VydmUgdGhlIG1lZGlhbiB2YWx1ZS4gQSBnb29kIGV4YW1wbGUgb2Ygc3VjaCBkaXN0cmlidXRpb25zIGZyb20gdGhlIHBvbGl0aWNhbCByZWFsbSBhcmUgdGhlIHNlbGYtaWRlbnRpZmljYXRpb24gb24gdGhlIGxlZnQtcmlnaHQgaWRlb2xvZ2ljYWwgc2NhbGUsIHdpdGggbWFqb3JpdHkgb2YgcmVzcG9uZGVudHMgcmVwb3J0aW5nIHRvIGJlIGVpdGhlciBzbGlnaHRseSBjb25zZXJ2YXRpdmUgb3Igc2xpZ2h0bHkgbGliZXJhbC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoZHQsIGFlcyh4ID0gY2F0ZWdvcnksIHkgPSB2YWx1ZSkpICsgCiAgZ2VvbV92aW9saW4oKQoKIycgCiMnICMjIyMgU2NhdHRlciBwbG90cyAKCiMnIAojJyBTbyBmYXIgd2UgaGF2ZSBkZXNjcmliZWQgbXVsdGlwbGUgd2F5cyBvZiB2aXN1YWxseSByZXByZXNlbnRpbmcgYSBjb250aW5vdXMgdmFyaWFibGUsIGFzIHdlbGwgYXMgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIGEgY29udGlub3VzIHZhcmlhYmxlIGFuZCBzb21lIGRpc2NyZXRlIGdyb3VwaW5nIHZhcmlhYmxlcy4gVW5kZXIgbWFueSBjaXJjdW1zdGFuY2VzLCB3ZSBhcmUgaW50ZXJlc3RlZCBpbiBleGFtaW5pbmcgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHR3byBjb250aW51b3VzIHZhcmlhYmxlcy4gT25lIG9mIHRoZSBtb3N0IGNvbW1vbmx5IGVtcGxveWVkIGRhdGEgdmlzdWFsaXphdGlvbiB0ZWNobmlxdWVzIGZvciBwcm9ibGVtcyBsaWtlIHRoaXMgYXJlIHNjYXR0ZXIgcGxvdHMsIHdoaWNoIHNpbXBseSBkZXNjcmliZSBlYWNoIG9ic2VydmF0aW9uIGFzIGEgcG9pbnQgbWFya2VkIG9uIGEgdHdvLWRpbWVuc2lvbmFsIGdyYXBoLCB3aXRoIHggYXhpcyByZXByZXNlbnRpbmcgb25lIHZhcmlhYmxlIGFuZCB5IGF4aXMgLSB0aGUgb3RoZXIuIFRoaXMgY2FuIGJlIHNlZW4gaW4gdGhlIGV4YW1wbGUgYmVsb3csIGluIHdoaWNoIHdlIGxvb2sgYXQgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBwcm9mZXNzb3IncyBleHBlcmllbmNlIGFwcHJveGltYXRlZCBieSB5ZWFycyBzaW5jZSBhdHRhaW5pbmcgUGhEIGFuZCBoaXMgb3IgaGVyIHNhbGFyeS4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSkpICsgCiAgZ2VvbV9wb2ludCgpCgojJyAKIycgSXQgaXMgY2xlYXIgdGhhdCB3ZSBjYW4gc2VlIGEgc29tZSBzb3J0IG9mIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBleHBlcmllbmNlIGFuZCBlYXJuaW5ncy4gSW4gb3RoZXIgd29yZHMsIHRoZXJlJ3MgYSBkZWdyZWUgb2YgcG9zaXRpdmUgY29ycmVsYXRpb24gYmV0d2VlbiB0aGVzZSB0d28gdmFyaWFibGVzICh3ZSB3aWxsIGV4YW1pbmUgdGhpcyB0ZXJtIG1vcmUgaW4gZGVwdGggaW4gaW4gdGhlIFtuZXh0IGNoYXB0ZXJdKCNhc3NvY2lhdGlvbikpLCBpLmUuIHByb2Zlc3NvcnMgd2l0aCBtb3JlIGV4cGVyaWVuY2UgdGVuZCB0byBlYXJuIG1vcmUgb24gYXZlcmFnZS4gSG93ZXZlciwgd2l0aCBleHBlcmllbmNlIHRoZSByZWxhdGlvbnNoaXAgYmVjb21lcyBtb3JlIG5vaXN5LCBhcyB0aGVyZSdzIG1vcmUgdmFyaWF0aW9uIGluIGVhcm5pbmdzIG9mIHRoZSBtb3JlIGV4cGVyaWVuY2VkIGFjYWRlbWljcy4gQXMgaW4gdGhlIHByZXZpb3VzIGNhc2VzLCB3ZSBjYW4gc3BlY2lmeSBhZGRpdGlvbmFsIGFlc3RoZXRpY3Mgc3VjaCBhcyBjb2xvciBvciBzaGFwZToKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSwgCiAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gcmFuaywgc2hhcGUgPSByYW5rKSkgKyAKICBnZW9tX3BvaW50KCkKCiMnIAojJyAKIycgIyMjIyBMaW5lIG9mIGJlc3QgZml0IAoKIycgCiMnIFdlIGNhbiBhbHNvIGFkZCBhIGxpbmUgb2YgYmVzdCBmaXQgdG8gb3VyIHBsb3QsIGJ5IHVzaW5nIHRoZSBgZ2VvbV9zbW9vdGgoKWAgZ2VvbSwgd2l0aCB0aGUgYG1ldGhvZGAgYXJndW1lbnQgc3BlY2lmaWVkIHRvIGAnbG0nYC4gVGhlIGxpbmUgb2YgYmVzdCBmaXQgaXMgc2ltcGx5IHRoZSBsaW5lIHRoYXQgaXMgY2xvc2VzdCB0byBlYWNoIG9mIHRoZSBwb2ludHMgaW4gdGhlIHBsb3Qgb24gYXZlcmFnZS4gVGhlIGAnbG0nYCBtZXRob2RzIHN0YW5kcyBmb3IgbGluZWFyIG1vZGVsIC0gYSBtZXRob2QgdXNlZCBmb3IgZml0dGluZyBzdWNoIGEgbGluZSwgZGVzY3JpYmVkIGluIG1vcmUgZGV0YWlsIGluIHRoZSBuZXh0IHBhcnQsIGluIGNoYXB0ZXIgb24gW2xpbmVhciByZWdyZXNzaW9uXSgjb2xzKS4gCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykKCiMnIAojJyBIZXJlLCB5b3Ugc2hvdWxkIGJlIGFibGUgdG8gZnVsbHkgdW5kZXJzdGFuZCB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIGxvY2FsIGFuZCBnbG9iYWwgYWVzdGhldGljIG1hcHBpbmdzIG1lbnRpb25lZCBbZWFybGllciBpbiB0aGUgY2hhcHRlcl0oI3RoZS1wbG90dGluZy1zeW50YXgpLiBOb3RpY2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBwcm92aWRpbmcgdGhlIGFlc3RoZXRpYyBtYXBwaW5nIGF0IHRoZSBnbG9iYWwgbGV2ZWwgKGkuZS4gdG8gdGhlIGBnZ3Bsb3QoKWAgZnVuY3Rpb24gY2FsbCkuLi46CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnksIGNvbG9yID0gcmFuaykpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQoKIycgCiMnIC4uLiBhbmQganVzdCB0byB0aGUgYGdlb21fcG9pbnQoKWAuIAojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5KSkgKyAKICBnZW9tX3BvaW50KGFlcyhjb2xvciA9IHJhbmspKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykKCiMnIAojJyBJbiB0aGUgZm9ybWVyIGNhc2UsIHRoZSBgY29sb3IgPSBzZXhgIGFyZ3VtZW50IGlzIHVzZWQgYnkgYm90aCBgZ2VvbV9wb2ludGAgYW5kIGBnZW9tX2xpbmUoKWAsIHdoaWNoIGxlYWRzIHRvIF8zIGxpbmVzIG9mIGRpZmZlcmVudCBjb2xvcnMgYmVpbmcgZml0dGVkIGZvciBlYWNoIG9mIHRoZSBncm91cHMgc2VwYXJhdGVseV8uIFdoZW4gdGhlIGBjb2xvcmAgYWVzdGhldGljIG1hcHBpbmcgaXMgb25seSBwcm92aWRlZCB0byB0aGUgYGdlb21fcG9pbnRgIGF0IHRoZSBsb2NhbCBsZXZlbCwgb25lIGxpbmUgaXMgZml0dGVkIHRvIHRoZSBkYXRhLCBhcyBzcGVjaWZpZWQgYnkgdGhlIGdsb2JhbCBtYXBwaW5nLiBCb3RoIG9mIHRoZXNlIGFwcHJvYWNoZXMgbWF5IGJlIHVzZWZ1bCwgZGVwZW5kaW5nIG9uIG91ciByZXNlYXJjaCBxdWVzdGlvbi4gVGhlIGNvbXBhcmlzb24gb2YgdGhlc2UgdHdvIHBsb3RzIGZ1cnRoZXIgcmV2ZWFscyBhbiBpbnRlcmVzdGluZyBiZWhhdmlvdXIgaW4gb3VyIGRhdGE6IHdoZW4gYWxsIHRoZSBvYnNlcnZhdGlvbnMgYXJlIGNvbnNpZGVyZWQgdG9lZ2V0aGVyLCB0aGVyZSBzZWVtcyB0byBiZSBhIHBvc2l0aXZlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHllYXJzIHNpbmNlIFBoRCBhbmQgc2FsYXJ5LiBIb3dldmVyIHdoZW4gd2UgbG9vayBhdCB0aGUgZ3JvdXAgbGV2ZWwsIHRoZSByZWxhdGlvbnNoaXAgYXBwZWFycyB0byBkaXNhcHBlYXIgLSB0aGlzIGJlaGF2aW91ciBpcyBrbm93biBhcyB0aGUgW1NpbXBzb24ncyBQYXJhZG94XSgjaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU2ltcHNvbiUyN3NfcGFyYWRveCkuIEluIHRoaXMgY2FzZSwgaXQncyBwcmltYXJpbHkgdGhlIHJlc3VsdCBvZiB0aGUgcmVsYXRpb25zaGlwIGJldHdlZW4gdGhlIHJhbmsgYW5kIHllYXJzIHNpbmNlIFBoRCAtIHByb2Zlc3NvcnMgd2l0aCBoaWdoZXIgcmFua3MgaGF2ZSBtb3JlIGV4cGVyaWVuY2UuIFdoZW4gdGhlIHZhcmlhdGlvbiBpbiB0aGUgc2FsYXJpZXMgd2l0aGluIHRob3NlIGdyb3VwcyBpcyBjb25zaWRlcmVkLCB0aGUgZXhwZXJpZW5jZSBtZWFzdXJlZCBpbiB5ZWFycyBzZWVtcyB0byBoYXJkbHkgZXhwbGFpbiBhbnkgb2YgdGhlIHZhcmlhdGlvbiBpbiBlYXJuaW5ncy4KIycgCiMnICMjIyMgTGluZSBjb25uZWN0aW5nIHBvaW50cyAKCiMnIAojJyBJbiBzb21lIGNhc2VzLCB3ZSBtaWdodCB3YW50IHRvIGNvbm5lY3QgcG9pbnRzIGluIG91ciBmaWd1cmUgd2l0aCBhIGxpbmUgdG8gZGVwaWN0IHNvbWUgc29ydCBvZiB0cmVuZCBpbiB0aGUgbWVhbiBvZiBhIHZhcmlhYmxlIGRlcGVuZGluZyBvbiBhIGNhdGVnb3JpY2FsIGdyb3VwIHRoYXQgaGFzIGEgbmF0dXJhbCBvcmRlcmluZyAtIGZvciBleGFtcGxlLCBzdXBwb3NlIHdlIHdhbnQgdG8gdmlzdWFsbHkgZXhhbWluaW5nIGRpZmZlcmVuY2VzIGluIHRoZSBhdmVyYWdlIGVhcm5pbmdzIG9mIHByb2Zlc3NvcnMgaW4gb3VyIGRhdGFzZXQgZGVwZW5kaW5nIG9uIHRoZWlyIHllYXJzIGluIHNlcnZpY2UuCiMnIAojJyBGaXJzdCB3ZSBjYW4gb2J0YWluIHRoZSBhdmVyYWdlIGZvciBlYWNoIGdyb3VwIHVzaW5nIGBncm91cF9ieWAgYW5kIGBzdW1tYXJpc2VgLgojJyAKIycgCiMnIAojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmJ5YWdlIDwtIFNhbGFyaWVzICU+JQogIG11dGF0ZSh5cnNfcmFuZ2UgPSBjdXRfd2lkdGgoeXJzLnNpbmNlLnBoZCwgNSwgYm91bmRhcnkgPSA1KSkgJT4lCiAgZ3JvdXBfYnkoeXJzX3JhbmdlKSAlPiUKICBzdW1tYXJpc2UoYXZnID0gbWVhbihzYWxhcnksIG5hLnJtID0gVFJVRSkpICU+JQogIHVuZ3JvdXAoKQoKIycgCiMnIFdlIGNhbiB0aGVuIHBsb3QgdGhlIGF2ZXJhZ2VzIHVzaW5nIGBnZW9tX3BvaW50YDoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoYnlhZ2UsIGFlcyh4ID0geXJzX3JhbmdlLCB5ID0gYXZnKSkgKyAKICBnZW9tX3BvaW50KCkKCiMnIAojJyAKIycgV2hpbGUgdGhlcmUgc2VlbXMgdG8gYmUgc29tZSBzb3J0IG9mIHRyZW5kIGluIHRoZSBkYXRhIChldmVuIHRob3VnaCB0aGUgZnVydGhlciBwb2ludHMgZGl2ZXJ0IGZyb20gaXQsIHdoaWNoIGlzIGxpa2VseSB0aGUgcmVzdWx0IG9mIHNtYWxsIHNhbXBsZSBzaXplIGluIGEgZ2l2ZW4gZ3JvdXAgbGVhZGluZyB0byByYXRoZXIgdW5yZWxpYWJsZSBzYW1wbGUgZXN0aW1hdGVzKSwgdGhlIHBsb3QgZG9lcyBub3QgZW1waGFzaXplIGl0IGVub3VnaC4gVG8gbWFrZSBpdCBtb3JlIG1lYW5pZ2Z1bCwgd2UgY2FuIGFkZCBhIGxpbmUgY29ubmVjdGluZyB0aGUgcG9pbnRzIHdpdGggYGdlb21fbGluZWAuIE5vdGUgdGhhdCB3ZSBoYXZlIHRvIHNldCB0aGUgYGdyb3VwYCBhZXN0aGV0aWMgdG8gMSwgd2hpY2ggcHJvdmlkZXMgYGdncGxvdGAgYSBoaW50IG9uIGhvdyB0byBjb25uZWN0IHRoZSBwb2ludC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoYnlhZ2UsIGFlcyh4ID0geXJzX3JhbmdlLCB5ID0gYXZnLCBncm91cCA9IDEpKSArIAogIGdlb21fcG9pbnQoKSArIAogIGdlb21fbGluZSgpCgojJyAKIycgV2UgY2FuIGV4dGVuZCB0aGUgZm9sbG93aW5nIGV4YW1wbGUgYnkgY29tcGFyaW5nIHRoZSBzYW1lIHRyZW5kIGRlcGVuZGluZyBvbiB0aGUgcGFpZCBjbGFzc2VzIHRha2VuOgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmJ5YWdlIDwtIFNhbGFyaWVzICU+JQogIG11dGF0ZSh5cnNfcmFuZ2UgPSBjdXRfd2lkdGgoeXJzLnNpbmNlLnBoZCwgNSwgYm91bmRhcnkgPSA1KSkgJT4lCiAgZ3JvdXBfYnkoeXJzX3JhbmdlLCBkaXNjaXBsaW5lKSAlPiUKICBzdW1tYXJpc2UoYXZnID0gbWVhbihzYWxhcnksIG5hLnJtID0gVFJVRSkpICU+JQogIHVuZ3JvdXAoKQoKZ2dwbG90KGJ5YWdlLCBhZXMoeCA9IHlyc19yYW5nZSwgeSA9IGF2ZywgY29sb3IgPSBkaXNjaXBsaW5lLCAKICAgICAgICAgICAgICAgICAgbHR5ID0gZGlzY2lwbGluZSwgZ3JvdXAgPSBkaXNjaXBsaW5lKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fbGluZSgpCgojJyAKIycgCiMnIAojJyAjIyMgTXVsdGlwbGUgcGxvdHMgCgojJyAKIycgYGdncGxvdDJgIGFsc28gbWFrZXMgaXQgcG9zc2libGUgdG8gcHV0IG11bHRpcGxlIHBsb3RzIGluIG9uZSBmaWd1cmUgLSB0aGlzIGlzIGluZGVlZCB2ZXJ5IHVzZWZ1bCB1bmRlciBtYW55IGNpcmN1bXN0YW5jZXMsIGFuZCBtYW55IGRhdGEgdmlzdWFsaXphdGlvbiBwcm9mZXNzaW9uYWxzIGNvbnNpZGVyIGl0IGEgZ29vZCBwcmFjdGljZSwgYXMgaXQgZm9sbG93cyB0aGUgcnVsZSBvZiBfc21hbGwgbXVsdGlwbGVzXywgbWFraW5nIHRoZSBkYXRhIG1vcmUgZGlnZXN0aWJsZSB0byB0aGUgcmVhZGVyIGFuZCBhdm9pZGluZyBpbmZvcm1hdGlvbmFsIG92ZXJsb2FkIGluIG9uZSBwbG90LiBBcnJhbmdpbmcgcGxvdHMgaW50byBhIGZpZ3VyZSBjYW4gYmUgZG9uZSBpbiB0d28gd2F5cyAtIGJhc2VkIG9uIGEgdmFsdWUgb2YgYSBjYXRlZ29yaWNhbCB2YXJpYWJsZSAoJ2ZhY2V0aW5nJykgYW5kIGJ5IGFyYml0cmFyaWx5IHB1dHRpbmcgcGxvdHMgaW50byBhIHJlY3Rhbmd1bGFyIGdyaWQuIAojJyAKIycgIyMjIyBGYWNldGluZyAKCiMnIAojJyBGYWNldGluZyByZWZlcnMgdG8gc2ltcGx5IHNwbGl0dGluZyB0aGUgZGF0YSBieSB0aGUgdmFsdWUgb2YgYSBjYXRlZ29yaWNhbCB2YXJpYWJsZSwgc2ltaWxhcmlseSB0byB0aGUgd2F5IGBncm91cF9ieWAgdHJlYXRzIHRoZSBkYXRhIHdoZW4gcGVyZm9ybWluZyByZWd1bGFyIG1hbmlwdWxhdGlvbi4gVGhlIHN5bnRheCBpcyByZWxhdGl2ZWx5IHNpbXBsZTogd2Ugc2ltcGx5IGFkZCBhbm90aGVyIGxheWVyIHRvIG91ciBwbG90IGNhbGxlZCBgZmFjZXRfd3JhcGAgYW5kIHNwZWNpZnkgdGhlIGZhY2V0aW5nIHZhcmlhYmxlIGZvbGxvd2luZyB0aGUgX3RpbGRlXyBzeW1ib2wgYH5gIC0gdGhpcyBpcyBhIGNvbW1vbmx5IHVzZWQgbm90YXRpb24gaW4gUiwgaW5kaWNhdGluZyBzb21lIHNvcnQgb2YgZGVwZW5kZW5jZSBvZiBvbmUgdmFyaWFibGUgb24gYW5vdGhlciAtIHlvdSB3aWxsIGVuY291bnRlciBpdCBpbiB0aGUgbmV4dCB0d28gY2hhcHRlcnMuCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeXJzLnNpbmNlLnBoZCwgc2FsYXJ5KSkgKyAKICBmYWNldF93cmFwKH4gcmFuaykgKyAKICBnZW9tX3BvaW50KCkgKyAKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQogIAoKIycgCiMnIEFzIGEgcmVzdWx0IHdlIGNhbiBzZWUgdGhlIHNjYXR0ZXIgcGxvdHMgYW5kIGxpbmVzIG9mIGJlc3QgZml0IGluIHRocmVlIHNlcGFyYXRlIHBsb3RzLCBlYWNoIG9uZSB3aXRoIGFuIGFwcHJvcHJpYXRlIGhlYWRpbmcgaW5kaWNhdGluZyB0aGUgZ3JvdXAgb2YgdGhlIG9ic2VydmF0aW9ucy4gSG93ZXZlciwgdGhlIG91dHB1dCBpcyBkaWZmaWN1bHQgdG8gcmVhZCwgZHVlIHRvIHRoZSBmYWN0IHRoYXQgdGhlIHgtYXhpcyBpbiB0aGUgcGxvdCBpcyBmaXhlZCB0byB0aGUgc2FtZSBsZW5ndGggZm9yIGVhY2ggb2YgdGhlIHBsb3RzIC0gdGhpcyBpbXByb3ZlcyBjb21wYXJhYmlsaXR5IG9mIHRoZSBmaWd1cmVzLCBidXQgbGltaXRzIGl0cyBjbGFyaXR5LiBUaGlzIGNhbiBiZSBjaGFuZ2VkIGJ5IHNwZWNpZnlpbmcgYW4gYWRkaXRpb25hbCBhcmd1bWVudCB0byB0aGUgYGZhY2V0X3dyYXBgIGxheWVyOgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHlycy5zaW5jZS5waGQsIHNhbGFyeSkpICsgCiAgZmFjZXRfd3JhcCh+IHJhbmssIHNjYWxlcyA9ICdmcmVlX3gnKSArIAogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gc2V4KSkgKyAKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQoKIycgCiMnIEFnYWluLCB3ZSBjYW4gc2VlIHRoYXQgdGhlIHJlbGF0aW9uc2hpcCBzZWVuIGluIHRoZSBvdmVyYWxsIGRhdGFzZXQgZGlzYXBwZWFycyB3aXRoaW4gZWFjaCBvZiB0aGUgZ3JvdXBzLgojJyAKIycgV2UgY2FuIGFsc28gZmFjZXQgdXNpbmcgbW9yZSB0aGFuIG9uZSB2YXJpYWJsZSBhbmQgYXJyYW5nZSB0aGUgZmlndXJlcyBpbnRvIGEgZ3JpZCB2aWEgYSB0d28gZGltZW5zaW9uYWwgZ3JvdXBpbmcuIEZvciBleGFtcGxlLCBzdXBwb3NlIHdlIHdhbnQgdG8gZXZhbHVhdGUgdGhlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgZXhwZXJpZW5jZSB3aWh0aW4gZWFjaCBjb21iaW5hdGlvbiBvZiByYW5rIGFuZCBkaXNjaXBsaW5lIG9mIHRoZSBpbmRpdmlkdWFscy4gVGhpcyBjYW4gYmUgYWNoaWV2ZWQgYnkgdXNpbmcgdGhlIGBmYWNldF9ncmlkYCBsYXllci4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCkpICsgCiAgZmFjZXRfZ3JpZChkaXNjaXBsaW5lIH4gcmFuaykgKwogIGdlb21faGlzdG9ncmFtKCkKCiMnIAojJyAKIycgCiMnIEluIGhlcmUsIHdlIGNhbiBzZWUgdGhhdCBwcm9mZXNzb3JzIGluIHRoZW9yZXRpY2FsIGRpc2NpcGxpbmVzIHNlZW0gdG8gaGF2ZSB3b3JrZWQgbG9uZ2VyIG9uIGF2ZXJhZ2UsIGhvd2V2ZXIgdGhlIHJhbmdlIG9mIHRoZSB2YWx1ZXMgaXMgY29tcGFyYWJsZSBpbiBib3RoIGNhc2VzLiBUaGVyZSBhbHNvIGFwcGVhcnMgdG8gYmUgbW9yZSBBc3Npc3RhbnQgUHJvZmVzc29ycyBhbmQgQXNzb2NpYXRlIFByb2Zlc3NvcnMgaW4gdGhlIGFwcGxpZWQgZGVwYXJ0bWVudHMsIHdpdGggbm8gc2lnaW5pZmljYW50IGRpZmZlcmVuY2VzIGluIGdlbmRlci4gU2ltaWxhciBhbmFseXNpcyBhcHBsaWVkIHRvIGVhcm5pbmdzLCBob3dldmVyLCByZXZlYWxzIHRoYXQgdGhlIGVhcm5pbmdzIHNlZW0gdG8gYmUgaGlnaGVyIGF0IGVhY2ggbGV2ZWwgaW4gdGhlIGFwcGxpZWQgZGVwYXJ0bWVudHMuCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpICsgCiAgZmFjZXRfZ3JpZChkaXNjaXBsaW5lIH4gcmFuaykgKwogIGdlb21faGlzdG9ncmFtKCkKCiMnIAojJyAKIycgCiMnICMjIyMgUGxvdHRpbmcgaW4gYSBncmlkIAoKIycgCiMnIFNvbWV0aW1lcywgd2Ugd2FudCB0byBtYWtlIG91ciBmaWd1cmUgYXJyYW5nZW1lbnQgbW9yZSBjdXN0b21pemVkLCBub3QgbmVjZXNzYXJpbHkgYXJyYW5nZWQgaW4gYWNjb3JkYW5jZSB3aXRoIG91ciB2YXJpYWJsZS4gRm9yIGV4YW1wbGUsIHdlIG1heSB3YW50IHRvIGRlcGljdCBhIGNvbnNpbmNlIHN1bW1hcnkgb2YgdGhlIG1vc3QgaW1wb3J0YW50IG9mIG91ciBmaW5kaW5ncyBpbiBvbmUgMngyIHBsb3QuIFRvIGRvIHRoaXMsIHdlIGNhbiB1c2UgdGhlIGBwbG90X2dyaWRgIGZ1bmN0aW9uIGZyb20gdGhlIGBjb3dwbG90YCBwYWNrYWdlICh3aGljaCwgYXMgYWx3YXlzLCBuZWVkcyB0byBiZSBpbnN0YWxsZWQgZmlyc3QpLiAKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpsaWJyYXJ5KGNvd3Bsb3QpCgojJyAKIycgVG8gZG8gYXJyYW5nZSB0aGUgcGxvdHMgaW4gYW4gYXJiaXRyYXJ5IHJlY3Rhbmd1bGFyIGdyaWQsIHdlIGZpcnN0IG5lZWQgdG8gY3JlYXRlIGVhY2ggb2Ygb3VyIHBsb3RzIGFzIGEgc2VwYXJhdGUgYGdncGxvdGAgb2JqZWN0LiBUbyBhdm9pZCByZXBldGl0aW9uLCBob3dldmVyLCBpdCdzIGJlc3QgdG8gZmlyc3QgY3JlYXRlIGEgYmFzaWMgb2JqZWN0IGFuZCB0aGVuIGFkZCBuZXcgbGF5ZXJzIHRvIGl0IGFuZCBzYXZlIGl0IHVuZGVyIHNlcGFyYXRlIG5hbWVzLgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCnBsdCA8LSBnZ3Bsb3QoU2FsYXJpZXMsIGFlcyhmaWxsID0gZGlzY2lwbGluZSwgY29sb3IgPSBkaXNjaXBsaW5lKSkKcGx0X2hpc3RfcyA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSBzYWxhcnkpLCBhbHBoYSA9IDAuMykKcGx0X2hpc3RfeSA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSB5cnMuc2luY2UucGhkKSwgYWxwaGEgPSAwLjMpCnBsdF9iYXIgPC0gcGx0ICsgZ2VvbV9iYXIoYWVzKHkgPSByYW5rKSkKcGx0X3NjdCA8LSBwbHQgKyBnZW9tX3BvaW50KGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSkpICsKICBnZW9tX3Ntb290aChhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpLCBtZXRob2QgPSAnbG0nKQpwbG90X2dyaWQocGx0X3NjdCwgcGx0X2hpc3RfcywgcGx0X2hpc3RfeSwgcGx0X2JhcikKCiMnIAojJyAKIycgCiMnICMjIyBDdXN0b21pemluZyBwbG90cyAKCiMnIAojJyBOb3RlIHRoYXQgaW4gYSBsb3Qgb2YgdGhlIGNhc2VzIGFib3ZlLCB0aGUgcGxvdHMgd2VyZSBmYXIgZnJvbSBwdWJsaWNhdGlvbiBxdWFsaXR5IC0gd2hpbGUgdGhleSBhbGxvd2VkIHRvIGdldCBhbiBvdmVydmlldyBvZiB0aGUgZGF0YSwgdGhleSBrZXB0IHRoZSBvcmlnaW5hbCB2YXJpYWJsZSBuYW1lcyBvbiB0aGUgYXhlcyBhbmQgaGFkIGlzc3VlcyB3aXRoIGF4aXMgdGljayBsYWJlbHMgb3ZlcmxhcHBpbmcsIGFtb25nc3Qgb3RoZXIgdGhpbmdzLiBBbGwgdGhvc2UgaXNzdWVzIGNhbiBiZSBmaXhlZCB3aXRoIGdncGxvdCdzIGN1c3RvbWl6YXRpb24gY2FwYWJpbGl0aWVzLgojJyAKIycgRm9yIHN0YXJ0ZXRzLCBsZXQncyBjb25zaWRlciBvbmUgb2YgdGhlIHNjYXR0ZXIgcGxvdHMgd2UgY3JlYXRlZCBlYXJsaWVyOgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5LCBjb2xvciA9IHJhbmspKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykKCiMnIAojJyBJdCB3b3VsZCBiZSB1c2VmdWwgdG8gbWFrZSB0aGUgdmFyaWFibGUgbmFtZXMgbW9yZSBmb3JtYWwgb24gdGhlIHBsb3QuIFRoaXMgY2FuIGJlIGRvbmUgdXNpbmcgdGhlIGBsYWJzYCBsYXllciwgdXNlZCB0byBzcGVjaWZ5IGxhYmVsczoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSwgY29sb3IgPSByYW5rKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fc21vb3RoKG1ldGhvZCA9ICdsbScpICsKICAjYWRkIGF4ZXMgbGFiZWxzCiAgbGFicyh4ID0gJ1llYXJzIHNpbmNlIFBoRCcsIHkgPSAnU2FsYXJ5IGluIFVTRCcpCgojJyAKIycgVGl0bGUgb2YgdGhlIHBsb3QgY2FuIGFsc28gYmUgc3BlY2lmaWVkIHVzaW5nIHRoZSBgZ2d0aXRsZWAgZnVuY3Rpb246CiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnksIGNvbG9yID0gcmFuaykpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKSArCiAgI2FkZCBheGVzIGxhYmVscwogIGxhYnMoeCA9ICdZZWFycyBzaW5jZSBQaEQnLCB5ID0gJ1NhbGFyeSBpbiBVU0QnKSArIAogICNhZGQgdGl0bGUKICBnZ3RpdGxlKCdTYWxhcmllcyBvZiBVUyBjb2xsZWdlIHByb2Zlc3NvcnMnKQoKIycgCiMnIAojJyBGdXJ0aHJlbW9yZSwgd2UgY2FuIGN1c3RvbWl6ZSB0aGUgbGVnZW5kIGxhYmVscyBhcyB3ZWxsLiBUaHMgaXMgZG9uZSB1c2luZyB0aGUgYHNjYWxlX2NvbG9yX2Rpc2NyZXRlYCBsYXllciwgd2hpY2ggYXBwbGllcyBtYW51YWwgY2hhbmdlcyB0byB0aGUgYGNvbG9yYCBhZXN0aGV0aWMgd2Ugc3BlY2lmaWVkIHdoZW4gaW5pdGlhbGl6aW5nIHRoZSBnZ3Bsb3Qgb2JqZWN0LgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5LCBjb2xvciA9IHJhbmspKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykgKwogICNhZGQgYXhlcyBsYWJlbHM6CiAgbGFicyh4ID0gJ1llYXJzIHNpbmNlIFBoRCcsIHkgPSAnU2FsYXJ5IGluIFVTRCcpICsKICAjYWRkIHRpdGxlCiAgZ2d0aXRsZSgnU2FsYXJpZXMgb2YgVVMgY29sbGVnZSBwcm9mZXNzb3JzJykgKwogICNyZW5hbWUgbGVnZW5kIGVsZW1lbnRzOgogIHNjYWxlX2NvbG9yX2Rpc2NyZXRlKG5hbWUgPSAnUmFuaycsIAogICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IGMoJ0Fzc3QuIFByb2YuJywgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQXNzb2MuIFByb2YuJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdQcm9mJykpCgojJyAKIycgV2UgY2FuIGFsc28gY3VzdG9taXplIHRoZSBsZWdlbmQgdXNpbmcgdGhlIGB0aGVtZWAgbGF5ZXIuIFRoaXMgbGF5ZXIgaXMgdXNlZCBmb3IgY3VzdG9taXphdGlvbiBvZiBtYWpvcml0eSBvZiBwbG90IGVsZW1lbnRzLCBzdWNoIGFzIHRoZSBsZWdlbmQsIHRleHQgYW5kIHRoZSBheGVzLgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5LCBjb2xvciA9IHJhbmspKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykgKwogICNhZGQgYXhlcyBsYWJlbHM6CiAgbGFicyh4ID0gJ1llYXJzIHNpbmNlIFBoRCcsIHkgPSAnU2FsYXJ5IGluIFVTRCcpICsKICAjYWRkIHRpdGxlCiAgZ2d0aXRsZSgnU2FsYXJpZXMgb2YgVVMgY29sbGVnZSBwcm9mZXNzb3JzJykgKwogICNyZW5hbWUgbGVnZW5kIGVsZW1lbnRzOgogIHNjYWxlX2NvbG9yX2Rpc2NyZXRlKG5hbWUgPSAnUmFuaycsIAogICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IGMoJ0Fzc3QuIFByb2YuJywnQXNzb2MuIFByb2YuJywnUHJvZicpKSArCiAgI2N1c3RvbWl6ZSB0aGUgcGxvdDoKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAnYm90dG9tJywgI21vdmUgbGVnZW5kIHRvIHRoZSBib3R0b20KICAgICAgICBsZWdlbmQuYmFja2dyb3VuZCA9IGVsZW1lbnRfcmVjdChmaWxsID0gJ2xpZ2h0Ymx1ZScpLCAjbGVnZW5kIGJhY2tncm91bmQKICAgICAgICBsZWdlbmQudGV4dCA9IGVsZW1lbnRfdGV4dChzaXplID0gOCwgZmFjZSA9ICdpdGFsaWMnKSwgI2xlZ2VuZCBmb250CiAgICAgICAgbGVnZW5kLnRpdGxlID0gZWxlbWVudF9ibGFuaygpKSAjcmVtb3ZlIHRpdGxlCgojJyAKIycgQXMgc2VlbiBhYm92ZSwgdGhlIGtleXdvcmQgYXJndW1lbnRzIG9mIGB0aGVtZWAgdXN1YWxseSB0YWtlIHR3byBmb3JtcyAtIGEgc3RyaW5nLCBzdWNoIGFzIGBsZWdlbmQucG9zaXRpb24gPSAnYm90dG9tJ2AsIG9yIGBlbGVtZW50XypgIHRoZW1lIGVsZW1lbnRzLiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCB0aGVtIGluIGA/ZWxlbWVudF9ibGFua2AsIGhvd2V2ZXIgdGhlIGJhc2ljIGxvZ2ljIGlzIGFzIGZvbGxvd3MgLSB5b3UgdXNlIGBlbGVtZW50X3RleHQoKWAgdG8gc3BlY2lmeSBfdGV4dCBjaGFyYWN0ZXJpc3RpY3NfIC0gc3VjaCBhcyB0aGUgZm9udCwgc2l6ZSwgY29sb3Igb3IgZmFjZSBvZiB0aGUgX3RleHQgZWxlbWVudHMgb2YgdGhlIHBsb3RfLCBzdWNoIGFzIGxlZ2VuZCBsYWJlbHMgb3IgYXhpcyB0aWNrcywgYGVsZW1lbnRfcmVjdGAgdG8gc3BlY2lmeSB0aGUgY2hhcmFjdGVyaXN0aWNzIG9mIF9yZWN0YW5nbGUgZWxlbWVudHNfLCBzdWNoIGFzIGJhY2tncm91bmRzIGFuZCBgZWxlbWVudF9ibGFua2AgdG8gbWFrZSBhIGdpdmVuIGVsZW1lbnRzIGRpc2FwcGVhciBmcm9tIHRoZSBwbG90IGVudGlyZWx5LgojJyAKIycgCiMnIEluIHNvbWUgY2FzZXMgb3VyIGF4aXMgbGFiZWxzIGFyZSB0d28gbG9uZywgd2hpY2ggY2FuIGJlIHByb2JsZW1hdGljIGVzcGVjaWFsbHkgaW4gdGhlIHggYXhpcywgYXMgaXQgcmVzdWx0cyBpbiBvdmVybGFwcyBhbmQgbWFrZXMgaW1wb3NzaWJsZSB0byByZWFkIHRoZW0uIEEgY29tbW9uIHNvbHV0aW9uIGlzIHRvIHJvdGF0ZSB0aGUgbGFiZWxzIGJ5IGEgY2VydGFpbiBhbmdsZS4gVGhpcyBjYW4gYmUgZG9uZSB1c2luZyB0aGUgYGF4aXMudGV4dC54YCBhcmd1bWVudCB3aXRoIGBlbGVtZW50X3RleHQocm90YXRpb24gPSBuKWAsIHdoZXJlIGBuYCBhcmUgdGhlIG1hZ25pdHVkZSBvZiBjb3VudGVyLWNsb2Nrd2lzZSByb3RhdGlvbi4gVGhlIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIGp1c3RpZmljYXRpb24gY2FuIGhlIGFkanVzdGVkIHVzaW5nIHRoZSBgdmp1c3RgIGFuZCBgaGp1c3RgIGFyZ3VtZW50cyByZXNwZWN0aXZlbHkuCiMnIAojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmJ5YWdlIDwtIFNhbGFyaWVzICU+JQogIG11dGF0ZSh5cnNfcmFuZ2UgPSBjdXRfd2lkdGgoeXJzLnNpbmNlLnBoZCwgNSwgYm91bmRhcnkgPSA1KSkgJT4lCiAgZ3JvdXBfYnkoeXJzX3JhbmdlLCBkaXNjaXBsaW5lKSAlPiUKICBzdW1tYXJpc2UoYXZnID0gbWVhbihzYWxhcnksIG5hLnJtID0gVFJVRSkpICU+JQogIHVuZ3JvdXAoKQoKZ2dwbG90KGJ5YWdlLCBhZXMoeCA9IHlyc19yYW5nZSwgeSA9IGF2ZywgY29sb3IgPSBkaXNjaXBsaW5lLCAKICAgICAgICAgICAgICAgICAgbHR5ID0gZGlzY2lwbGluZSwgZ3JvdXAgPSBkaXNjaXBsaW5lKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fbGluZSgpICsKICBsYWJzKHggPSAnWWVhcnMgc2luY2UgUGhEJywgeSA9ICdBdmVyYWdlIGVhcm5pbmdzJykgKwogIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC45LCBoanVzdCA9IDEuMCkpCgojJyAKIycgRmluYWxseSwgd2UgY2FuIG1ha2UgY2hhbmdlcyB0byB0aGUgb3ZlcmFsbCBwbG90IGJ5IGFwcGx5aW5nIHRoZW1lcyB0byB0aGUgZW50aXJlIHBsb3QuIFNvbWUgb2YgdGhlbSBhcmUgYnVpbHQgaW50byB0aGUgYGdncGxvdGAgcGFja2FnZTsgbW9yZSBjb21lIHdpdGggYGNvd3Bsb3RgIG9yIGBnZ3B1YnJgLiBZb3UgY2FuIGZpbmQgY291cGxlIGV4YW1wbGVzIGJlbG93LCBidXQgZmVlbCBmcmVlIHRvIGV4cGxvcmUgdGhlbSBvbmxpbmUuCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KcGx0IDwtIGdncGxvdChieWFnZSwgYWVzKHggPSB5cnNfcmFuZ2UsIHkgPSBhdmcsIGNvbG9yID0gZGlzY2lwbGluZSwgCiAgICAgICAgICAgICAgICAgIGx0eSA9IGRpc2NpcGxpbmUsIGdyb3VwID0gZGlzY2lwbGluZSkpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX2xpbmUoKSArIAogIGxhYnMoeCA9ICdZZWFycyBzaW5jZSBQaEQnLCB5ID0gJ0F2ZXJhZ2UgZWFybmluZ3MnKQoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpwbHQgKwogIHRoZW1lX2J3KCkgKyAKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQoKIycgCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KcGx0ICsKICB0aGVtZV9idygpICsgCiAgdGhlbWUoYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoYW5nbGUgPSA0NSwgdmp1c3QgPSAwLjgsIGhqdXN0ID0gMS4wKSkKCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KcGx0ICsKICB0aGVtZV9jbGFzc2ljKCkgKyAKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQoKIycgCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KcGx0ICsKICB0aGVtZV9jb3dwbG90KCkgKyAKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQoKIycgCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KcGx0ICsKICB0aGVtZV9taW5pbWFsKCkgKyAKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQoKIycgCiMnICoqTm90ZSoqIHRoYXQgdGhlIGB0aGVtZWAgYWRqdXN0bWVudHMgbXVzdCBiZSBzcGVjaWZpZWQgYWZ0ZXIgYSBzcGVjaWZpYyB0aGVtZSBpcyBzcGVjaWZpZWQsIG9yIG90aGVyd2lzZSBpZiBvdmVycmlkZXMgdGhlbS4gWW91IGNhbiBhbHNvIHNwZWNpZnkgYSB0aGVtZSB1cGZyb250IGZvciB5b3VyIGVudGlyZSBzY3JpcHQgYnkgdXNpbmcgYHRoZW1lX3NldCgpYC4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQp0aGVtZV9zZXQodGhlbWVfZ3JleShiYXNlX3NpemUgPSAxMCkpCnBsdCArCiAgdGhlbWUoYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoYW5nbGUgPSA0NSwgdmp1c3QgPSAwLjgsIGhqdXN0ID0gMS4wKSkKCiMnIAojJyAKIycgIyMjIFNhdmluZyBwbG90cyAKCiMnIAojJyBTYXZpbmcgcGxvdHMgY2FuIGJlIGRvbmUgdXNpbmcgdGhlIGBnZ3NhdmVgIGZ1bmN0aW9uOgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdnc2F2ZShwbG90ID0gcGx0LCBmaWxlbmFtZSA9ICdmaWxlcy90ZXN0LnBuZycsIHdpZHRoID0gMTUwLCBoZWlnaHQgPSAxMDAsIHVuaXRzID0gJ21tJykKCiMnIAojJyAKIycgCiMnIAojJyAKIycgCiMnIAoA');
        if (!response.ok) throw new Error('Network response failed');
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = '07-data_visualization.R';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.dispatchEvent(new MouseEvent('click'));
        document.body.removeChild(a);
        setTimeout(() =&gt; {
          window.URL.revokeObjectURL(blobUrl);
        }, 100);
        return false;
      } catch (error) {
        console.error('Download failed:', error);
        alert('Download failed. Please try again.');
      }
    }
    downloadFile(event);
  "><i class="fa fa-save"></i> Chapter script</button>
<button class="btn btn-default" onclick="
    async function downloadFile(event) {
      event.preventDefault();
      try {
        const response = await fetch('data:text/x-markdown;base64,LS0tCm91dHB1dDogaHRtbF9kb2N1bWVudAotLS0KIyBEYXRhIFZpc3VhbGl6YXRpb24geyN2aXN1YWxpemF0aW9ufQoKCgoKIyMgQ29udGVudAoKVGhlIGZpbmFsIGNoYXB0ZXIgaW4gdGhpcyBwYXJ0IGZvY3VzZXMgb24gZGF0YSB2aXN1YWxpemF0aW9uLiBXaGlsZSBzb21lIHRlY2huaXF1ZXMgZm9yIHByZXNlbnRpbmcgZGF0YSB3ZXJlIGFscmVhZHkgZGVzY3JpYmVkIGluIHRoZSBjaGFwdGVyIG9uIFtFeHBsb3JhdG9yeSBkYXRhIGFuYWx5c2lzXSgjZXhwbG9yYXRvcnkpLCB0aGlzIGNoYXB0ZXIgd2lsbCBjb3ZlciB0aGUgdG9waWMgaW4gbW9yZSBkZXB0aCBhbmQgaW50cm9kdWNlIHlvdSB0byB0aGUgbW9zdCBjb21tb25seSB1c2VkIHRvb2wgZm9yIGRhdGEgdmlzdWFsaXphdGlvbiBpbiBSIC0gdGhlIGBnZ3Bsb3QyYCBwYWNrYWdlLiBUaGUgbWFpbiBhZHZhbnRhZ2Ugb2YgYGdncGxvdDJgIGluIGNvbXBhcmlzb24gd2l0aCBzb21lIG9mIHRoZSBvdXQtb2YtdGhlLWJveCBwbG90dGluZyBjYXBhYmlsaXRpZXMgY29taW5nIHdpdGggUiBpcyB0aGUgc2ltcGxpY2l0eSBvZiBjcmVhdGluZyByZWxhdGl2ZWx5IGNvbXBsZXggYW5kIG5pY2UgbG9va2luZyBwbG90LCB3aGljaCB3b3VsZCBvZnRlbiB0YWtlIG11Y2ggbG9uZ2VyIHRvIHByb2R1Y2Ugd2l0aCBSIGJhc2UgZ3JhcGhpY3MuIAoKVGhlIGBnZ3Bsb3QyYCBwYWNrYWdlIGlzIGEgcGFydCBvZiBgdGlkeXZlcnNlYCwgd2hpY2ggd2FzIGludHJvZHVjZWQgaW4gdGhlIFtwcmV2aW91cyBjaGFwdGVyXSgjZHBseXIpLCBhbmQgaXQgaXMgb2Z0ZW4gdXNlZnVsIGluIGNvbmp1bmN0aW9uIHdpdGggc29tZSBvZiB0aGUgZGF0YSBtYW5pcHVsYXRpb24gdG9vbHMgb2ZmZXJlZCBieSBvdGhlciBgdGlkeXZlcnNlYCBwYWNrYWdlcy4gWW91IGNhbiBsb2FkIHRoZSBsaWJyYXJ5IGRpcmVjdGx5OgoKYGBge3J9CmxpYnJhcnkoZ2dwbG90MikKYGBgCgpIb3dldmVyIHlvdSBtYXkgYWxzbyBhdHRhY2ggaXQgYWxvbmcgd2l0aCBvdGhlciBgdGlkeXZlcnNlYCBwYWNrYWdlczoKCmBgYHtyIG1lc3NhZ2U9RkFMU0V9CmxpYnJhcnkodGlkeXZlcnNlKQpgYGAKCldlIHdpbGwgYWxzbyBsb2FkIHRoZSBgc2FsYXJpZXNgIGRhdGFzZXQsIHdoaWNoIGRlc2NyaWJlcyB0aGUgc2FsYXJpZXMgb2YgVVMgcHJvZmVzc29ycy4gVG8gZG8gdGhpcywgeW91IHdpbGwgbmVlZCB0byBpbnN0YWxsIHRoZSBwYWNrYWdlIHVzaW5nIHRoZSBgY2FyRGF0YWAgcGFja2FnZSB1c2luZyB0aGUgYGluc3RhbGwucGFja2FnZXNgIGZ1bmN0aW9uOgoKCgoKVG8gbG9hZCB0aGUgZGF0YSwgc2ltcHkgZXhlY3V0ZSB0aGUgYmVsb3cgY29kZS4gVGhlIGRhdGFmcmFtZSB3aWxsIGJlIGF0dGFjaGVkIHRvIHlvdXIgZ2xvYmFsIGVudmlyb25tZW50LgoKYGBge3J9CmRhdGEoJ1NhbGFyaWVzJywgcGFja2FnZSA9ICdjYXJEYXRhJykKZ2xpbXBzZShTYWxhcmllcykKYGBgCgpUaGUgZGF0YSBjb25zaXN0cyBvZiA2IHZhcmlhYmxlcywgZGVzY3JpYmluZyBhY2FkZW1pY3MgcmFuaywgZGlzY2lwbGluZSAoQSBmb3IgdGhlb3JldGljYWwgYW5kIEIgZm9yIGFwcGxpZWQpLCBleHBlcmllbmNlIG1lYXN1cmVkIGluIHllYXJzIGluIHNlcnZpY2UgYW5kIHllYXJzIHNpbmNlIFBoRCBhdHRhaW5tZW50LCB0aGUgc3ViamVjdHMgc2V4IGFuZCBzYWxhcnkuIFRvIHNlZSBtb3JlIGRldGFpbHMgYWJvdXQgdGhlIGRhdGEsIHVzZSBgP2NhckRhdGE6OlNhbGFyaWVzYAoKIyMjIFRoZSBwbG90dGluZyBzeW50YXggey19CgpTaW1pbGFyaWx5IHRvIHRoZSBvdGhlciBgdGlkeXZlcnNlYCB0b29scyBleHBsb3JlZCBpbiB0aGUgcHJldmlvdXMgY2hhcHRlciwgZ2dwbG90IHVzZXMgaXRzIG93biwgb3JpZ2luYWwgYXBwcm9hY2ggdG8gY3JlYXRpbmcgcGxvdHMsIHdoaWNoIGlzIHF1aXRlIGRpZmZlcmVudCBmcm9tIHdoYXQgeW91IGhhdmUgcHJldmlvdXNseSBlbmNvdW5ldGVyZCBpbiB0aGUgZXhwbG9yYXRvcnkgZGF0YSBhbmFseXNpcyBsZXNzb24uIFRvIGluaXRpYWxpemUgYSBnZ3Bsb3Qgb2JqZWN0LCB5b3UgX2Fsd2F5c18gY2FsbCB0aGUgYGdncGxvdGAgZnVuY3Rpb24sIHNwZWNpZnlpbmcgdGhlIG5hbWUgb2YgeW91ciBkYXRhIGZyYW1lIGFzIHRoZSBmaXJzdCBhcmd1bWVudC4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMpCmBgYAoKQXMgeW91IGNhbiBzZWUgdGhpcyBpbml0aWF0ZXMgYW4gZW1wdHkgcGxvdC4gV2UgdGhlbiBmdXJodGVyIHNwZWNpZnkgdGhlIHZhcmlhYmxlcyB3ZSB3YW50IHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBvYmplY3QgdXNpbmcgdGhlIGBhZXMoKWAgZnVuY3Rpb24uIFRoZSBhZXMgYWJicmV2aWF0aW9uIHN0YW5kcyBmb3IgYWVzdGhldGljIG1hcHBpbmdzLiBJdCBkZWZpbmVzIGJpbmRpbmdzIGJldHdlZW4gdmFyaWFibGVzIGluIHRoZSBkYXRhZnJhbWUgc3BlY2lmaWVkIGFzIHRoZSBmaXJzdCBhcmd1bWVudCBvZiB0aGUgZ2dwbG90IG9iamVjdCBhbmQgYWVzdGhldGljIGVsZW1lbnRzIG9mIHRoZSBvYmplY3QgLSBmb3IgZXhhbXBsZSwgdGhlIHggYW5kIHkgYXhlcyBvZiB0aGUgcGxvdCwgbGluZS9wb2ludCBjb2xvcnMgYW5kIHNoYXBlcyBvciBiYXIgZmlsbHMuIEZvciBleGFtcGxlLCBgYWVzKHggPSBhYnNlbmNlcylgIGNhbiBiZSBpbnRlcnByZXRlZCBhcyBfImxpbmsgdGhlIHZhcmlhYmxlIGFic2VuY2VzIHdpdGggdGhlIHgtYXhpcyBvZiB0aGlzIHBsb3QiXy4gCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpCmBgYAoKTm93IHRoZSBmaWd1cmUgaW5jbHVkZXMgYW4geCBheGlzLCB3aXRoIHNvbWUgYXV0b21hdGljYWxseSBjaG9zZW4gdGljayBsb2NhdGlvbnMuIFRoZSBmaW5hbCBzdGVwIGlzIHRvIGNyZWF0ZSBhbiBhY3R1YWwgcGxvdC4gVGhpcyBpcyBkb25lIGJ5ICJhZGRpbmciIGEgc28tY2FsbGVkIF9nZW9tXyB0byB0aGUgcGxvdCBza2VsZXRvbiB3ZSBoYXZlIGNyZWF0ZWQgc28gZmFyLiBHZW9tcyBhcmUgc2ltcGx5IGZ1bmN0aW9ucyB1c2VkIHRvIGNyZWF0ZSBkaWZmZXJlbnQgcGxvdCB0eXBlcyByZXByZXNlbnRpbmcgdGhlIGRhdGEgYXNzb2NpYXRlZCB3aXRoIGEgZ2dwbG90IG9iamVjdCB0aHJvdWdoIGBnZ3Bsb3RgIGFuZCBgYWVzYCAtIGZvciBleGFtcGxlLCBgZ2VvbV9oaXN0b2dyYW1gIGlzIHVzZWQgdG8gY3JlYXRlIGEgW2hpc3RvZ3JhbV0oI2hpc3RvZ3JhbXMpIGFuZCBgZ2VvbV9ib3hwbG90YCB0byBjcmVhdGUgYSBbYm94cGxvdF0oI2JveHBsb3RzKS4gR2VvbXMgYXJlICJhZGRlZCIgdG8gdGhlIGBnZ3Bsb3RgIG9iamVjdCB1c2luZyB0aGUgYCtgIG9wZXJhdG9yLgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzYWxhcnkpKSArIAogIGdlb21faGlzdG9ncmFtKCkKYGBgCgpXZSBjYW4gc2VlIG5vdyB0aGF0IHRoZSBoaXN0b2dyYW0gb2YgdGhlIHZhcmlhYmxlIGFwcGVhcnMgb24gdGhlIHBsb3QuIFRoZSBwbG90IGFsc28gY29tZXMgd2l0aCBhIG1lc3NhZ2UgcHJvbXB0aW5nIHVzIHRvIG1hbnVhbGx5IHNwZWNpZnkgdGhlIGJpbiB3aWR0aCBmb3IgdGhlIGhpc3RvZ3JhbSwgd2hpY2ggY2FuIGJlIGRvbmUgdGhyb3VnaCB0aGUgYXJndW1lbnRzIG9mIHRoZSBgZ2VvbWAgZnVuY3Rpb24gLSBlaXRoZXIgYnkgc3BlY2lmeWluZyB0aGUgbnVtYmVyIG9mIGJpbnMgdGhyb3VnaCBgYmluc2Agb3IgdGhlIHdpZHRoIG9mIGluZGl2aWR1YWwgYmlucyB0aHJvdWdoIGBiaW53aWR0aGAuCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpICsgCiAgZ2VvbV9oaXN0b2dyYW0oYmlucyA9IDQwKQpgYGAKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2hpc3RvZ3JhbShiaW53aWR0aCA9IDUwMDApCmBgYAoKV2UgY2FuIGFsc28gY2hhbmdlIHRvIGNvbG9ycyBvZiB0aGUgYmlucyBhcyB3ZWxsIGFzIHRoZWlyIGJvcmRlcnM6CgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHNhbGFyeSkpICsgCiAgZ2VvbV9oaXN0b2dyYW0oYmlud2lkdGggPSA1MDAwLCBmaWxsID0gJ2JsdWUnLCBjb2xvciA9ICdibGFjaycpCmBgYAoKQXMgbWVudGlvbmVkIGVhcmxpZXIsIHRoZSBhZXN0aGV0aWMgY2hhcmFjdGVyaXN0aWNzIG9mIHRoZSBwbG90IHN1Y2ggYXMgYm9yZGVyIGNvbG9yIG9yIGZpbGwgY2FuIGJlIHRyZWF0ZWQgYXMgYSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZGF0YSwgbm90IG9ubHkgdGhlIHZpc3VhbCBjaGFyYWN0ZXJpc3RpY3Mgb2YgdGhlIHBsb3QuIEZvciBleGFtcGxlLCBjb250aW51aW5nIHdpdGggdGhlIGBhYnNlbmNlc2AgZXhhbXBsZSB3ZSBtYXkgc2VlIHRoZSBicmVhayBvdWYgb2YgdGhlIGFic2VuY2VzIGJldHdlZW4gbWFsZSBhbmQgZmVtYWxlIHN0dWRlbnRzLCBieSBzcGVjaWZ5aW5nIHRoZSBgZmlsbGAgYXJndW1lbnQgaW4gdGhlIGFlc3RoZXRpYyBtYXBwaW5nOgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzYWxhcnksIGZpbGwgPSBzZXgpKSArIAogIGdlb21faGlzdG9ncmFtKGJpbndpZHRoID0gNTAwMCwgY29sb3IgPSAnYmxhY2snKQpgYGAKClRoaXMgYWxzbyBhdXRvbWF0aWNhbGx5IGFkZHMgYSBsZWdlbmQgb24gdGhlIHNpZGUgb2YgdGhlIHBsb3QuIFRoZSBibHVlIGNvbG9yIHJlcHJlc2VudHMgdGhlIHByb3BvcnRpb24gb2YgZWFjaCBiaW4gcmVwcmVzZW50ZWQgYnkgbWFsZSBzdHVkZW50cyBhbmQgdGhlIHJlZCAtIGJ5IGZlbWFsZSBzdHVkZW50cy4KCkFuIGltcG9ydGFudCB0aGluZyB0byBub3RlIGlzIHRoYXQgdGhlIGFlc3RoZXRpYyBtYXBwaW5nIGNyZWF0ZWQgYnkgdGhlIGBhZXMoKWAgZnVuY3Rpb24gY2FuIGJlIGRlZmluZWQgIF9nbG9iYWxseV8gaS5lLiBmb3IgdGhlIGVudGlyZSBnZ3Bsb3QgZmlndXJlLCBhcyBpbiB0aGUgY2FzZSBhYm92ZSAoYGdncGxvdChTYWxhcmllcywgYWVzKHggPSBzYWxhcnkpKWApLCBhcyB3ZWxsIGFzIGEgX2xvY2FsbHlfLCBpLmUuIG9ubHkgZm9yIG9uZSBzcGVjaWZpYyBnZW9tIChgZ2VvbV9oaXN0b2dyYW0oYWVzKHggPSBzYWxhcnkpYCkuIEluIHRoZSBmb3JtZXIgY2FzZSwgdGhlIGVudGlyZSBmaWd1cmUgd2lsbCB1c2UgdGhlIHNldCBhZXN0aGV0aWMgbWFwcGluZywgd2hpbGUgaW4gdGhlIGxhdHRlciwgaXQgd2lsbCBhcHBseSBvbmx5IHRvIHRoZSBzcGVjaWZpYyBnZW9tLgoKYGBge3J9CmdncGxvdChTYWxhcmllcykgKyAKICBnZW9tX2hpc3RvZ3JhbShhZXMoeCA9IHNhbGFyeSwgZmlsbCA9IHNleCksIGJpbndpZHRoID0gNTAwMCxjb2xvciA9ICdibGFjaycpCmBgYAoKTm90ZSB0aGF0IHRoYXQgaW4gdGhpcyBjYXNlLCBib3RoIGdsb2JhbCBhbmQgbG9jYWwgbWFwcGluZ3MgcHJvZHVjZSBleGFjdGx5IHRoZSBzYW1lIG91dHB1dC4gSG93ZXZlciwgd2hlbiBhZGRpbmcgbXVsdGlwbGUgZ2VvbSBzdHJ1Y3R1cmVzIHRvIG9uZSBwbG90LCBhcyB3ZSB3aWxsIHNlZSBsYXRlciwgdXNpbmcgYSBnbG9iYWwgdnMgbG9jYWwgYWVzdGhldGljIG1hcHBpbmcgY2FuIGxlYWQgdG8gdmVyeSBkaWZmZXJlbnQgcmVzdWx0cy4gCgojIyMgQWxsIGFib3V0IGdlb21zIC0gcGxvdCB0eXBlcyBpbiBnZ3Bsb3QyIHstfQoKSW4gdGhpcyBzZWN0aW9uLCB3ZSB3aWxsIGV4cGxvcmUgc29tZSBvZiB0aGUgYmFzaWMgcGxvdCB0eXBlcyAob3IgX2dlb21zXykgb2ZmZXJlZCBieSB0aGUgYGdncGxvdDJgIHBhY2thZ2UuIFRoZSBudW1iZXIgb2YgZ2VvbXMgYXZhaWxhYmxlIGlzIHZhc3QsIGFuZCB0aGlzIGlzbid0IGJ5IGFueSBtZWFucyBhbiBleGhhdXN0aXZlIGRpc2N1c3Npb24gb2YgdGhlIHRvcGljIC0geW91IGNhbiBmaW5kIHRoZSBmdWxsIGxpc3QgaW4gdGhlIGdncGxvdDIgW2NoZWF0c2hlZXRdKGh0dHBzOi8vZ2l0aHViLmNvbS9yc3R1ZGlvL2NoZWF0c2hlZXRzL2Jsb2IvbWFzdGVyL2RhdGEtdmlzdWFsaXphdGlvbi0yLjEucGRmKS4gRXZlbiBtb3JlIGNhbiBiZSBmb3VuZCB0aHJvdWdoIGV4dGVybmFsLCBnZ3Bsb3QtYmFzZWQgcGFja2FnZXMuIEhvd2V2ZXIsIGxlYXJuaW5nIHRoZSBiYXNpY3Mgb2YganVzdCBjb3VwbGUgb2YgdGhlbSBzaG91bGQgaGVscCB5b3UgZ2FpbiBhIHN1ZmZpY2llbnQgdW5kZXJzdGFuZGluZyBvZiBnZ3Bsb3QncyBwbG90dGluZyBwaGlsb3NvcGh5IHRvIGJlIGFibGUgdG8gZXhwbG9yZSB0aGUgcmVzdCBieSB5b3Vyc2VsZiBhbmQgdXNlIHRoZW0gd2hlbmV2ZXIgeW91IG5lZWQgdG8uIAoKIyMjIyBEZW5zaXR5IGVzdGltYXRlIHstfQoKVGhlIGRlbnNpdHkgZXN0aW1hdGUgaXMgYW4gYWx0ZXJuYXRpdmUgd2F5IHRvIGRyYXcgYSBoaXN0b2dyYW0gb2YgdGhlIGRhdGEuIEl0IHJlcHJlc2VudHMgdGhlIGRpc3RyaWJ1dGlvbiBvZiBhIGNvbnRpbm91cyB2YXJpYWJsZSBieSBkcmF3aW5nIGEgbGluZS4gWW91IGNhbiBzZWUgdGhhdCB0aGUgc2hhcGUgb2YgdGhlIGRlbnNpdHkgcGxvdCBvZiBgYWJzZW5jZXNgIGJlbG93IGRpcmVjdGx5IGNvcnJlc3BvbmRzIHdpdGggdGhlIGhpc3RvZ3JhbSBvZiB0aGlzIHZhcmlhYmxlIGZyb20gdGhlIHByZXZpb3VzIGV4YW1wbGUuIAoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzYWxhcnkpKSArIAogIGdlb21fZGVuc2l0eSgpIApgYGAKCgpLZXJuZWwgZGVuc2l0eSBlc3RpbWF0ZXMgYXJlIHBhcnRpY3VsYXJseSB1c2VmdWwgdG8gY29tcGFyZSB0aGUgZGlzdHJpYnV0aW9uIG9mIGEgdmFyaWFibGUgYmV0d2VlbiBkaWZmZXJlbnQgdmFsdWVzIG9mIGEgZ3JvdXBpbmcgdmFyaWFibGUuIEZvciBleGFtcGxlLCB3ZSBjYW4gZXhhbWluZSB0aGUgZGlmZmVyZW5jZSBpbiB0aGUgZGlzdHJpYnV0aW9ucyBvZiB0aGUgc2FsYXJ5IGRlcGVuZGluZyBvbiB0aGUgcG9zaXRpb24gaGVsZCBieSB0aGUgaW5kaXZpZHVhbDoKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5LCBmaWxsID0gcmFuaykpICsgCiAgZ2VvbV9kZW5zaXR5KGFscGhhID0gMC4zKQpgYGAKClRoZSBkaWZmZXJlbmNlcyBhcmUgY2xlYXItY3V0IC0gaXQgYXBwZWFycyB0aGF0IGFzIGV4cGVjdGVkLCBoaWdoZXIgcG9zaXRpb24gaGVsZCBnZW5lcmFsbHkgbGVhZHMgdG8gaGlnaGVyIG1lZGlhbiBvZiBlYXJuaW5ncy4gSG93ZXZlciwgZWFjaCBwb3NpdGlvbiBhbHNvIGhhcyBoaWdoZXIgdmFyaWFiaWxpdHkgaW4gaW5jb21lLCB3aXRoIHRoZSBzcHJlYWQgb2YgUHJvZmVzc29ycyBlYXJuaW5ncyBtb3JlIHRoYW4gdHdpY2UgYXMgbGFyZ2UgYXMgZm9yIEFzc2lzdGFudCBQcm9mZXNzb3JzLgoKIyMjIyBCYXJwbG90cyB7LX0KCkhpc3RvZ3JhbXMgYW5kIGtlcm5lbCBkZW5zaXR5IGVzdGltYXRlcyBhcmUgdXNlZnVsIGluIHJlcHJlc2VudGluZyBjb250aW51b3VzIHZhcmlhYmxlcywgc3VjaCBhcyB0ZW1wZXJhdHVyZSwgR0RQIG9yIGhvdXJzIG9mIGFic2VuY2UuIEluIGNhc2Ugb2YgZGlzY3JldGUgdmFyaWFibGVzLCB3aGljaCBvbmx5IHRha2UgYSBmaW5pdGUgYW5kIHVub3JkZXJlZCBzZXQgb2YgdmFsdWVzLCBpdCdzIG9mdGVuIGJldHRlciB0byB1c2UgYmFyIHBsb3RzLiBXaXRoIGBnZ3Bsb3QyYCwgdGhlc2UgY2FuIGJlIGVhc2lseSBvYnRhaW5lZCB1c2luZyAgYGdlb21fYmFyYC4gRm9yIGV4YW1wbGUsIHdlIGNhbiB1c2UgaXQgdG8gcmVwcmVzZW50IHRoZSBvZiBhY2FkZW1pYyByYW5rcyB3aXRoaW4gb3VyIGRhdGFzZXQuCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHJhbmspKSArIAogIGdlb21fYmFyKHdpZHRoID0gMC41LCBmaWxsID0gJ2ZvcmVzdGdyZWVuJykKYGBgCgpZb3UgbWF5IGFsc28gd2FudCB0byBtYWtlIHRoZSBiYXIgcGxvdHMgaG9yaXpvbnRhbC4gVGhlcmUgYXJlIHR3byB3YXlzIHRvIHRvIHRoaXM6IHRoZSBvbGQgYXBwcm9hY2ggaXMgc2ltcGx5IHRvIGFkZCBgY29vcmRfZmxpcCgpYCB0byB5b3VyIGBnZ3Bsb3RgIG9iamVjdC4gWW91IG1heSBzdGlsbCBlbmNvdW50ZXIgdGhpcyB3YXkgb2YgcGxvdHRpbmcgaG9yaXpvbnRhbCBiYXIgcGxvdHMgaW4gb3RoZXIgdXNlcnMgY29kZS4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gcmFuaykpICsgCiAgZ2VvbV9iYXIod2lkdGggPSAwLjUsIGZpbGwgPSAnZm9yZXN0Z3JlZW4nKSArCiAgY29vcmRfZmxpcCgpCmBgYAoKSG93ZXZlciwgc2luY2UgYGdncGxvdGAgdmVyc2lvbiAzLjMuMCwgcHJvdmlkaW5nIHRoZSB5IGF4aXMgaW5zdGVhZCBvZiB4IGF4aXMgbGVhZHMgdG8gdGhlIHNhbWUgcmVzdWx0LiBGdXJ0aGVybW9yZSwgaXQgZG9lc24ndCBjYXVzZSB1bm5lY2Vzc2FyeSBjb25mdXNpb24gY2F1c2VkIGJ5IGZsaXBwaW5nIHRoZSBheGlzIChmb3IgZXhhbXBsZSwgdGhlIHktYXhpcyBsYWJlbCBuZWVkcyB0byBiZSBzcGVjaWZpZWQgYXMgdGhlIHgtYXhpcyBsYWJlbCB3aGVuIGBjb29yZF9mbGlwKClgIGlzIGFwcGxpZWQpLiBUaHVzIGl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSB0aGUgc2Vjb25kIGFwcHJvYWNoLCBwcm92aWRlZCB0aGF0IHlvdSBoYXZlIHRoZSBtb3N0IHVwLXRvLWRhdGUgdmVyc2lvbiBvZiBgdGlkeXZlcnNlYCBpbnN0YWxsZWQuCgoKCgpBZ2Fpbiwgd2UgY2FuIGFsc28gZmlsbCB0aGUgYmFycyB3aXRoIGFub3RoZXIgdmFyaWFibGUsIHNpbXBseSBieSBzcGVjaWZ5aW5nIHRoZSBgZmlsbGAgYXJndW1lbnQgaW4gdGhlIGFlc3RoZXRpYyBtYXBwaW5nIGRlZmluaXRpb246CgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHJhbmssIGZpbGwgPSBzZXgpKSArIAogIGdlb21fYmFyKHdpZHRoID0gMC41KQpgYGAKClRoZSBiYXJzIGNhbiBhbHNvIGJlIHBsYWNlZCBzaWRlLWJ5LXNpZGUgdG8gaW1wcm92ZSBjb21wYXJpc29uLiBUbyBkbyB0aGF0LCB3ZSBzaW1wbHkgc3BlY2lmeSBhIG5hbWVkIGFyZ3VtZW50IGBwb3NpdGlvbmAgdG8gdGhlIGBnZW9tX2JhcmAgZnVuY3Rpb24gYW5kIHNldCBpdCB0byBgJ2RvZGdlJ2AsIGFzIHNlZW4gaW4gdGhlIGV4YW1wbGUgYmVsb3cuIFRoaXMgbWVhbnMsIHRoYXQgb25lIGJhciBzaG91bGQgJ2RvZGdlJyBhbm90aGVyLCBhbmQgYmUgcGxhY2VkIG5leHQgdG8gaXQuIFRoZSBkZWZhdWx0IHZhbHVlIG9mIHRoZSBgcG9zaXRpb25gIGFyZ3VtZW50IGlzIGAnc3RhY2tlZCdgLCB3aGljaCBpcyBwcmV0dHkgc2VsZi1leHBsYW5hdG9yeSBhbmQgY2FuIGJlIHNlZW4gaW4gdGhlIHByZXZpb3VzIGV4YW1wbGUuCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHJhbmssIGZpbGwgPSBkaXNjaXBsaW5lKSkgKyAKICBnZW9tX2Jhcihwb3NpdGlvbiA9ICdkb2RnZScpCmBgYAoKV2UgY2FuIGFsc28gdXNlIGJhcnBsb3RzIHRvIHByZXNlbnQgc3VtbWFyeSBzdGF0aXN0aWNzIHZpc3VhbGx5IC0gZm9yIGV4YW1wbGUsIHRoZSBhdmVyYWdlIHNhbGFyeSBvZiBhIHByb2Zlc3NvciBnaXZlbiBoaXMgb3IgaGVyIHJhbmsuIFRvIGRvIHRoYXQsIHdlIGZpcnN0IGNvbnN0cnVjdCBhIHN1bW1hcnkgZGF0YSBmcmFtZSwgdXNpbmcgdG9vbHMgY292ZXJlZCBpbiB0aGUgcHJldmlvdXMgY2hhcHRlciwgYW5kIHRoZW4gcGxvdCB0aGUgcmVzdWx0LgoKYGBge3J9CnNhbGFyeV9ieV9yYW5rIDwtIFNhbGFyaWVzICU+JSAKICBncm91cF9ieShyYW5rKSAlPiUKICBzdW1tYXJpc2UoYXZnX3NhbGFyeSA9IG1lYW4oc2FsYXJ5KSkgJT4lCiAgdW5ncm91cCgpCgpnZ3Bsb3Qoc2FsYXJ5X2J5X3JhbmssIGFlcyh4ID0gcmFuaywgeSA9IGF2Z19zYWxhcnkpKSArIAogIGdlb21fYmFyKHN0YXQgPSAnaWRlbnRpdHknLCB3aWR0aCA9IDAuNSwgZmlsbCA9ICdmaXJlYnJpY2snKQpgYGAKCgpOb3RlIHRoYXQgaW4gdGhpcyBjYXNlIHdlIG5lZWQgdG8gc3BlY2lmeSBib3RoIHggYW5kIHkgYWVzdGhldGljcywgYXMgeCByZXByZXNlbnRzIHRoZSBuYW1lIG9mIHRoZSBncm91cCAoaW4gdGhpcyBjYXNlIHRoZSBwcm9mZXNzb3JzJyByYW5rKSBhbmQgeSAtIHRoZSBhc3NvY2lhdGVkIHZhbHVlLCBpbmRpY2F0ZWQgYnkgdGhlIGhlaWdodCBvZiBlYWNoIGJhci4gTW9yZW92ZXIsIHdlIG5lZWQgdG8gc2V0dGhlIGBzdGF0YCBhcmd1bWVudCBvZiBgZ2VvbV9iYXJgIHRvIGBpZGVudGl0eWAuIFRoaXMgaXMgYmVjYXVzZSB0aGUgZGVmYXVsdCBzZXR0aW5nLCBgc3RhdCA9IGNvdW50YCBpbXBsaWVzIHRoYXQgZ2dwbG90IHRha2VzIG9ubHkgb25lLCBkaXNjcmV0ZSB2YXJpYWJsZSBhcyBhcmd1bWVudHMgYW5kIGNvdW50cyB0aGUgbnVtYmVyIG9mIG9ic2VydmF0aW9ucyBpbiBlYWNoIG9mIHRoZSBncm91cCBkZWZpbmVkIGJ5IHRoZSBsZXZlbHMgb2YgdGhlIHZhcmlhYmxlIC0gYW4gb3BlcmF0aW9uIHZlcnkgc2ltaWxhciB0byB0aGUgb3V0cHV0IG9mIGB0YWJsZShtYXRoJGhlYWx0aClgLiBXZSBjYW4gYWxzbyB1c2UgYGdlb21fY29sYCwgd2hpY2ggaXMgYSBzaG9ydC1oYW5kIGZvciBgZ2VvbV9iYXIoc3RhdCA9ICdpZGVudGl0eScpYCBhbmQgcHJvZHVjZXMgdGhlIHNhbWUgb3V0cHV0OgoKYGBge3J9CmdncGxvdChzYWxhcnlfYnlfcmFuaywgYWVzKHggPSByYW5rLCB5ID0gYXZnX3NhbGFyeSkpICsgCiAgZ2VvbV9jb2wod2lkdGggPSAwLjUsIGZpbGwgPSAnZmlyZWJyaWNrJykKYGBgCgoKCgojIyMjIEJveHBsb3RzIHstfQoKQW5vdGhlciB3YXkgdG8gY29tcGFyZSBhIHZhcmlhYmxlIGFjcm9zcyBncm91cHMgaXMgdGhyb3VnaCB0aGUgdXNlIG9mIGJveHBsb3RzLiBCb3hwbG90cyB3ZXJlIGRlc2NyaWJlZCBpbiB0aGUgY2hhcHRlciBvbiBbZXhwbG9yYXRvcnkgZGF0YSBhbmFseXNpc10oI2V4cGxvcmF0b3J5KSBhcyBhIHdheSBvZiBldmFsdWF0aW5nIHRoZSBkaXN0cmlidXRpb24gb2YgYSBjb250aW51b3VzIHZhcmlhYmxlLiBUaGV5IGFyZSBhbHNvIGltcGxlbWVudGVkIGluIHRoZSBgZ2dwbG90MmAgcGFja2FnZSBhbmQgY2FuIGJlIHVzZWQgZm9yIGNvbXBhcmlzb25zIG9mIHRoZSBjb250aW51b3VzIHZhcmlhYmxlcyBkaXN0cmlidXRpb25zIGFjcm9zcyBtdWx0aXBsZSBncm91cHMgZGVmaW5lZCBieSBhIGRpc2NyZXRlIHZhcmlhYmxlLiBUaGlzIGNhbiBiZSBkb25lIGJ5IHNwZWNpZnlpbmcgdGhlIGdyb3VwaW5nIHZhcmlhYmxlIHRvIHRoZSB4IGFlc3RoZXRpYyBhbmQgdGhlIGNvbnRpbnVvdXMgdmFyaWFibGUgd2hpY2ggd2Ugd2FudCB0byBleGFtaW5lIHRvIHRoZSB5IGFlc3RoZXRpYy4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2V4LCB5ID0gc2FsYXJ5KSkgKyAKICBnZW9tX2JveHBsb3Qod2lkdGggPSAwLjUpCmBgYAoKV2UgY2FuIHNlZSB0aGF0IHdoaWxlIHRoZSBtZWRpYW5zIG9mIE1hbGUgYW5kIEZlbWFsZSBwcm9mZXNzb3IncyB3YWdlcyBpbiBvdXIgc2FtcGxlIGFyZSBzaW1pbGFyLCB0aGUgaW50ZXJxdWFudGlsZSByYW5nZSBpcyBtdWNoIGhpZ2hlciBmb3IgbWVuLiBBdCB0aGUgc2FtZSB0aW1lLCB0aGUgZGlzdHJpYnV0aW9uIG9mIG1hbGUgd2FnZXMgaXMgbW9yZSBzcHJlYWQgb3V0LCBhcyBpbmRpY2F0ZWQgYnkgbGFyZ2VyIGJveCwgbG9uZ2VyIHRhaWxzLiBJdCBhbHNvIGluY2x1ZGVzIHNvbWUgb3V0bGllcnMuCgpXZSBjYW4gYWxzbyBkcmF3IGFuIGFyYml0cmFyeSBzdW1tYXJ5IHN0YXRpc3RpYyAtIHN1Y2ggYXMgdGhlIG1lYW4gLSBvbiB0aGUgcGxvdCwgYnkgdXNpbmcgdGhlIGBzdGF0X3N1bW1hcnlgIGZ1bmN0aW9uIC0gd2Ugc3BlY2lmeSB0aGUgc3RhdGlzdGljIHdlIHdhbnQgdG8gdXNlIHdpdGggdGhlIGBmdW5gIGtleXdvcmQgYXJndW1lbnQgYW5kIHRoZSBnZW9tIHVzaW5nIHRoZSBgZ2VvbWAgYXJndW1lbnQuIEluIHRoaXMgY2FzZSwgd2UgYWRkIGEgY3Jvc3MgdG8gaW5kaWNhdGUgdGhlIG1lYW4gc2FsYXJ5IGZvciBib3RoIHNleGVzIG9uIHRoZSBwbG90OgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzZXgsIHkgPSBzYWxhcnkpKSArIAogIGdlb21fYm94cGxvdCh3aWR0aCA9IDAuNSkgKyAKICBzdGF0X3N1bW1hcnkoZnVuID0gIm1lYW4iLCBnZW9tID0gInBvaW50IiwgCiAgICAgICAgICAgICAgIHNoYXBlID0gMywgY29sb3IgPSAicmVkIikKYGBgCgojIyMjIFZpb2xpbiBwbG90cyB7LX0KClZpb2xpbiBwbG90cyBhcmUgY2xvc2VseSByZWxhdGVkIHRvIGJveCBwbG90cywgaG93ZXZlciB0aGV5IGRlcGljdCB0aGUgc2hhcGUgb2YgdGhlIHZhcmlhYmxlcycgZGlzdHJpYnV0aW9uLiBBcyBzdWNoLCB0aGV5IG92ZXJjb21lIHRoZSBpc3N1ZSByZWxhdGVkIHRvIHRoZSB1c2Ugb2YgYm94cGxvdHMgZGVjcmliZWQgaW4gdGhlIFtleHBsb3JhdG9yeSBhbmFseXNpcyBjaGFwdGVyXSgjZXhwbG9yYXRvcnkpIC0gbmFtZWx5IHRoYXQgdHdvIGRpc3RyaWJ1dGlvbnMgY2FuIGhhdmUgaWRlbnRpY2FsIGJveCBwbG90cywgeWV0IHZlcnkgZGlmZmVyZW50IHVuZGVybHlpbmcgc2hhcGVzLiBUaGUgdmlvbGluIHBsb3RzIGF2b2lkIGl0IGJ5IGNvbm5lY3RpbmcgYm94cGxvdHMgd2l0aCBrZXJuZWwgZGVuc2l0eSBlc3RpbWF0ZXMsIGdpdmluZyBhIGJldHRlciBhcHByb3hpbWF0aW9uIG9mIHRoZSBzaGFwZSBvZiBhIHZhcmlhYmxlJ3MgZGlzdHJpYnV0aW9uLgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSBzZXgsIHkgPSBzYWxhcnkpKSArIAogIGdlb21fdmlvbGluKHdpZHRoID0gMC41KQpgYGAKCldlIGNhbiBzZWUgdGhlIHN0cmVuZ3RoIG9mIHRoYXQgYnkgY29taW5nIGJhY2sgdG8gdGhlIG1pc2xlYWRpbmcgZXhhbXBsZSBmcm9tIHRoZSBwcmV2aW91cyBjaGFwdGVyLiBTdXBwb3NlIHdlIGhhdmUgdGhlIAoKYGBge3IgaW5jbHVkZSA9IFRSVUUsIGVjaG8gPSBGQUxTRX0KbGlicmFyeShnbm9ybSkKeCA8LSBybm9ybSgxMDAwLCAtMiwgMC43KQp5IDwtIHJub3JtKDEwMDAsIDIsIDAuNykKeiA8LSByZ25vcm0oMjAwMCwgMCwgMy41LCBiZXRhID0gOCkKdmFyaWFibGUgPC0gYyhyZXAoIk9uZSIsIGxlbmd0aCh4KSArIGxlbmd0aCh5KSksIAogICAgICAgICAgICAgIHJlcCgiVHdvIiwgbGVuZ3RoKHopKSkKZHQgPC0gdGliYmxlKHZhbHVlID0gYyh4LCB5LCB6KSwgY2F0ZWdvcnkgPSB2YXJpYWJsZSkKZ2dwbG90KGR0LCBhZXMoeCA9IHZhbHVlLCBmaWxsID0gY2F0ZWdvcnkpKSArIAogIGdlb21fZGVuc2l0eShhbHBoYSA9IDAuMykKYGBgCgpUaGUgYm94cGxvdHMgbG9vayB2ZXJ5IGFsaWtlOgoKYGBge3J9CmdncGxvdChkdCwgYWVzKHggPSBjYXRlZ29yeSwgeSA9IHZhbHVlKSkgKyAKICBnZW9tX2JveHBsb3QoKQpgYGAKCgpIb3dldmVyLCB0aGUgdmlvbGluIHBsb3QgZ2l2ZSBhd2F5IHRoZSBlbnRpcmUgc3RvcnkgLSBuYW1lbHkgdGhlIGZhY3QgdGhhdCB0aGUgZmlyc3QgY2F0ZWdvcnkgaGFzIHR3byBwZWFrcyAoaS5lLiBjb21lcyBmcm9tIGEgYmltb2RhbCBkaXN0cmlidXRpb24sIHVzaW5nIHRoZSBwcm9wZXIgc3RhdGlzdGljYWwgdGVybXMpLCBhbmQgaXQgaXMgdW5saWtlbHkgdGhhdCB3ZSBvYnNlcnZlIHRoZSBtZWRpYW4gdmFsdWUuIEEgZ29vZCBleGFtcGxlIG9mIHN1Y2ggZGlzdHJpYnV0aW9ucyBmcm9tIHRoZSBwb2xpdGljYWwgcmVhbG0gYXJlIHRoZSBzZWxmLWlkZW50aWZpY2F0aW9uIG9uIHRoZSBsZWZ0LXJpZ2h0IGlkZW9sb2dpY2FsIHNjYWxlLCB3aXRoIG1ham9yaXR5IG9mIHJlc3BvbmRlbnRzIHJlcG9ydGluZyB0byBiZSBlaXRoZXIgc2xpZ2h0bHkgY29uc2VydmF0aXZlIG9yIHNsaWdodGx5IGxpYmVyYWwuCgpgYGB7cn0KZ2dwbG90KGR0LCBhZXMoeCA9IGNhdGVnb3J5LCB5ID0gdmFsdWUpKSArIAogIGdlb21fdmlvbGluKCkKYGBgCgojIyMjIFNjYXR0ZXIgcGxvdHMgey19CgpTbyBmYXIgd2UgaGF2ZSBkZXNjcmliZWQgbXVsdGlwbGUgd2F5cyBvZiB2aXN1YWxseSByZXByZXNlbnRpbmcgYSBjb250aW5vdXMgdmFyaWFibGUsIGFzIHdlbGwgYXMgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIGEgY29udGlub3VzIHZhcmlhYmxlIGFuZCBzb21lIGRpc2NyZXRlIGdyb3VwaW5nIHZhcmlhYmxlcy4gVW5kZXIgbWFueSBjaXJjdW1zdGFuY2VzLCB3ZSBhcmUgaW50ZXJlc3RlZCBpbiBleGFtaW5pbmcgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHR3byBjb250aW51b3VzIHZhcmlhYmxlcy4gT25lIG9mIHRoZSBtb3N0IGNvbW1vbmx5IGVtcGxveWVkIGRhdGEgdmlzdWFsaXphdGlvbiB0ZWNobmlxdWVzIGZvciBwcm9ibGVtcyBsaWtlIHRoaXMgYXJlIHNjYXR0ZXIgcGxvdHMsIHdoaWNoIHNpbXBseSBkZXNjcmliZSBlYWNoIG9ic2VydmF0aW9uIGFzIGEgcG9pbnQgbWFya2VkIG9uIGEgdHdvLWRpbWVuc2lvbmFsIGdyYXBoLCB3aXRoIHggYXhpcyByZXByZXNlbnRpbmcgb25lIHZhcmlhYmxlIGFuZCB5IGF4aXMgLSB0aGUgb3RoZXIuIFRoaXMgY2FuIGJlIHNlZW4gaW4gdGhlIGV4YW1wbGUgYmVsb3csIGluIHdoaWNoIHdlIGxvb2sgYXQgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBwcm9mZXNzb3IncyBleHBlcmllbmNlIGFwcHJveGltYXRlZCBieSB5ZWFycyBzaW5jZSBhdHRhaW5pbmcgUGhEIGFuZCBoaXMgb3IgaGVyIHNhbGFyeS4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSkpICsgCiAgZ2VvbV9wb2ludCgpCmBgYAoKSXQgaXMgY2xlYXIgdGhhdCB3ZSBjYW4gc2VlIGEgc29tZSBzb3J0IG9mIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBleHBlcmllbmNlIGFuZCBlYXJuaW5ncy4gSW4gb3RoZXIgd29yZHMsIHRoZXJlJ3MgYSBkZWdyZWUgb2YgcG9zaXRpdmUgY29ycmVsYXRpb24gYmV0d2VlbiB0aGVzZSB0d28gdmFyaWFibGVzICh3ZSB3aWxsIGV4YW1pbmUgdGhpcyB0ZXJtIG1vcmUgaW4gZGVwdGggaW4gaW4gdGhlIFtuZXh0IGNoYXB0ZXJdKCNhc3NvY2lhdGlvbikpLCBpLmUuIHByb2Zlc3NvcnMgd2l0aCBtb3JlIGV4cGVyaWVuY2UgdGVuZCB0byBlYXJuIG1vcmUgb24gYXZlcmFnZS4gSG93ZXZlciwgd2l0aCBleHBlcmllbmNlIHRoZSByZWxhdGlvbnNoaXAgYmVjb21lcyBtb3JlIG5vaXN5LCBhcyB0aGVyZSdzIG1vcmUgdmFyaWF0aW9uIGluIGVhcm5pbmdzIG9mIHRoZSBtb3JlIGV4cGVyaWVuY2VkIGFjYWRlbWljcy4gQXMgaW4gdGhlIHByZXZpb3VzIGNhc2VzLCB3ZSBjYW4gc3BlY2lmeSBhZGRpdGlvbmFsIGFlc3RoZXRpY3Mgc3VjaCBhcyBjb2xvciBvciBzaGFwZToKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSwgCiAgICAgICAgICAgICAgICAgICAgIGNvbG9yID0gcmFuaywgc2hhcGUgPSByYW5rKSkgKyAKICBnZW9tX3BvaW50KCkKYGBgCgoKIyMjIyBMaW5lIG9mIGJlc3QgZml0IHstfQoKV2UgY2FuIGFsc28gYWRkIGEgbGluZSBvZiBiZXN0IGZpdCB0byBvdXIgcGxvdCwgYnkgdXNpbmcgdGhlIGBnZW9tX3Ntb290aCgpYCBnZW9tLCB3aXRoIHRoZSBgbWV0aG9kYCBhcmd1bWVudCBzcGVjaWZpZWQgdG8gYCdsbSdgLiBUaGUgbGluZSBvZiBiZXN0IGZpdCBpcyBzaW1wbHkgdGhlIGxpbmUgdGhhdCBpcyBjbG9zZXN0IHRvIGVhY2ggb2YgdGhlIHBvaW50cyBpbiB0aGUgcGxvdCBvbiBhdmVyYWdlLiBUaGUgYCdsbSdgIG1ldGhvZHMgc3RhbmRzIGZvciBsaW5lYXIgbW9kZWwgLSBhIG1ldGhvZCB1c2VkIGZvciBmaXR0aW5nIHN1Y2ggYSBsaW5lLCBkZXNjcmliZWQgaW4gbW9yZSBkZXRhaWwgaW4gdGhlIG5leHQgcGFydCwgaW4gY2hhcHRlciBvbiBbbGluZWFyIHJlZ3Jlc3Npb25dKCNvbHMpLiAKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSkpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQpgYGAKCkhlcmUsIHlvdSBzaG91bGQgYmUgYWJsZSB0byBmdWxseSB1bmRlcnN0YW5kIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gbG9jYWwgYW5kIGdsb2JhbCBhZXN0aGV0aWMgbWFwcGluZ3MgbWVudGlvbmVkIFtlYXJsaWVyIGluIHRoZSBjaGFwdGVyXSgjdGhlLXBsb3R0aW5nLXN5bnRheCkuIE5vdGljZSB0aGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHByb3ZpZGluZyB0aGUgYWVzdGhldGljIG1hcHBpbmcgYXQgdGhlIGdsb2JhbCBsZXZlbCAoaS5lLiB0byB0aGUgYGdncGxvdCgpYCBmdW5jdGlvbiBjYWxsKS4uLjoKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSwgY29sb3IgPSByYW5rKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fc21vb3RoKG1ldGhvZCA9ICdsbScpCmBgYAoKLi4uIGFuZCBqdXN0IHRvIHRoZSBgZ2VvbV9wb2ludCgpYC4gCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpKSArIAogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gcmFuaykpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQpgYGAKCkluIHRoZSBmb3JtZXIgY2FzZSwgdGhlIGBjb2xvciA9IHNleGAgYXJndW1lbnQgaXMgdXNlZCBieSBib3RoIGBnZW9tX3BvaW50YCBhbmQgYGdlb21fbGluZSgpYCwgd2hpY2ggbGVhZHMgdG8gXzMgbGluZXMgb2YgZGlmZmVyZW50IGNvbG9ycyBiZWluZyBmaXR0ZWQgZm9yIGVhY2ggb2YgdGhlIGdyb3VwcyBzZXBhcmF0ZWx5Xy4gV2hlbiB0aGUgYGNvbG9yYCBhZXN0aGV0aWMgbWFwcGluZyBpcyBvbmx5IHByb3ZpZGVkIHRvIHRoZSBgZ2VvbV9wb2ludGAgYXQgdGhlIGxvY2FsIGxldmVsLCBvbmUgbGluZSBpcyBmaXR0ZWQgdG8gdGhlIGRhdGEsIGFzIHNwZWNpZmllZCBieSB0aGUgZ2xvYmFsIG1hcHBpbmcuIEJvdGggb2YgdGhlc2UgYXBwcm9hY2hlcyBtYXkgYmUgdXNlZnVsLCBkZXBlbmRpbmcgb24gb3VyIHJlc2VhcmNoIHF1ZXN0aW9uLiBUaGUgY29tcGFyaXNvbiBvZiB0aGVzZSB0d28gcGxvdHMgZnVydGhlciByZXZlYWxzIGFuIGludGVyZXN0aW5nIGJlaGF2aW91ciBpbiBvdXIgZGF0YTogd2hlbiBhbGwgdGhlIG9ic2VydmF0aW9ucyBhcmUgY29uc2lkZXJlZCB0b2VnZXRoZXIsIHRoZXJlIHNlZW1zIHRvIGJlIGEgcG9zaXRpdmUgcmVsYXRpb25zaGlwIGJldHdlZW4geWVhcnMgc2luY2UgUGhEIGFuZCBzYWxhcnkuIEhvd2V2ZXIgd2hlbiB3ZSBsb29rIGF0IHRoZSBncm91cCBsZXZlbCwgdGhlIHJlbGF0aW9uc2hpcCBhcHBlYXJzIHRvIGRpc2FwcGVhciAtIHRoaXMgYmVoYXZpb3VyIGlzIGtub3duIGFzIHRoZSBbU2ltcHNvbidzIFBhcmFkb3hdKCNodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TaW1wc29uJTI3c19wYXJhZG94KS4gSW4gdGhpcyBjYXNlLCBpdCdzIHByaW1hcmlseSB0aGUgcmVzdWx0IG9mIHRoZSByZWxhdGlvbnNoaXAgYmV0d2VlbiB0aGUgcmFuayBhbmQgeWVhcnMgc2luY2UgUGhEIC0gcHJvZmVzc29ycyB3aXRoIGhpZ2hlciByYW5rcyBoYXZlIG1vcmUgZXhwZXJpZW5jZS4gV2hlbiB0aGUgdmFyaWF0aW9uIGluIHRoZSBzYWxhcmllcyB3aXRoaW4gdGhvc2UgZ3JvdXBzIGlzIGNvbnNpZGVyZWQsIHRoZSBleHBlcmllbmNlIG1lYXN1cmVkIGluIHllYXJzIHNlZW1zIHRvIGhhcmRseSBleHBsYWluIGFueSBvZiB0aGUgdmFyaWF0aW9uIGluIGVhcm5pbmdzLgoKIyMjIyBMaW5lIGNvbm5lY3RpbmcgcG9pbnRzIHstfQoKSW4gc29tZSBjYXNlcywgd2UgbWlnaHQgd2FudCB0byBjb25uZWN0IHBvaW50cyBpbiBvdXIgZmlndXJlIHdpdGggYSBsaW5lIHRvIGRlcGljdCBzb21lIHNvcnQgb2YgdHJlbmQgaW4gdGhlIG1lYW4gb2YgYSB2YXJpYWJsZSBkZXBlbmRpbmcgb24gYSBjYXRlZ29yaWNhbCBncm91cCB0aGF0IGhhcyBhIG5hdHVyYWwgb3JkZXJpbmcgLSBmb3IgZXhhbXBsZSwgc3VwcG9zZSB3ZSB3YW50IHRvIHZpc3VhbGx5IGV4YW1pbmluZyBkaWZmZXJlbmNlcyBpbiB0aGUgYXZlcmFnZSBlYXJuaW5ncyBvZiBwcm9mZXNzb3JzIGluIG91ciBkYXRhc2V0IGRlcGVuZGluZyBvbiB0aGVpciB5ZWFycyBpbiBzZXJ2aWNlLgoKRmlyc3Qgd2UgY2FuIG9idGFpbiB0aGUgYXZlcmFnZSBmb3IgZWFjaCBncm91cCB1c2luZyBgZ3JvdXBfYnlgIGFuZCBgc3VtbWFyaXNlYC4KCgoKCmBgYHtyfQpieWFnZSA8LSBTYWxhcmllcyAlPiUKICBtdXRhdGUoeXJzX3JhbmdlID0gY3V0X3dpZHRoKHlycy5zaW5jZS5waGQsIDUsIGJvdW5kYXJ5ID0gNSkpICU+JQogIGdyb3VwX2J5KHlyc19yYW5nZSkgJT4lCiAgc3VtbWFyaXNlKGF2ZyA9IG1lYW4oc2FsYXJ5LCBuYS5ybSA9IFRSVUUpKSAlPiUKICB1bmdyb3VwKCkKYGBgCgpXZSBjYW4gdGhlbiBwbG90IHRoZSBhdmVyYWdlcyB1c2luZyBgZ2VvbV9wb2ludGA6CgpgYGB7cn0KZ2dwbG90KGJ5YWdlLCBhZXMoeCA9IHlyc19yYW5nZSwgeSA9IGF2ZykpICsgCiAgZ2VvbV9wb2ludCgpCmBgYAoKCldoaWxlIHRoZXJlIHNlZW1zIHRvIGJlIHNvbWUgc29ydCBvZiB0cmVuZCBpbiB0aGUgZGF0YSAoZXZlbiB0aG91Z2ggdGhlIGZ1cnRoZXIgcG9pbnRzIGRpdmVydCBmcm9tIGl0LCB3aGljaCBpcyBsaWtlbHkgdGhlIHJlc3VsdCBvZiBzbWFsbCBzYW1wbGUgc2l6ZSBpbiBhIGdpdmVuIGdyb3VwIGxlYWRpbmcgdG8gcmF0aGVyIHVucmVsaWFibGUgc2FtcGxlIGVzdGltYXRlcyksIHRoZSBwbG90IGRvZXMgbm90IGVtcGhhc2l6ZSBpdCBlbm91Z2guIFRvIG1ha2UgaXQgbW9yZSBtZWFuaWdmdWwsIHdlIGNhbiBhZGQgYSBsaW5lIGNvbm5lY3RpbmcgdGhlIHBvaW50cyB3aXRoIGBnZW9tX2xpbmVgLiBOb3RlIHRoYXQgd2UgaGF2ZSB0byBzZXQgdGhlIGBncm91cGAgYWVzdGhldGljIHRvIDEsIHdoaWNoIHByb3ZpZGVzIGBnZ3Bsb3RgIGEgaGludCBvbiBob3cgdG8gY29ubmVjdCB0aGUgcG9pbnQuCgpgYGB7cn0KZ2dwbG90KGJ5YWdlLCBhZXMoeCA9IHlyc19yYW5nZSwgeSA9IGF2ZywgZ3JvdXAgPSAxKSkgKyAKICBnZW9tX3BvaW50KCkgKyAKICBnZW9tX2xpbmUoKQpgYGAKCldlIGNhbiBleHRlbmQgdGhlIGZvbGxvd2luZyBleGFtcGxlIGJ5IGNvbXBhcmluZyB0aGUgc2FtZSB0cmVuZCBkZXBlbmRpbmcgb24gdGhlIHBhaWQgY2xhc3NlcyB0YWtlbjoKCmBgYHtyfQpieWFnZSA8LSBTYWxhcmllcyAlPiUKICBtdXRhdGUoeXJzX3JhbmdlID0gY3V0X3dpZHRoKHlycy5zaW5jZS5waGQsIDUsIGJvdW5kYXJ5ID0gNSkpICU+JQogIGdyb3VwX2J5KHlyc19yYW5nZSwgZGlzY2lwbGluZSkgJT4lCiAgc3VtbWFyaXNlKGF2ZyA9IG1lYW4oc2FsYXJ5LCBuYS5ybSA9IFRSVUUpKSAlPiUKICB1bmdyb3VwKCkKCmdncGxvdChieWFnZSwgYWVzKHggPSB5cnNfcmFuZ2UsIHkgPSBhdmcsIGNvbG9yID0gZGlzY2lwbGluZSwgCiAgICAgICAgICAgICAgICAgIGx0eSA9IGRpc2NpcGxpbmUsIGdyb3VwID0gZGlzY2lwbGluZSkpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX2xpbmUoKQpgYGAKCgoKIyMjIE11bHRpcGxlIHBsb3RzIHstfQoKYGdncGxvdDJgIGFsc28gbWFrZXMgaXQgcG9zc2libGUgdG8gcHV0IG11bHRpcGxlIHBsb3RzIGluIG9uZSBmaWd1cmUgLSB0aGlzIGlzIGluZGVlZCB2ZXJ5IHVzZWZ1bCB1bmRlciBtYW55IGNpcmN1bXN0YW5jZXMsIGFuZCBtYW55IGRhdGEgdmlzdWFsaXphdGlvbiBwcm9mZXNzaW9uYWxzIGNvbnNpZGVyIGl0IGEgZ29vZCBwcmFjdGljZSwgYXMgaXQgZm9sbG93cyB0aGUgcnVsZSBvZiBfc21hbGwgbXVsdGlwbGVzXywgbWFraW5nIHRoZSBkYXRhIG1vcmUgZGlnZXN0aWJsZSB0byB0aGUgcmVhZGVyIGFuZCBhdm9pZGluZyBpbmZvcm1hdGlvbmFsIG92ZXJsb2FkIGluIG9uZSBwbG90LiBBcnJhbmdpbmcgcGxvdHMgaW50byBhIGZpZ3VyZSBjYW4gYmUgZG9uZSBpbiB0d28gd2F5cyAtIGJhc2VkIG9uIGEgdmFsdWUgb2YgYSBjYXRlZ29yaWNhbCB2YXJpYWJsZSAoJ2ZhY2V0aW5nJykgYW5kIGJ5IGFyYml0cmFyaWx5IHB1dHRpbmcgcGxvdHMgaW50byBhIHJlY3Rhbmd1bGFyIGdyaWQuIAoKIyMjIyBGYWNldGluZyB7LX0KCkZhY2V0aW5nIHJlZmVycyB0byBzaW1wbHkgc3BsaXR0aW5nIHRoZSBkYXRhIGJ5IHRoZSB2YWx1ZSBvZiBhIGNhdGVnb3JpY2FsIHZhcmlhYmxlLCBzaW1pbGFyaWx5IHRvIHRoZSB3YXkgYGdyb3VwX2J5YCB0cmVhdHMgdGhlIGRhdGEgd2hlbiBwZXJmb3JtaW5nIHJlZ3VsYXIgbWFuaXB1bGF0aW9uLiBUaGUgc3ludGF4IGlzIHJlbGF0aXZlbHkgc2ltcGxlOiB3ZSBzaW1wbHkgYWRkIGFub3RoZXIgbGF5ZXIgdG8gb3VyIHBsb3QgY2FsbGVkIGBmYWNldF93cmFwYCBhbmQgc3BlY2lmeSB0aGUgZmFjZXRpbmcgdmFyaWFibGUgZm9sbG93aW5nIHRoZSBfdGlsZGVfIHN5bWJvbCBgfmAgLSB0aGlzIGlzIGEgY29tbW9ubHkgdXNlZCBub3RhdGlvbiBpbiBSLCBpbmRpY2F0aW5nIHNvbWUgc29ydCBvZiBkZXBlbmRlbmNlIG9mIG9uZSB2YXJpYWJsZSBvbiBhbm90aGVyIC0geW91IHdpbGwgZW5jb3VudGVyIGl0IGluIHRoZSBuZXh0IHR3byBjaGFwdGVycy4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh5cnMuc2luY2UucGhkLCBzYWxhcnkpKSArIAogIGZhY2V0X3dyYXAofiByYW5rKSArIAogIGdlb21fcG9pbnQoKSArIAogIGdlb21fc21vb3RoKG1ldGhvZCA9ICdsbScpCiAgCmBgYAoKQXMgYSByZXN1bHQgd2UgY2FuIHNlZSB0aGUgc2NhdHRlciBwbG90cyBhbmQgbGluZXMgb2YgYmVzdCBmaXQgaW4gdGhyZWUgc2VwYXJhdGUgcGxvdHMsIGVhY2ggb25lIHdpdGggYW4gYXBwcm9wcmlhdGUgaGVhZGluZyBpbmRpY2F0aW5nIHRoZSBncm91cCBvZiB0aGUgb2JzZXJ2YXRpb25zLiBIb3dldmVyLCB0aGUgb3V0cHV0IGlzIGRpZmZpY3VsdCB0byByZWFkLCBkdWUgdG8gdGhlIGZhY3QgdGhhdCB0aGUgeC1heGlzIGluIHRoZSBwbG90IGlzIGZpeGVkIHRvIHRoZSBzYW1lIGxlbmd0aCBmb3IgZWFjaCBvZiB0aGUgcGxvdHMgLSB0aGlzIGltcHJvdmVzIGNvbXBhcmFiaWxpdHkgb2YgdGhlIGZpZ3VyZXMsIGJ1dCBsaW1pdHMgaXRzIGNsYXJpdHkuIFRoaXMgY2FuIGJlIGNoYW5nZWQgYnkgc3BlY2lmeWluZyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHRvIHRoZSBgZmFjZXRfd3JhcGAgbGF5ZXI6CgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeXJzLnNpbmNlLnBoZCwgc2FsYXJ5KSkgKyAKICBmYWNldF93cmFwKH4gcmFuaywgc2NhbGVzID0gJ2ZyZWVfeCcpICsgCiAgZ2VvbV9wb2ludChhZXMoY29sb3IgPSBzZXgpKSArIAogIGdlb21fc21vb3RoKG1ldGhvZCA9ICdsbScpCmBgYAoKQWdhaW4sIHdlIGNhbiBzZWUgdGhhdCB0aGUgcmVsYXRpb25zaGlwIHNlZW4gaW4gdGhlIG92ZXJhbGwgZGF0YXNldCBkaXNhcHBlYXJzIHdpdGhpbiBlYWNoIG9mIHRoZSBncm91cHMuCgpXZSBjYW4gYWxzbyBmYWNldCB1c2luZyBtb3JlIHRoYW4gb25lIHZhcmlhYmxlIGFuZCBhcnJhbmdlIHRoZSBmaWd1cmVzIGludG8gYSBncmlkIHZpYSBhIHR3byBkaW1lbnNpb25hbCBncm91cGluZy4gRm9yIGV4YW1wbGUsIHN1cHBvc2Ugd2Ugd2FudCB0byBldmFsdWF0ZSB0aGUgZGlzdHJpYnV0aW9uIG9mIHRoZSBleHBlcmllbmNlIHdpaHRpbiBlYWNoIGNvbWJpbmF0aW9uIG9mIHJhbmsgYW5kIGRpc2NpcGxpbmUgb2YgdGhlIGluZGl2aWR1YWxzLiBUaGlzIGNhbiBiZSBhY2hpZXZlZCBieSB1c2luZyB0aGUgYGZhY2V0X2dyaWRgIGxheWVyLgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkKSkgKyAKICBmYWNldF9ncmlkKGRpc2NpcGxpbmUgfiByYW5rKSArCiAgZ2VvbV9oaXN0b2dyYW0oKQpgYGAKCgoKSW4gaGVyZSwgd2UgY2FuIHNlZSB0aGF0IHByb2Zlc3NvcnMgaW4gdGhlb3JldGljYWwgZGlzY2lwbGluZXMgc2VlbSB0byBoYXZlIHdvcmtlZCBsb25nZXIgb24gYXZlcmFnZSwgaG93ZXZlciB0aGUgcmFuZ2Ugb2YgdGhlIHZhbHVlcyBpcyBjb21wYXJhYmxlIGluIGJvdGggY2FzZXMuIFRoZXJlIGFsc28gYXBwZWFycyB0byBiZSBtb3JlIEFzc2lzdGFudCBQcm9mZXNzb3JzIGFuZCBBc3NvY2lhdGUgUHJvZmVzc29ycyBpbiB0aGUgYXBwbGllZCBkZXBhcnRtZW50cywgd2l0aCBubyBzaWdpbmlmaWNhbnQgZGlmZmVyZW5jZXMgaW4gZ2VuZGVyLiBTaW1pbGFyIGFuYWx5c2lzIGFwcGxpZWQgdG8gZWFybmluZ3MsIGhvd2V2ZXIsIHJldmVhbHMgdGhhdCB0aGUgZWFybmluZ3Mgc2VlbSB0byBiZSBoaWdoZXIgYXQgZWFjaCBsZXZlbCBpbiB0aGUgYXBwbGllZCBkZXBhcnRtZW50cy4KCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0gc2FsYXJ5KSkgKyAKICBmYWNldF9ncmlkKGRpc2NpcGxpbmUgfiByYW5rKSArCiAgZ2VvbV9oaXN0b2dyYW0oKQpgYGAKCgoKIyMjIyBQbG90dGluZyBpbiBhIGdyaWQgey19CgpTb21ldGltZXMsIHdlIHdhbnQgdG8gbWFrZSBvdXIgZmlndXJlIGFycmFuZ2VtZW50IG1vcmUgY3VzdG9taXplZCwgbm90IG5lY2Vzc2FyaWx5IGFycmFuZ2VkIGluIGFjY29yZGFuY2Ugd2l0aCBvdXIgdmFyaWFibGUuIEZvciBleGFtcGxlLCB3ZSBtYXkgd2FudCB0byBkZXBpY3QgYSBjb25zaW5jZSBzdW1tYXJ5IG9mIHRoZSBtb3N0IGltcG9ydGFudCBvZiBvdXIgZmluZGluZ3MgaW4gb25lIDJ4MiBwbG90LiBUbyBkbyB0aGlzLCB3ZSBjYW4gdXNlIHRoZSBgcGxvdF9ncmlkYCBmdW5jdGlvbiBmcm9tIHRoZSBgY293cGxvdGAgcGFja2FnZSAod2hpY2gsIGFzIGFsd2F5cywgbmVlZHMgdG8gYmUgaW5zdGFsbGVkIGZpcnN0KS4gCgpgYGB7ciBtZXNzYWdlPUZBTFNFfQpsaWJyYXJ5KGNvd3Bsb3QpCmBgYAoKVG8gZG8gYXJyYW5nZSB0aGUgcGxvdHMgaW4gYW4gYXJiaXRyYXJ5IHJlY3Rhbmd1bGFyIGdyaWQsIHdlIGZpcnN0IG5lZWQgdG8gY3JlYXRlIGVhY2ggb2Ygb3VyIHBsb3RzIGFzIGEgc2VwYXJhdGUgYGdncGxvdGAgb2JqZWN0LiBUbyBhdm9pZCByZXBldGl0aW9uLCBob3dldmVyLCBpdCdzIGJlc3QgdG8gZmlyc3QgY3JlYXRlIGEgYmFzaWMgb2JqZWN0IGFuZCB0aGVuIGFkZCBuZXcgbGF5ZXJzIHRvIGl0IGFuZCBzYXZlIGl0IHVuZGVyIHNlcGFyYXRlIG5hbWVzLgoKYGBge3J9CnBsdCA8LSBnZ3Bsb3QoU2FsYXJpZXMsIGFlcyhmaWxsID0gZGlzY2lwbGluZSwgY29sb3IgPSBkaXNjaXBsaW5lKSkKcGx0X2hpc3RfcyA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSBzYWxhcnkpLCBhbHBoYSA9IDAuMykKcGx0X2hpc3RfeSA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSB5cnMuc2luY2UucGhkKSwgYWxwaGEgPSAwLjMpCnBsdF9iYXIgPC0gcGx0ICsgZ2VvbV9iYXIoYWVzKHkgPSByYW5rKSkKcGx0X3NjdCA8LSBwbHQgKyBnZW9tX3BvaW50KGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSkpICsKICBnZW9tX3Ntb290aChhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpLCBtZXRob2QgPSAnbG0nKQpwbG90X2dyaWQocGx0X3NjdCwgcGx0X2hpc3RfcywgcGx0X2hpc3RfeSwgcGx0X2JhcikKYGBgCgoKCiMjIyBDdXN0b21pemluZyBwbG90cyB7LX0KCk5vdGUgdGhhdCBpbiBhIGxvdCBvZiB0aGUgY2FzZXMgYWJvdmUsIHRoZSBwbG90cyB3ZXJlIGZhciBmcm9tIHB1YmxpY2F0aW9uIHF1YWxpdHkgLSB3aGlsZSB0aGV5IGFsbG93ZWQgdG8gZ2V0IGFuIG92ZXJ2aWV3IG9mIHRoZSBkYXRhLCB0aGV5IGtlcHQgdGhlIG9yaWdpbmFsIHZhcmlhYmxlIG5hbWVzIG9uIHRoZSBheGVzIGFuZCBoYWQgaXNzdWVzIHdpdGggYXhpcyB0aWNrIGxhYmVscyBvdmVybGFwcGluZywgYW1vbmdzdCBvdGhlciB0aGluZ3MuIEFsbCB0aG9zZSBpc3N1ZXMgY2FuIGJlIGZpeGVkIHdpdGggZ2dwbG90J3MgY3VzdG9taXphdGlvbiBjYXBhYmlsaXRpZXMuCgpGb3Igc3RhcnRldHMsIGxldCdzIGNvbnNpZGVyIG9uZSBvZiB0aGUgc2NhdHRlciBwbG90cyB3ZSBjcmVhdGVkIGVhcmxpZXI6CgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnksIGNvbG9yID0gcmFuaykpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKQpgYGAKCkl0IHdvdWxkIGJlIHVzZWZ1bCB0byBtYWtlIHRoZSB2YXJpYWJsZSBuYW1lcyBtb3JlIGZvcm1hbCBvbiB0aGUgcGxvdC4gVGhpcyBjYW4gYmUgZG9uZSB1c2luZyB0aGUgYGxhYnNgIGxheWVyLCB1c2VkIHRvIHNwZWNpZnkgbGFiZWxzOgoKYGBge3J9CmdncGxvdChTYWxhcmllcywgYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5LCBjb2xvciA9IHJhbmspKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykgKwogICNhZGQgYXhlcyBsYWJlbHMKICBsYWJzKHggPSAnWWVhcnMgc2luY2UgUGhEJywgeSA9ICdTYWxhcnkgaW4gVVNEJykKYGBgCgpUaXRsZSBvZiB0aGUgcGxvdCBjYW4gYWxzbyBiZSBzcGVjaWZpZWQgdXNpbmcgdGhlIGBnZ3RpdGxlYCBmdW5jdGlvbjoKCmBgYHtyfQpnZ3Bsb3QoU2FsYXJpZXMsIGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSwgY29sb3IgPSByYW5rKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fc21vb3RoKG1ldGhvZCA9ICdsbScpICsKICAjYWRkIGF4ZXMgbGFiZWxzCiAgbGFicyh4ID0gJ1llYXJzIHNpbmNlIFBoRCcsIHkgPSAnU2FsYXJ5IGluIFVTRCcpICsgCiAgI2FkZCB0aXRsZQogIGdndGl0bGUoJ1NhbGFyaWVzIG9mIFVTIGNvbGxlZ2UgcHJvZmVzc29ycycpCmBgYAoKCkZ1cnRocmVtb3JlLCB3ZSBjYW4gY3VzdG9taXplIHRoZSBsZWdlbmQgbGFiZWxzIGFzIHdlbGwuIFRocyBpcyBkb25lIHVzaW5nIHRoZSBgc2NhbGVfY29sb3JfZGlzY3JldGVgIGxheWVyLCB3aGljaCBhcHBsaWVzIG1hbnVhbCBjaGFuZ2VzIHRvIHRoZSBgY29sb3JgIGFlc3RoZXRpYyB3ZSBzcGVjaWZpZWQgd2hlbiBpbml0aWFsaXppbmcgdGhlIGdncGxvdCBvYmplY3QuCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnksIGNvbG9yID0gcmFuaykpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKSArCiAgI2FkZCBheGVzIGxhYmVsczoKICBsYWJzKHggPSAnWWVhcnMgc2luY2UgUGhEJywgeSA9ICdTYWxhcnkgaW4gVVNEJykgKwogICNhZGQgdGl0bGUKICBnZ3RpdGxlKCdTYWxhcmllcyBvZiBVUyBjb2xsZWdlIHByb2Zlc3NvcnMnKSArCiAgI3JlbmFtZSBsZWdlbmQgZWxlbWVudHM6CiAgc2NhbGVfY29sb3JfZGlzY3JldGUobmFtZSA9ICdSYW5rJywgCiAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0gYygnQXNzdC4gUHJvZi4nLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdBc3NvYy4gUHJvZi4nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ1Byb2YnKSkKYGBgCgpXZSBjYW4gYWxzbyBjdXN0b21pemUgdGhlIGxlZ2VuZCB1c2luZyB0aGUgYHRoZW1lYCBsYXllci4gVGhpcyBsYXllciBpcyB1c2VkIGZvciBjdXN0b21pemF0aW9uIG9mIG1ham9yaXR5IG9mIHBsb3QgZWxlbWVudHMsIHN1Y2ggYXMgdGhlIGxlZ2VuZCwgdGV4dCBhbmQgdGhlIGF4ZXMuCgpgYGB7cn0KZ2dwbG90KFNhbGFyaWVzLCBhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnksIGNvbG9yID0gcmFuaykpICsgCiAgZ2VvbV9wb2ludCgpICsKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKSArCiAgI2FkZCBheGVzIGxhYmVsczoKICBsYWJzKHggPSAnWWVhcnMgc2luY2UgUGhEJywgeSA9ICdTYWxhcnkgaW4gVVNEJykgKwogICNhZGQgdGl0bGUKICBnZ3RpdGxlKCdTYWxhcmllcyBvZiBVUyBjb2xsZWdlIHByb2Zlc3NvcnMnKSArCiAgI3JlbmFtZSBsZWdlbmQgZWxlbWVudHM6CiAgc2NhbGVfY29sb3JfZGlzY3JldGUobmFtZSA9ICdSYW5rJywgCiAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0gYygnQXNzdC4gUHJvZi4nLCdBc3NvYy4gUHJvZi4nLCdQcm9mJykpICsKICAjY3VzdG9taXplIHRoZSBwbG90OgogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICdib3R0b20nLCAjbW92ZSBsZWdlbmQgdG8gdGhlIGJvdHRvbQogICAgICAgIGxlZ2VuZC5iYWNrZ3JvdW5kID0gZWxlbWVudF9yZWN0KGZpbGwgPSAnbGlnaHRibHVlJyksICNsZWdlbmQgYmFja2dyb3VuZAogICAgICAgIGxlZ2VuZC50ZXh0ID0gZWxlbWVudF90ZXh0KHNpemUgPSA4LCBmYWNlID0gJ2l0YWxpYycpLCAjbGVnZW5kIGZvbnQKICAgICAgICBsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCkpICNyZW1vdmUgdGl0bGUKYGBgCgpBcyBzZWVuIGFib3ZlLCB0aGUga2V5d29yZCBhcmd1bWVudHMgb2YgYHRoZW1lYCB1c3VhbGx5IHRha2UgdHdvIGZvcm1zIC0gYSBzdHJpbmcsIHN1Y2ggYXMgYGxlZ2VuZC5wb3NpdGlvbiA9ICdib3R0b20nYCwgb3IgYGVsZW1lbnRfKmAgdGhlbWUgZWxlbWVudHMuIFlvdSBjYW4gcmVhZCBtb3JlIGFib3V0IHRoZW0gaW4gYD9lbGVtZW50X2JsYW5rYCwgaG93ZXZlciB0aGUgYmFzaWMgbG9naWMgaXMgYXMgZm9sbG93cyAtIHlvdSB1c2UgYGVsZW1lbnRfdGV4dCgpYCB0byBzcGVjaWZ5IF90ZXh0IGNoYXJhY3RlcmlzdGljc18gLSBzdWNoIGFzIHRoZSBmb250LCBzaXplLCBjb2xvciBvciBmYWNlIG9mIHRoZSBfdGV4dCBlbGVtZW50cyBvZiB0aGUgcGxvdF8sIHN1Y2ggYXMgbGVnZW5kIGxhYmVscyBvciBheGlzIHRpY2tzLCBgZWxlbWVudF9yZWN0YCB0byBzcGVjaWZ5IHRoZSBjaGFyYWN0ZXJpc3RpY3Mgb2YgX3JlY3RhbmdsZSBlbGVtZW50c18sIHN1Y2ggYXMgYmFja2dyb3VuZHMgYW5kIGBlbGVtZW50X2JsYW5rYCB0byBtYWtlIGEgZ2l2ZW4gZWxlbWVudHMgZGlzYXBwZWFyIGZyb20gdGhlIHBsb3QgZW50aXJlbHkuCgoKSW4gc29tZSBjYXNlcyBvdXIgYXhpcyBsYWJlbHMgYXJlIHR3byBsb25nLCB3aGljaCBjYW4gYmUgcHJvYmxlbWF0aWMgZXNwZWNpYWxseSBpbiB0aGUgeCBheGlzLCBhcyBpdCByZXN1bHRzIGluIG92ZXJsYXBzIGFuZCBtYWtlcyBpbXBvc3NpYmxlIHRvIHJlYWQgdGhlbS4gQSBjb21tb24gc29sdXRpb24gaXMgdG8gcm90YXRlIHRoZSBsYWJlbHMgYnkgYSBjZXJ0YWluIGFuZ2xlLiBUaGlzIGNhbiBiZSBkb25lIHVzaW5nIHRoZSBgYXhpcy50ZXh0LnhgIGFyZ3VtZW50IHdpdGggYGVsZW1lbnRfdGV4dChyb3RhdGlvbiA9IG4pYCwgd2hlcmUgYG5gIGFyZSB0aGUgbWFnbml0dWRlIG9mIGNvdW50ZXItY2xvY2t3aXNlIHJvdGF0aW9uLiBUaGUgdmVydGljYWwgYW5kIGhvcml6b250YWwganVzdGlmaWNhdGlvbiBjYW4gaGUgYWRqdXN0ZWQgdXNpbmcgdGhlIGB2anVzdGAgYW5kIGBoanVzdGAgYXJndW1lbnRzIHJlc3BlY3RpdmVseS4KCgpgYGB7cn0KYnlhZ2UgPC0gU2FsYXJpZXMgJT4lCiAgbXV0YXRlKHlyc19yYW5nZSA9IGN1dF93aWR0aCh5cnMuc2luY2UucGhkLCA1LCBib3VuZGFyeSA9IDUpKSAlPiUKICBncm91cF9ieSh5cnNfcmFuZ2UsIGRpc2NpcGxpbmUpICU+JQogIHN1bW1hcmlzZShhdmcgPSBtZWFuKHNhbGFyeSwgbmEucm0gPSBUUlVFKSkgJT4lCiAgdW5ncm91cCgpCgpnZ3Bsb3QoYnlhZ2UsIGFlcyh4ID0geXJzX3JhbmdlLCB5ID0gYXZnLCBjb2xvciA9IGRpc2NpcGxpbmUsIAogICAgICAgICAgICAgICAgICBsdHkgPSBkaXNjaXBsaW5lLCBncm91cCA9IGRpc2NpcGxpbmUpKSArIAogIGdlb21fcG9pbnQoKSArCiAgZ2VvbV9saW5lKCkgKwogIGxhYnMoeCA9ICdZZWFycyBzaW5jZSBQaEQnLCB5ID0gJ0F2ZXJhZ2UgZWFybmluZ3MnKSArCiAgdGhlbWUoYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoYW5nbGUgPSA0NSwgdmp1c3QgPSAwLjksIGhqdXN0ID0gMS4wKSkKYGBgCgpGaW5hbGx5LCB3ZSBjYW4gbWFrZSBjaGFuZ2VzIHRvIHRoZSBvdmVyYWxsIHBsb3QgYnkgYXBwbHlpbmcgdGhlbWVzIHRvIHRoZSBlbnRpcmUgcGxvdC4gU29tZSBvZiB0aGVtIGFyZSBidWlsdCBpbnRvIHRoZSBgZ2dwbG90YCBwYWNrYWdlOyBtb3JlIGNvbWUgd2l0aCBgY293cGxvdGAgb3IgYGdncHVicmAuIFlvdSBjYW4gZmluZCBjb3VwbGUgZXhhbXBsZXMgYmVsb3csIGJ1dCBmZWVsIGZyZWUgdG8gZXhwbG9yZSB0aGVtIG9ubGluZS4KCmBgYHtyfQpwbHQgPC0gZ2dwbG90KGJ5YWdlLCBhZXMoeCA9IHlyc19yYW5nZSwgeSA9IGF2ZywgY29sb3IgPSBkaXNjaXBsaW5lLCAKICAgICAgICAgICAgICAgICAgbHR5ID0gZGlzY2lwbGluZSwgZ3JvdXAgPSBkaXNjaXBsaW5lKSkgKyAKICBnZW9tX3BvaW50KCkgKwogIGdlb21fbGluZSgpICsgCiAgbGFicyh4ID0gJ1llYXJzIHNpbmNlIFBoRCcsIHkgPSAnQXZlcmFnZSBlYXJuaW5ncycpCmBgYAoKYGBge3J9CnBsdCArCiAgdGhlbWVfYncoKSArIAogIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC44LCBoanVzdCA9IDEuMCkpCmBgYAoKCmBgYHtyfQpwbHQgKwogIHRoZW1lX2J3KCkgKyAKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQpgYGAKCmBgYHtyfQpwbHQgKwogIHRoZW1lX2NsYXNzaWMoKSArIAogIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC44LCBoanVzdCA9IDEuMCkpCmBgYAoKCmBgYHtyfQpwbHQgKwogIHRoZW1lX2Nvd3Bsb3QoKSArIAogIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC44LCBoanVzdCA9IDEuMCkpCmBgYAoKCmBgYHtyfQpwbHQgKwogIHRoZW1lX21pbmltYWwoKSArIAogIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIHZqdXN0ID0gMC44LCBoanVzdCA9IDEuMCkpCmBgYAoKKipOb3RlKiogdGhhdCB0aGUgYHRoZW1lYCBhZGp1c3RtZW50cyBtdXN0IGJlIHNwZWNpZmllZCBhZnRlciBhIHNwZWNpZmljIHRoZW1lIGlzIHNwZWNpZmllZCwgb3Igb3RoZXJ3aXNlIGlmIG92ZXJyaWRlcyB0aGVtLiBZb3UgY2FuIGFsc28gc3BlY2lmeSBhIHRoZW1lIHVwZnJvbnQgZm9yIHlvdXIgZW50aXJlIHNjcmlwdCBieSB1c2luZyBgdGhlbWVfc2V0KClgLgoKYGBge3J9CnRoZW1lX3NldCh0aGVtZV9ncmV5KGJhc2Vfc2l6ZSA9IDEwKSkKcGx0ICsKICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCB2anVzdCA9IDAuOCwgaGp1c3QgPSAxLjApKQpgYGAKCgojIyMgU2F2aW5nIHBsb3RzIHstfQoKU2F2aW5nIHBsb3RzIGNhbiBiZSBkb25lIHVzaW5nIHRoZSBgZ2dzYXZlYCBmdW5jdGlvbjoKCmBgYHtyfQpnZ3NhdmUocGxvdCA9IHBsdCwgZmlsZW5hbWUgPSAnZmlsZXMvdGVzdC5wbmcnLCB3aWR0aCA9IDE1MCwgaGVpZ2h0ID0gMTAwLCB1bml0cyA9ICdtbScpCmBgYAoKCiMjIFN1bW1hcnkgCgotICoqZ2dwbG90KiogaXMgYSBwYXJ0IG9mIHRoZSBgdGlkeXZlcnNlYCBjb2xsZWN0aW9uIGFuZCB0aGUgbW9zdCBwb3B1bGFyIHBsb3R0aW5nIHBhY2thZ2UgaW4gUgoKLSB5b3UgaW5pdGlhbGl6ZSBhIGdncGxvdCBvYmplY3QgdXNpbmcgdGhlIGBnZ3Bsb3QoKWAgZnVuY3Rpb24sIHdpdGggdGhlIGRhdGEgZnJhbWUgeW91IGFyZSBwbGFubmluZyB0byB2aXN1YWxpemUgYXMgdGhlIGZpcnN0IGFyZ3VtZW50IGFuZCB0aGUgYWVzdGhldGljIG1hcHBpbmcgY3JlYXRlZCBieSB0aGUgYGFlcygpYCBmdW5jdGlvbiBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50LgoKLSAqKmFlc3RoZXRpYyBtYXBwaW5ncyoqIGFyZSBjcmVhdGVkIGJ5IHRoZSBgYWVzKClgIGZ1bmN0aW9uLCB3aGljaCBkZWZpbmVzIGNvbm5lY3Rpb25zIGJldHdlZW4gZ3JhcGhpY2FsIGVsZW1lbnRzIG9mIHRoZSBwbG90IGFuZCB0aGUgdmFyaWFibGVzIGZyb20gb3VyIGRhdGEgZnJhbWUuIFRoZSBlbGVtZW50cyB0aGF0IGNhbiBiZSBtYXBwZWQgaW5jbHVkZSB0aGUgeCBhbmQgeSBheGVzLCBjb2xvciwgZmlsbCwgc2hhcGUgb3IgbGluZSB0eXBlLiBUaGUgbWFwcGluZyBjYW4gYmUgY3JlYXRlZCBfZ2xvYmFsbHlfLCBwcm92aWRlZCB0byB0aGUgYGdncGxvdCgpYCBmdW5jdGlvbiBhbmQgX2xvY2FsbHlfLCBieSBwYXNzaW5nIGBhZXMoKWAgdG8gc3BlY2lmaWMgZ2VvbXMuCgotICoqZ2VvbXMqKiBhcmUgY29uc3RpdHVlbnQgZWxlbWVudHMgb2YgZ2dwbG90IG9iamVjdHMuIFRoZXkgYXJlIGRpZmZlcmVudCBncmFwaGljYWwgc3RydWN0dXJlcywgc3VjaCBhcyBoaXN0b2dyYW1zLCBib3hwbG90cyBvciBzY2F0dGVyIHBsb3RzIHRoYXQgY2FuIGJlIGFkZGVkIHRvIGFuIGluaXRpYWxpemVkIGdncGxvdCBvYmplY3QgdXNpbmcgdGhlIGFkZGl0aW9uIG9wZXJhdG9yIGArYC4gRWFjaCBnZW9tIHVzZXMgdGhlIGFlc3RoZXRpYyBtYXBwaW5nIHNwZWNpZmllZCBnbG9iYWxseSwgdW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UgbG9jYWxseS4KCi0gYGZhY2V0X3dyYXBgIGFuZCBgZmFjZXRfZ3JpZGAgZnVuY3Rpb25zIGNhbiBiZSB1c2VkIHRvIHNwbGl0IHBsb3RzIGludG8gc21hbGwgbXVsdGlwbGVzLiBUaGlzIGlzIGRvbmUgdXNpbmcgdGhlIGB+YCB0aWxkZSBvcGVyYXRvciAtIGZvciBleGFtcGxlLCBgZmFjZXRfZ3JpZChzZXggfiByYW5rKWAgd2lsbCBzcGxpdCBvdXIgZmlndXJlIGludG8gYSByZWN0YW5ndWxhciBncmlkIG9mIHBsb3RzIG9mIGFsbCBjb21iaW5hdGlvbnMgb2YgYHNleGAgYW5kIGByYW5rYCB2YXJpYWJsZXMuCgotIHdlIGNhbiBjdXN0b21pemUgZWxlbWVudHMgb2Ygb3VyIHBsb3QsIHN1Y2ggYXMgYXhlcyBsYWJlbHMgdXNpbmcgdGhlIGBsYWJzKClgIGNvbW1hbmQsIGxlZ2VuZCBuYW1lcywgdXNpbmcgdGhlIGBzY2FsZV8qYCBmdW5jdGlvbnMsIGFzIHdlbGwgYXMgb3RoZXIgZWxlbWVudHMgdGhyb3VnaCB0aGUgYHRoZW1lKClgIGxheWVyLCB3aGljaCBtb3N0IG9mIHRoZSB0aW1lIHdvcmtzIHdpdGggYGVsZW1lbnRfKmAgZnVuY3Rpb25zIGFzIGFyZ3VtZW50cwoKLSB3ZSBjYW4gZnVydGhlciBhcHBseSBwcmUtZGVmaW5lZCBjaGFuZ2VzIHRvIG91ciBwbG90cyBieSB1c2luZyB0aGVtZXMsIHN1Y2ggYXMgYHRoZW1lX2J3YCBvciBgdGhlbWVfbWluaW1hbGAuIFRoZXNlIGNhbiBhbHNvIGJlIHNldCBmb3IgdGhlIGVudGlyZSBzZXNzaW9uIHVzaW5nIGB0aGVtZV9zZXQoKWAuIAoKLSBwbG90cyBjYW4gYmUgc2F2ZWQgdmlhIHRoZSBgZ2dzYXZlYCBmdW5jdGlvbi4KCgoKIyMjIEZ1bmN0aW9ucyBsaXN0IHstfQoKCgoKCiMjIEV4ZXJjaXNlcwoKCjEuIENvbnNpZGVyIHRoZSBwbG90IHdlIGhhdmUgY3JlYXRlZCBlYXJsaWVyIHRocm91Z2ggdGhlIHBsb3RfZ3JpZCBmdW5jdGlvbiBmcm9tIHRoZSBjb3dwbG90IHBhY2thZ2UuIFVzZSB5b3VyIGtub3dsZWRnZSBhYm91dCBwbG90IGN1c3RvbWl6YXRpb24gdG8gbWFrZSBpdCBtb3JlIHJlYWRhYmxlLCBmb3IgZXhhbXBsZSBieToKCi0ga2VlcGluZyBvbmx5IG9uZSBsZWdlbmQgZm9yIHRoZSBmaWxsIHZhcmlhYmxlCi0gcm90YXRpbmcgdGhlIGF4aXMgdGljayBsYWJlbHMgaWYgbmVjZXNzYXJ5Ci0gY2hhbmdpbmcgdGhlIGF4ZXMgbGFiZWxzCi0gbWFraW5nIHRoZSBwb2ludHMgaW4gdGhlIHNjYXR0ZXIgcGxvdCBzbWFsbGVyCi0gYWRkaW5nIGEgdGhlbWUKClNhdmUgdGhlIGZpbmFsIGZpZ3VyZSB0byBhIHBuZyBmaWxlLgoKWW91IGNhbiBmaW5kIHRoZSBpbml0aWFsIGNvZGUgYmVsb3c6CgpgYGB7cn0KcGx0IDwtIGdncGxvdChTYWxhcmllcywgYWVzKGZpbGwgPSBkaXNjaXBsaW5lLCBjb2xvciA9IGRpc2NpcGxpbmUpKQpwbHRfaGlzdF9zIDwtIHBsdCArIGdlb21fZGVuc2l0eShhZXMoeCA9IHNhbGFyeSksIGFscGhhID0gMC4zKQpwbHRfaGlzdF95IDwtIHBsdCArIGdlb21fZGVuc2l0eShhZXMoeCA9IHlycy5zaW5jZS5waGQpLCBhbHBoYSA9IDAuMykKcGx0X2JhciA8LSBwbHQgKyBnZW9tX2JhcihhZXMoeSA9IHJhbmspKQpwbHRfc2N0IDwtIHBsdCArIGdlb21fcG9pbnQoYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5KSkgKwogIGdlb21fc21vb3RoKGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSksIG1ldGhvZCA9ICdsbScpCnBsb3RfZ3JpZChwbHRfc2N0LCBwbHRfaGlzdF9zLCBwbHRfaGlzdF95LCBwbHRfYmFyKQpgYGAKCgoKYGBge3IgZWNobz1GQUxTRSwgaW5jbHVkZSA9IEZBTFNFfQojQU5TV0VSCnRoZW1lX3NldCh0aGVtZV9idygpKQpwbHQgPC0gZ2dwbG90KFNhbGFyaWVzLCBhZXMoZmlsbCA9IGRpc2NpcGxpbmUsIGNvbG9yID0gZGlzY2lwbGluZSkpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAnbm9uZScpCgoKcGx0X2hpc3RfcyA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSBzYWxhcnkpLCBhbHBoYSA9IDAuMykgKwogIHhsYWIoJ1NhbGFyeSBpbiBVU0QnKQoKcGx0X2hpc3RfeSA8LSBwbHQgKyBnZW9tX2RlbnNpdHkoYWVzKHggPSB5cnMuc2luY2UucGhkKSwgYWxwaGEgPSAwLjMpICsKICB4bGFiKCdZZWFycyBzaW5jZSBQaEQnKQoKcGx0X2JhciA8LSBwbHQgKyBnZW9tX2JhcihhZXMoeSA9IHJhbmspKSArCiAgeGxhYihOVUxMKSArIAogIHNjYWxlX3lfZGlzY3JldGUobGFiZWxzID0gYygnUHJvZi4nLCAnQXNzb2MuIFByb2YnLCAnQXNzdC4gUHJvZicpKSArIAogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICdib3R0b20nKQoKCnBsdF9zY3QgPC0gcGx0ICsgZ2VvbV9wb2ludChhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpLCBzaXplID0gMC43KSArCiAgZ2VvbV9zbW9vdGgoYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5KSwgbWV0aG9kID0gJ2xtJykgKwogIGxhYnMoeCA9ICdZZWFycyBzaW5jZSBQaEQnLCB5ID0gJ1NhbGFyeSBpbiBVU0QnKQoKCmZpbmFsIDwtIHBsb3RfZ3JpZChwbHRfc2N0LCBwbHRfaGlzdF9zLCBwbHRfaGlzdF95LCBwbHRfYmFyKQpmaW5hbApnZ3NhdmUocGxvdCA9IGZpbmFsLCBmaWxlID0gJ2ZpbGVzL2dyaWQucG5nJykKYGBgCgoKRm9yIHRoZSByZW1haW5kZXIgb2YgbmV4dCBleGVyaWNzZXMsIHlvdSB3aWxsIG5lZWQgdG8gbG9hZCB0aGUgYGdhcG1pbmRlcmAgZGF0YXNldCB3aGljaCBpcyBhIHBhcnQgb2YgdGhlIGBnYXBtaW5kZXJgIHBhY2thZ2UuCgpgYGB7cn0KZGF0YShnYXBtaW5kZXIsIHBhY2thZ2UgPSAnZ2FwbWluZGVyJykKYGBgCgoKMi4gR2V0IGFuIG92ZXJ2aWV3IG9mIHRoZSBkYXRhc2V0LiBIb3cgbWFueSB2YXJpYWJsZXMgYW4gb2JzZXJ2YXRpb25zIGFyZSB0aGVyZT8gSG93IG1hbnkgdW5pcXVlIHZhbHVlcyBkb2VzIGVhY2ggdmFyaWFibGUgaGF2ZT8KCgpgYGB7ciBlY2hvPUZBTFNFLCBpbmNsdWRlID0gRkFMU0V9CmdsaW1wc2UoZ2FwbWluZGVyKQojQU5TV0VSCnNhcHBseShnYXBtaW5kZXIsIGZ1bmN0aW9uKHgpIGxlbmd0aCh1bmlxdWUoeCkpKQoKIyBvciB1c2luZyB2YXBwbHkKdmFwcGx5KGdhcG1pbmRlciwgZnVuY3Rpb24oeCkgbGVuZ3RoKHVuaXF1ZSh4KSksIGludGVnZXIoMSkpCgojIG9yIGluIHRpZHl2ZXJzZSBzdHlsZQptYXBfaW50KGdhcG1pbmRlciwgbl9kaXN0aW5jdCkKYGBgCgozLiBWaXN1YWxpemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBwZXIgY2FwaXRhIGdkcCBhbmQgbGlmZSBleHBlY3RhbmN5IGluIDIwMDcgdXNpbmcgYSBzY2F0dGVyIHBsb3QuIEluY2x1ZGUgX29uZV8gbGluZSBvZiBiZXN0IGZpdCBhbmQgY29sb3IgdGhlIG1hcmtlcnMgYnkgY29udGluZW50LiBNYWtlIHN1cmUgdGhlIHBsb3QgaGFzIGFwcHJvcHJpYXRlIGF4aXMgbGFiZWxzLiBEb2VzIHRoZSBsaW5lIG9mZmVyIGEgZ29vZCBmaXQgdG8gdGhlIGxpbmU/IFdoYXQga2luZCBvZiBjdXJ2ZSB3b3VsZCBiZXR0ZXI/IFdoeT8gCgpgYGB7ciBlY2hvPUZBTFNFLCBpbmNsdWRlID0gRkFMU0V9CiNBTlNXRVIKZ2FwMjAwNyA8LSBnYXBtaW5kZXIgJT4lIGZpbHRlcih5ZWFyID09IDIwMDcpCgpnZ3Bsb3QoZ2FwMjAwNywgYWVzKHggPSBnZHBQZXJjYXAsIHkgPSBsaWZlRXhwKSkgKyAKICBnZW9tX3BvaW50KGFlcyhjb2xvciA9IGNvbnRpbmVudCkpICsgCiAgZ2VvbV9zbW9vdGgobWV0aG9kID0gJ2xtJykgKwogIGxhYnMoeCA9ICJHRFAgcGVyIGNhcGl0YSIsIHkgPSAiTGlmZSBleHBlY3RhbmN5IGF0IGJpcnRoIikgKwogIGdndGl0bGUoIkdsb2JhbCBkZXZlbG9wbWVudCBpbiAyMDA3IikKYGBgCgo0LiBFeGFtaW5lIHRoZSBjb3VudHJpZXMgd2hpY2ggYXBwZWFyIHRvIGRpdmVydCBmcm9tIHRoZSBvdmVyYWxsIHRyZW5kIGluIHRoZSBwbG90IHlvdSBjcmVhdGVkIGluIHRoZSBwcmV2aW91cyBleGVyY2lzZS4KCmBgYHtyIGVjaG89RkFMU0UsIGluY2x1ZGUgPSBGQUxTRX0KI0FOU1dFUgpnYXAyMDA3ICU+JSBmaWx0ZXIoZ2RwUGVyY2FwID4gNTAwMCwgbGlmZUV4cCA8IDYwKQpgYGAKCjUuIFZpc3VhbGl6ZSB0aGUgZGlmZmVyZW5jZSBpbiBHRFAgcGVyIGNhcGl0YSBkaXN0cmlidXRpb24gYmV0d2VlbiBjb250aW5lbnRzIChpbiAyMDA3KS4gVXNlIGF0IGxlYXN0IHR3byBkaWZmZXJlbnQgbWV0aG9kcyBhbmQgY29tcGFyZSB0aGVpciBhZHZhbnRhZ2VzIGFuZCBkaXNhZHZhbnRhZ2VzLiBSZW1lbWJlciBhYm91dCBhcHByb3ByaWF0ZSBsYWJlbHMgYW5kIHRpdGxlIQoKYGBge3IgZWNobz1GQUxTRSwgaW5jbHVkZSA9IEZBTFNFfQojQU5TV0VSCmdncGxvdChnYXAyMDA3LCBhZXMoeCA9IGNvbnRpbmVudCwgeSA9IGdkcFBlcmNhcCkpICsgCiAgZ2VvbV9ib3hwbG90KCkgKyAKICBsYWJzKHggPSAnR0RQIHBlciBjYXBpdGEnLCB5ID0gJ0NvbnRpbmVudCcpICsgCiAgZ2d0aXRsZSgnRGlmZmVyZW5jZXMgaW4gR0RQJykKYGBgCgoKCgoKCgoKCgoKNi4gQ29tcGFyZSB0aGUgR0RQIHBlciBjYXBpdGEgb2YgZWFjaCBjb250aW5lbnQgaW4gZWFjaCB5ZWFyIHVzaW5nIGEgY29ubmVjdGVkIHNjYXR0ZXIgcGxvdC4gQmUgY2FyZWZ1bCAtIHRha2luZyB0aGUgZ3JvdXAgYXZlcmFnZSBvZiBlYWNoIGNvbnRpbmVudCBpcyBpbmNvcnJlY3QsIGFzIHRoZSBwb3B1bGF0aW9uIHNpemVzIGRpZmZlci4gWW91IGNhbiB0cnkgcHJlc2VudGluZyB0aGUgdmFsdWVzIG9uIGEgbG9nIHNjYWxlIHVzaW5nIGBzY2FsZV95X2xvZzEwKClgIHRvIG1ha2UgdGhlIGxpbmVzIG1vcmUgdmlzaWJsZS4KCgoKCjcuIFByZXBhcmUgdGhlIHNhbWUgcGxvdCwgYnV0IHRoaXMgdGltZSB2aXN1YWxpemluZyB0aGUgYXZlcmFnZSBHRFAgZ3Jvd3RoIHJhdGUgZm9yIGVhY2ggb2YgdGhlIGNvbnRpbmVudHMuIEhJTlQ6IHVzZSB0aGUgYGdyb3VwYnkoKWAgJT4lIGBtdXRhdGUoKWAgcm91dGluZSB3aXRoIHRoZSBgbGFnKClgIGZ1bmN0aW9uIGFzIGluIHRoZSBwcmV2aW91cyBjaGFwdGVyLgoKCgoKCipUaGUgc29sdXRpb25zIGZvciB0aGUgZXhlcmNpc2VzIHdpbGwgYmUgYXZhaWxhYmxlIGhlcmUgb24gYHIgY29uZmlnJGRhdGFfdmlzdWFsaXphdGlvbmAuKgoKCgoA');
        if (!response.ok) throw new Error('Network response failed');
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = '07-data_visualization.Rmd';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.dispatchEvent(new MouseEvent('click'));
        document.body.removeChild(a);
        setTimeout(() =&gt; {
          window.URL.revokeObjectURL(blobUrl);
        }, 100);
        return false;
      } catch (error) {
        console.error('Download failed:', error);
        alert('Download failed. Please try again.');
      }
    }
    downloadFile(event);
  "><i class="fa fa-save"></i> Chapter markdown</button>
<div id="content-5" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Content<a class="anchor" aria-label="anchor" href="#content-5"><i class="fas fa-link"></i></a>
</h2>
<p>The final chapter in this part focuses on data visualization. While some techniques for presenting data were already described in the chapter on <a href="exploratory.html#exploratory">Exploratory data analysis</a>, this chapter will cover the topic in more depth and introduce you to the most commonly used tool for data visualization in R - the <code>ggplot2</code> package. The main advantage of <code>ggplot2</code> in comparison with some of the out-of-the-box plotting capabilities coming with R is the simplicity of creating relatively complex and nice looking plot, which would often take much longer to produce with R base graphics.</p>
<p>The <code>ggplot2</code> package is a part of <code>tidyverse</code>, which was introduced in the <a href="dplyr.html#dplyr">previous chapter</a>, and it is often useful in conjunction with some of the data manipulation tools offered by other <code>tidyverse</code> packages. You can load the library directly:</p>
<div class="sourceCode" id="cb535"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>However you may also attach it along with other <code>tidyverse</code> packages:</p>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<p>We will also load the <code>salaries</code> dataset, which describes the salaries of US professors. To do this, you will need to install the package using the <code>carData</code> package using the <code>install.packages</code> function:</p>
<div class="sourceCode" id="cb537"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">'carData'</span><span class="op">)</span></span></code></pre></div>
<p>To load the data, simpy execute the below code. The dataframe will be attached to your global environment.</p>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'Salaries'</span>, package <span class="op">=</span> <span class="st">'carData'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Salaries</span><span class="op">)</span></span></code></pre></div>
<pre><code>Rows: 397
Columns: 6
$ rank          &lt;fct&gt; Prof, Prof, AsstProf, Prof, Prof, AssocProf, Prof, Prof, Prof, Prof, AssocP…
$ discipline    &lt;fct&gt; B, B, B, B, B, B, B, B, B, B, B, B, B, B, B, B, B, A, A, A, A, A, A, A, A, …
$ yrs.since.phd &lt;int&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 12, 19, 38, 37, 39, …
$ yrs.service   &lt;int&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3, 20, 34, 23, 36, 26…
$ sex           &lt;fct&gt; Male, Male, Male, Male, Male, Male, Male, Male, Male, Female, Male, Male, M…
$ salary        &lt;int&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 147765, 119250, 12900…</code></pre>
<p>The data consists of 6 variables, describing academics rank, discipline (A for theoretical and B for applied), experience measured in years in service and years since PhD attainment, the subjects sex and salary. To see more details about the data, use <code><a href="https://rdrr.io/pkg/carData/man/Salaries.html">?carData::Salaries</a></code></p>
<div id="the-plotting-syntax" class="section level3 unnumbered">
<h3>The plotting syntax<a class="anchor" aria-label="anchor" href="#the-plotting-syntax"><i class="fas fa-link"></i></a>
</h3>
<p>Similarily to the other <code>tidyverse</code> tools explored in the previous chapter, ggplot uses its own, original approach to creating plots, which is quite different from what you have previously encouneterd in the exploratory data analysis lesson. To initialize a ggplot object, you <em>always</em> call the <code>ggplot</code> function, specifying the name of your data frame as the first argument.</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-293-1.png" width="672"></div>
<p>As you can see this initiates an empty plot. We then furhter specify the variables we want to associate with the object using the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function. The aes abbreviation stands for aesthetic mappings. It defines bindings between variables in the dataframe specified as the first argument of the ggplot object and aesthetic elements of the object - for example, the x and y axes of the plot, line/point colors and shapes or bar fills. For example, <code>aes(x = absences)</code> can be interpreted as <em>“link the variable absences with the x-axis of this plot”</em>.</p>
<div class="sourceCode" id="cb541"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-294-1.png" width="672"></div>
<p>Now the figure includes an x axis, with some automatically chosen tick locations. The final step is to create an actual plot. This is done by “adding” a so-called <em>geom</em> to the plot skeleton we have created so far. Geoms are simply functions used to create different plot types representing the data associated with a ggplot object through <code>ggplot</code> and <code>aes</code> - for example, <code>geom_histogram</code> is used to create a <a href="exploratory.html#histograms">histogram</a> and <code>geom_boxplot</code> to create a <a href="visualization.html#boxplots">boxplot</a>. Geoms are “added” to the <code>ggplot</code> object using the <code>+</code> operator.</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-295-1.png" width="672"></div>
<p>We can see now that the histogram of the variable appears on the plot. The plot also comes with a message prompting us to manually specify the bin width for the histogram, which can be done through the arguments of the <code>geom</code> function - either by specifying the number of bins through <code>bins</code> or the width of individual bins through <code>binwidth</code>.</p>
<div class="sourceCode" id="cb544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-296-1.png" width="672"></div>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-297-1.png" width="672"></div>
<p>We can also change to colors of the bins as well as their borders:</p>
<div class="sourceCode" id="cb546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5000</span>, fill <span class="op">=</span> <span class="st">'blue'</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-298-1.png" width="672"></div>
<p>As mentioned earlier, the aesthetic characteristics of the plot such as border color or fill can be treated as a representation of the data, not only the visual characteristics of the plot. For example, continuing with the <code>absences</code> example we may see the break ouf of the absences between male and female students, by specifying the <code>fill</code> argument in the aesthetic mapping:</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">5000</span>, color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-299-1.png" width="672"></div>
<p>This also automatically adds a legend on the side of the plot. The blue color represents the proportion of each bin represented by male students and the red - by female students.</p>
<p>An important thing to note is that the aesthetic mapping created by the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function can be defined <em>globally</em> i.e. for the entire ggplot figure, as in the case above (<code>ggplot(Salaries, aes(x = salary))</code>), as well as a <em>locally</em>, i.e. only for one specific geom (<code>geom_histogram(aes(x = salary)</code>). In the former case, the entire figure will use the set aesthetic mapping, while in the latter, it will apply only to the specific geom.</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>, binwidth <span class="op">=</span> <span class="fl">5000</span>,color <span class="op">=</span> <span class="st">'black'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-300-1.png" width="672"></div>
<p>Note that that in this case, both global and local mappings produce exactly the same output. However, when adding multiple geom structures to one plot, as we will see later, using a global vs local aesthetic mapping can lead to very different results.</p>
</div>
<div id="all-about-geoms---plot-types-in-ggplot2" class="section level3 unnumbered">
<h3>All about geoms - plot types in ggplot2<a class="anchor" aria-label="anchor" href="#all-about-geoms---plot-types-in-ggplot2"><i class="fas fa-link"></i></a>
</h3>
<p>In this section, we will explore some of the basic plot types (or <em>geoms</em>) offered by the <code>ggplot2</code> package. The number of geoms available is vast, and this isn’t by any means an exhaustive discussion of the topic - you can find the full list in the ggplot2 <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">cheatsheet</a>. Even more can be found through external, ggplot-based packages. However, learning the basics of just couple of them should help you gain a sufficient understanding of ggplot’s plotting philosophy to be able to explore the rest by yourself and use them whenever you need to.</p>
<div id="density-estimate" class="section level4 unnumbered">
<h4>Density estimate<a class="anchor" aria-label="anchor" href="#density-estimate"><i class="fas fa-link"></i></a>
</h4>
<p>The density estimate is an alternative way to draw a histogram of the data. It represents the distribution of a continous variable by drawing a line. You can see that the shape of the density plot of <code>absences</code> below directly corresponds with the histogram of this variable from the previous example.</p>
<div class="sourceCode" id="cb549"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-301-1.png" width="672"></div>
<p>Kernel density estimates are particularly useful to compare the distribution of a variable between different values of a grouping variable. For example, we can examine the difference in the distributions of the salary depending on the position held by the individual:</p>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span>, fill <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-302-1.png" width="672"></div>
<p>The differences are clear-cut - it appears that as expected, higher position held generally leads to higher median of earnings. However, each position also has higher variability in income, with the spread of Professors earnings more than twice as large as for Assistant Professors.</p>
</div>
<div id="barplots" class="section level4 unnumbered">
<h4>Barplots<a class="anchor" aria-label="anchor" href="#barplots"><i class="fas fa-link"></i></a>
</h4>
<p>Histograms and kernel density estimates are useful in representing continuous variables, such as temperature, GDP or hours of absence. In case of discrete variables, which only take a finite and unordered set of values, it’s often better to use bar plots. With <code>ggplot2</code>, these can be easily obtained using <code>geom_bar</code>. For example, we can use it to represent the of academic ranks within our dataset.</p>
<div class="sourceCode" id="cb551"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">'forestgreen'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-303-1.png" width="672"></div>
<p>You may also want to make the bar plots horizontal. There are two ways to to this: the old approach is simply to add <code><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip()</a></code> to your <code>ggplot</code> object. You may still encounter this way of plotting horizontal bar plots in other users code.</p>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">'forestgreen'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-304-1.png" width="672"></div>
<p>However, since <code>ggplot</code> version 3.3.0, providing the y axis instead of x axis leads to the same result. Furthermore, it doesn’t cause unnecessary confusion caused by flipping the axis (for example, the y-axis label needs to be specified as the x-axis label when <code><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip()</a></code> is applied). Thus it is recommended to use the second approach, provided that you have the most up-to-date version of <code>tidyverse</code> installed.</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">'forestgreen'</span><span class="op">)</span></span></code></pre></div>
<p>Again, we can also fill the bars with another variable, simply by specifying the <code>fill</code> argument in the aesthetic mapping definition:</p>
<div class="sourceCode" id="cb554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-306-1.png" width="672"></div>
<p>The bars can also be placed side-by-side to improve comparison. To do that, we simply specify a named argument <code>position</code> to the <code>geom_bar</code> function and set it to <code>'dodge'</code>, as seen in the example below. This means, that one bar should ‘dodge’ another, and be placed next to it. The default value of the <code>position</code> argument is <code>'stacked'</code>, which is pretty self-explanatory and can be seen in the previous example.</p>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span>, fill <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">'dodge'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-307-1.png" width="672"></div>
<p>We can also use barplots to present summary statistics visually - for example, the average salary of a professor given his or her rank. To do that, we first construct a summary data frame, using tools covered in the previous chapter, and then plot the result.</p>
<div class="sourceCode" id="cb556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salary_by_rank</span> <span class="op">&lt;-</span> <span class="va">Salaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">rank</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg_salary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">salary_by_rank</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span>, y <span class="op">=</span> <span class="va">avg_salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">'identity'</span>, width <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">'firebrick'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-308-1.png" width="672"></div>
<p>Note that in this case we need to specify both x and y aesthetics, as x represents the name of the group (in this case the professors’ rank) and y - the associated value, indicated by the height of each bar. Moreover, we need to setthe <code>stat</code> argument of <code>geom_bar</code> to <code>identity</code>. This is because the default setting, <code>stat = count</code> implies that ggplot takes only one, discrete variable as arguments and counts the number of observations in each of the group defined by the levels of the variable - an operation very similar to the output of <code>table(math$health)</code>. We can also use <code>geom_col</code>, which is a short-hand for <code>geom_bar(stat = 'identity')</code> and produces the same output:</p>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">salary_by_rank</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rank</span>, y <span class="op">=</span> <span class="va">avg_salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_col</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span>, fill <span class="op">=</span> <span class="st">'firebrick'</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-309-1.png" width="672"></div>
</div>
<div id="boxplots" class="section level4 unnumbered">
<h4>Boxplots<a class="anchor" aria-label="anchor" href="#boxplots"><i class="fas fa-link"></i></a>
</h4>
<p>Another way to compare a variable across groups is through the use of boxplots. Boxplots were described in the chapter on <a href="exploratory.html#exploratory">exploratory data analysis</a> as a way of evaluating the distribution of a continuous variable. They are also implemented in the <code>ggplot2</code> package and can be used for comparisons of the continuous variables distributions across multiple groups defined by a discrete variable. This can be done by specifying the grouping variable to the x aesthetic and the continuous variable which we want to examine to the y aesthetic.</p>
<div class="sourceCode" id="cb558"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-310-1.png" width="672"></div>
<p>We can see that while the medians of Male and Female professor’s wages in our sample are similar, the interquantile range is much higher for men. At the same time, the distribution of male wages is more spread out, as indicated by larger box, longer tails. It also includes some outliers.</p>
<p>We can also draw an arbitrary summary statistic - such as the mean - on the plot, by using the <code>stat_summary</code> function - we specify the statistic we want to use with the <code>fun</code> keyword argument and the geom using the <code>geom</code> argument. In this case, we add a cross to indicate the mean salary for both sexes on the plot:</p>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span>, geom <span class="op">=</span> <span class="st">"point"</span>, </span>
<span>               shape <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-311-1.png" width="672"></div>
</div>
<div id="violin-plots" class="section level4 unnumbered">
<h4>Violin plots<a class="anchor" aria-label="anchor" href="#violin-plots"><i class="fas fa-link"></i></a>
</h4>
<p>Violin plots are closely related to box plots, however they depict the shape of the variables’ distribution. As such, they overcome the issue related to the use of boxplots decribed in the <a href="exploratory.html#exploratory">exploratory analysis chapter</a> - namely that two distributions can have identical box plots, yet very different underlying shapes. The violin plots avoid it by connecting boxplots with kernel density estimates, giving a better approximation of the shape of a variable’s distribution.</p>
<div class="sourceCode" id="cb560"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sex</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-312-1.png" width="672"></div>
<p>We can see the strength of that by coming back to the misleading example from the previous chapter. Suppose we have the</p>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-313-1.png" width="672"></div>
<p>The boxplots look very alike:</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">category</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-314-1.png" width="672"></div>
<p>However, the violin plot give away the entire story - namely the fact that the first category has two peaks (i.e. comes from a bimodal distribution, using the proper statistical terms), and it is unlikely that we observe the median value. A good example of such distributions from the political realm are the self-identification on the left-right ideological scale, with majority of respondents reporting to be either slightly conservative or slightly liberal.</p>
<div class="sourceCode" id="cb562"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">category</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_violin.html">geom_violin</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-315-1.png" width="672"></div>
</div>
<div id="scatter-plots-1" class="section level4 unnumbered">
<h4>Scatter plots<a class="anchor" aria-label="anchor" href="#scatter-plots-1"><i class="fas fa-link"></i></a>
</h4>
<p>So far we have described multiple ways of visually representing a continous variable, as well as the relationship between a continous variable and some discrete grouping variables. Under many circumstances, we are interested in examining the relationship between two continuous variables. One of the most commonly employed data visualization techniques for problems like this are scatter plots, which simply describe each observation as a point marked on a two-dimensional graph, with x axis representing one variable and y axis - the other. This can be seen in the example below, in which we look at the relationship between the professor’s experience approximated by years since attaining PhD and his or her salary.</p>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-316-1.png" width="672"></div>
<p>It is clear that we can see a some sort of relationship between the experience and earnings. In other words, there’s a degree of positive correlation between these two variables (we will examine this term more in depth in in the <a href="association.html#association">next chapter</a>), i.e. professors with more experience tend to earn more on average. However, with experience the relationship becomes more noisy, as there’s more variation in earnings of the more experienced academics. As in the previous cases, we can specify additional aesthetics such as color or shape:</p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, </span>
<span>                     color <span class="op">=</span> <span class="va">rank</span>, shape <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-317-1.png" width="672"></div>
</div>
<div id="line-of-best-fit" class="section level4 unnumbered">
<h4>Line of best fit<a class="anchor" aria-label="anchor" href="#line-of-best-fit"><i class="fas fa-link"></i></a>
</h4>
<p>We can also add a line of best fit to our plot, by using the <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> geom, with the <code>method</code> argument specified to <code>'lm'</code>. The line of best fit is simply the line that is closest to each of the points in the plot on average. The <code>'lm'</code> methods stands for linear model - a method used for fitting such a line, described in more detail in the next part, in chapter on <a href="ols.html#ols">linear regression</a>.</p>
<div class="sourceCode" id="cb565"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-318-1.png" width="672"></div>
<p>Here, you should be able to fully understand the difference between local and global aesthetic mappings mentioned <a href="visualization.html#the-plotting-syntax">earlier in the chapter</a>. Notice the difference between providing the aesthetic mapping at the global level (i.e. to the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function call)…:</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-319-1.png" width="672"></div>
<p>… and just to the <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>.</p>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-320-1.png" width="672"></div>
<p>In the former case, the <code>color = sex</code> argument is used by both <code>geom_point</code> and <code><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line()</a></code>, which leads to <em>3 lines of different colors being fitted for each of the groups separately</em>. When the <code>color</code> aesthetic mapping is only provided to the <code>geom_point</code> at the local level, one line is fitted to the data, as specified by the global mapping. Both of these approaches may be useful, depending on our research question. The comparison of these two plots further reveals an interesting behaviour in our data: when all the observations are considered toegether, there seems to be a positive relationship between years since PhD and salary. However when we look at the group level, the relationship appears to disappear - this behaviour is known as the <a href="#https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s Paradox</a>. In this case, it’s primarily the result of the relationship between the rank and years since PhD - professors with higher ranks have more experience. When the variation in the salaries within those groups is considered, the experience measured in years seems to hardly explain any of the variation in earnings.</p>
</div>
<div id="line-connecting-points" class="section level4 unnumbered">
<h4>Line connecting points<a class="anchor" aria-label="anchor" href="#line-connecting-points"><i class="fas fa-link"></i></a>
</h4>
<p>In some cases, we might want to connect points in our figure with a line to depict some sort of trend in the mean of a variable depending on a categorical group that has a natural ordering - for example, suppose we want to visually examining differences in the average earnings of professors in our dataset depending on their years in service.</p>
<p>First we can obtain the average for each group using <code>group_by</code> and <code>summarise</code>.</p>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">byage</span> <span class="op">&lt;-</span> <span class="va">Salaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yrs_range <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_width</a></span><span class="op">(</span><span class="va">yrs.since.phd</span>, <span class="fl">5</span>, boundary <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">yrs_range</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can then plot the averages using <code>geom_point</code>:</p>
<div class="sourceCode" id="cb572"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">byage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs_range</span>, y <span class="op">=</span> <span class="va">avg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-322-1.png" width="672"></div>
<p>While there seems to be some sort of trend in the data (even though the further points divert from it, which is likely the result of small sample size in a given group leading to rather unreliable sample estimates), the plot does not emphasize it enough. To make it more meanigful, we can add a line connecting the points with <code>geom_line</code>. Note that we have to set the <code>group</code> aesthetic to 1, which provides <code>ggplot</code> a hint on how to connect the point.</p>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">byage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs_range</span>, y <span class="op">=</span> <span class="va">avg</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-323-1.png" width="672"></div>
<p>We can extend the following example by comparing the same trend depending on the paid classes taken:</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">byage</span> <span class="op">&lt;-</span> <span class="va">Salaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yrs_range <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_width</a></span><span class="op">(</span><span class="va">yrs.since.phd</span>, <span class="fl">5</span>, boundary <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">yrs_range</span>, <span class="va">discipline</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>`summarise()` has grouped output by 'yrs_range'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">byage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs_range</span>, y <span class="op">=</span> <span class="va">avg</span>, color <span class="op">=</span> <span class="va">discipline</span>, </span>
<span>                  lty <span class="op">=</span> <span class="va">discipline</span>, group <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-324-1.png" width="672"></div>
</div>
</div>
<div id="multiple-plots" class="section level3 unnumbered">
<h3>Multiple plots<a class="anchor" aria-label="anchor" href="#multiple-plots"><i class="fas fa-link"></i></a>
</h3>
<p><code>ggplot2</code> also makes it possible to put multiple plots in one figure - this is indeed very useful under many circumstances, and many data visualization professionals consider it a good practice, as it follows the rule of <em>small multiples</em>, making the data more digestible to the reader and avoiding informational overload in one plot. Arranging plots into a figure can be done in two ways - based on a value of a categorical variable (‘faceting’) and by arbitrarily putting plots into a rectangular grid.</p>
<div id="faceting" class="section level4 unnumbered">
<h4>Faceting<a class="anchor" aria-label="anchor" href="#faceting"><i class="fas fa-link"></i></a>
</h4>
<p>Faceting refers to simply splitting the data by the value of a categorical variable, similarily to the way <code>group_by</code> treats the data when performing regular manipulation. The syntax is relatively simple: we simply add another layer to our plot called <code>facet_wrap</code> and specify the faceting variable following the <em>tilde</em> symbol <code>~</code> - this is a commonly used notation in R, indicating some sort of dependence of one variable on another - you will encounter it in the next two chapters.</p>
<div class="sourceCode" id="cb577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">yrs.since.phd</span>, <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rank</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-325-1.png" width="672"></div>
<p>As a result we can see the scatter plots and lines of best fit in three separate plots, each one with an appropriate heading indicating the group of the observations. However, the output is difficult to read, due to the fact that the x-axis in the plot is fixed to the same length for each of the plots - this improves comparability of the figures, but limits its clarity. This can be changed by specifying an additional argument to the <code>facet_wrap</code> layer:</p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">yrs.since.phd</span>, <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">rank</span>, scales <span class="op">=</span> <span class="st">'free_x'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-326-1.png" width="672"></div>
<p>Again, we can see that the relationship seen in the overall dataset disappears within each of the groups.</p>
<p>We can also facet using more than one variable and arrange the figures into a grid via a two dimensional grouping. For example, suppose we want to evaluate the distribution of the experience wihtin each combination of rank and discipline of the individuals. This can be achieved by using the <code>facet_grid</code> layer.</p>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">discipline</span> <span class="op">~</span> <span class="va">rank</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-327-1.png" width="672"></div>
<p>In here, we can see that professors in theoretical disciplines seem to have worked longer on average, however the range of the values is comparable in both cases. There also appears to be more Assistant Professors and Associate Professors in the applied departments, with no siginificant differences in gender. Similar analysis applied to earnings, however, reveals that the earnings seem to be higher at each level in the applied departments.</p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">discipline</span> <span class="op">~</span> <span class="va">rank</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-328-1.png" width="672"></div>
</div>
<div id="plotting-in-a-grid" class="section level4 unnumbered">
<h4>Plotting in a grid<a class="anchor" aria-label="anchor" href="#plotting-in-a-grid"><i class="fas fa-link"></i></a>
</h4>
<p>Sometimes, we want to make our figure arrangement more customized, not necessarily arranged in accordance with our variable. For example, we may want to depict a consince summary of the most important of our findings in one 2x2 plot. To do this, we can use the <code>plot_grid</code> function from the <code>cowplot</code> package (which, as always, needs to be installed first).</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/">cowplot</a></span><span class="op">)</span></span></code></pre></div>
<p>To do arrange the plots in an arbitrary rectangular grid, we first need to create each of our plots as a separate <code>ggplot</code> object. To avoid repetition, however, it’s best to first create a basic object and then add new layers to it and save it under separate names.</p>
<div class="sourceCode" id="cb586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">discipline</span>, color <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt_hist_s</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">plt_hist_y</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">plt_bar</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt_sct</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">plt_sct</span>, <span class="va">plt_hist_s</span>, <span class="va">plt_hist_y</span>, <span class="va">plt_bar</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-330-1.png" width="672"></div>
</div>
</div>
<div id="customizing-plots" class="section level3 unnumbered">
<h3>Customizing plots<a class="anchor" aria-label="anchor" href="#customizing-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Note that in a lot of the cases above, the plots were far from publication quality - while they allowed to get an overview of the data, they kept the original variable names on the axes and had issues with axis tick labels overlapping, amongst other things. All those issues can be fixed with ggplot’s customization capabilities.</p>
<p>For startets, let’s consider one of the scatter plots we created earlier:</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-331-1.png" width="672"></div>
<p>It would be useful to make the variable names more formal on the plot. This can be done using the <code>labs</code> layer, used to specify labels:</p>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add axes labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Salary in USD'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-332-1.png" width="672"></div>
<p>Title of the plot can also be specified using the <code>ggtitle</code> function:</p>
<div class="sourceCode" id="cb592"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add axes labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Salary in USD'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co">#add title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Salaries of US college professors'</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-333-1.png" width="672"></div>
<p>Furthremore, we can customize the legend labels as well. Ths is done using the <code>scale_color_discrete</code> layer, which applies manual changes to the <code>color</code> aesthetic we specified when initializing the ggplot object.</p>
<div class="sourceCode" id="cb594"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add axes labels:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Salary in USD'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Salaries of US college professors'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#rename legend elements:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Rank'</span>, </span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Asst. Prof.'</span>, </span>
<span>                                  <span class="st">'Assoc. Prof.'</span>,</span>
<span>                                  <span class="st">'Prof'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-334-1.png" width="672"></div>
<p>We can also customize the legend using the <code>theme</code> layer. This layer is used for customization of majority of plot elements, such as the legend, text and the axes.</p>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span>, color <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add axes labels:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Salary in USD'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#add title</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">'Salaries of US college professors'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#rename legend elements:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Rank'</span>, </span>
<span>                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'Asst. Prof.'</span>,<span class="st">'Assoc. Prof.'</span>,<span class="st">'Prof'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#customize the plot:</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span>, <span class="co">#move legend to the bottom</span></span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">'lightblue'</span><span class="op">)</span>, <span class="co">#legend background</span></span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span>, face <span class="op">=</span> <span class="st">'italic'</span><span class="op">)</span>, <span class="co">#legend font</span></span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co">#remove title</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-335-1.png" width="672"></div>
<p>As seen above, the keyword arguments of <code>theme</code> usually take two forms - a string, such as <code>legend.position = 'bottom'</code>, or <code>element_*</code> theme elements. You can read more about them in <code><a href="https://ggplot2.tidyverse.org/reference/element.html">?element_blank</a></code>, however the basic logic is as follows - you use <code><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text()</a></code> to specify <em>text characteristics</em> - such as the font, size, color or face of the <em>text elements of the plot</em>, such as legend labels or axis ticks, <code>element_rect</code> to specify the characteristics of <em>rectangle elements</em>, such as backgrounds and <code>element_blank</code> to make a given elements disappear from the plot entirely.</p>
<p>In some cases our axis labels are two long, which can be problematic especially in the x axis, as it results in overlaps and makes impossible to read them. A common solution is to rotate the labels by a certain angle. This can be done using the <code>axis.text.x</code> argument with <code>element_text(rotation = n)</code>, where <code>n</code> are the magnitude of counter-clockwise rotation. The vertical and horizontal justification can he adjusted using the <code>vjust</code> and <code>hjust</code> arguments respectively.</p>
<div class="sourceCode" id="cb598"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">byage</span> <span class="op">&lt;-</span> <span class="va">Salaries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>yrs_range <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/cut_interval.html">cut_width</a></span><span class="op">(</span><span class="va">yrs.since.phd</span>, <span class="fl">5</span>, boundary <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">yrs_range</span>, <span class="va">discipline</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>`summarise()` has grouped output by 'yrs_range'. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">byage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs_range</span>, y <span class="op">=</span> <span class="va">avg</span>, color <span class="op">=</span> <span class="va">discipline</span>, </span>
<span>                  lty <span class="op">=</span> <span class="va">discipline</span>, group <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Average earnings'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.9</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-336-1.png" width="672"></div>
<p>Finally, we can make changes to the overall plot by applying themes to the entire plot. Some of them are built into the <code>ggplot</code> package; more come with <code>cowplot</code> or <code>ggpubr</code>. You can find couple examples below, but feel free to explore them online.</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">byage</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs_range</span>, y <span class="op">=</span> <span class="va">avg</span>, color <span class="op">=</span> <span class="va">discipline</span>, </span>
<span>                  lty <span class="op">=</span> <span class="va">discipline</span>, group <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Years since PhD'</span>, y <span class="op">=</span> <span class="st">'Average earnings'</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb602"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-338-1.png" width="672"></div>
<div class="sourceCode" id="cb603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-339-1.png" width="672"></div>
<div class="sourceCode" id="cb604"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-340-1.png" width="672"></div>
<div class="sourceCode" id="cb605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-341-1.png" width="672"></div>
<div class="sourceCode" id="cb606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-342-1.png" width="672"></div>
<p><strong>Note</strong> that the <code>theme</code> adjustments must be specified after a specific theme is specified, or otherwise if overrides them. You can also specify a theme upfront for your entire script by using <code><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set()</a></code>.</p>
<div class="sourceCode" id="cb607"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_grey</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, vjust <span class="op">=</span> <span class="fl">0.8</span>, hjust <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-343-1.png" width="672"></div>
</div>
<div id="saving-plots" class="section level3 unnumbered">
<h3>Saving plots<a class="anchor" aria-label="anchor" href="#saving-plots"><i class="fas fa-link"></i></a>
</h3>
<p>Saving plots can be done using the <code>ggsave</code> function:</p>
<div class="sourceCode" id="cb608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span>plot <span class="op">=</span> <span class="va">plt</span>, filename <span class="op">=</span> <span class="st">'files/test.png'</span>, width <span class="op">=</span> <span class="fl">150</span>, height <span class="op">=</span> <span class="fl">100</span>, units <span class="op">=</span> <span class="st">'mm'</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="summary-5" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Summary<a class="anchor" aria-label="anchor" href="#summary-5"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p><strong>ggplot</strong> is a part of the <code>tidyverse</code> collection and the most popular plotting package in R</p></li>
<li><p>you initialize a ggplot object using the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function, with the data frame you are planning to visualize as the first argument and the aesthetic mapping created by the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function as the second argument.</p></li>
<li><p><strong>aesthetic mappings</strong> are created by the <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> function, which defines connections between graphical elements of the plot and the variables from our data frame. The elements that can be mapped include the x and y axes, color, fill, shape or line type. The mapping can be created <em>globally</em>, provided to the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> function and <em>locally</em>, by passing <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> to specific geoms.</p></li>
<li><p><strong>geoms</strong> are constituent elements of ggplot objects. They are different graphical structures, such as histograms, boxplots or scatter plots that can be added to an initialized ggplot object using the addition operator <code>+</code>. Each geom uses the aesthetic mapping specified globally, unless specified otherwise locally.</p></li>
<li><p><code>facet_wrap</code> and <code>facet_grid</code> functions can be used to split plots into small multiples. This is done using the <code>~</code> tilde operator - for example, <code>facet_grid(sex ~ rank)</code> will split our figure into a rectangular grid of plots of all combinations of <code>sex</code> and <code>rank</code> variables.</p></li>
<li><p>we can customize elements of our plot, such as axes labels using the <code><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs()</a></code> command, legend names, using the <code>scale_*</code> functions, as well as other elements through the <code><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme()</a></code> layer, which most of the time works with <code>element_*</code> functions as arguments</p></li>
<li><p>we can further apply pre-defined changes to our plots by using themes, such as <code>theme_bw</code> or <code>theme_minimal</code>. These can also be set for the entire session using <code><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set()</a></code>.</p></li>
<li><p>plots can be saved via the <code>ggsave</code> function.</p></li>
</ul>
<div id="functions-list-5" class="section level3 unnumbered">
<h3>Functions list<a class="anchor" aria-label="anchor" href="#functions-list-5"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="13%">
<col width="26%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th align="left">function</th>
<th align="left">package</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">glimpse()</td>
<td align="left">c(“dplyr”, “package:tibble”)</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">tibble()</td>
<td align="left">c(“dplyr”, “package:tidyr”, “package:tibble”)</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">c()</td>
<td align="left">base</td>
<td align="left">Combine values/vectors into a vector</td>
</tr>
<tr class="even">
<td align="left">length()</td>
<td align="left">base</td>
<td align="left">get number of elements in a vector or list</td>
</tr>
<tr class="odd">
<td align="left">library()</td>
<td align="left">base</td>
<td align="left">load an R package</td>
</tr>
<tr class="even">
<td align="left">mean()</td>
<td align="left">base</td>
<td align="left">get mean of a vector</td>
</tr>
<tr class="odd">
<td align="left">rep()</td>
<td align="left">base</td>
<td align="left">repeat a value or a vector N times</td>
</tr>
<tr class="even">
<td align="left">plot_grid()</td>
<td align="left">cowplot</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">theme_cowplot()</td>
<td align="left">cowplot</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">group_by()</td>
<td align="left">dplyr</td>
<td align="left">group tibble/data.frame by a factor variable. All further tidyverse operations are performed group-wise</td>
</tr>
<tr class="odd">
<td align="left">mutate()</td>
<td align="left">dplyr</td>
<td align="left">modify/create a column in a data frame</td>
</tr>
<tr class="even">
<td align="left">summarise()</td>
<td align="left">dplyr</td>
<td align="left">collapse the dataset to a summary statistic. Usually used with group_by()</td>
</tr>
<tr class="odd">
<td align="left">ungroup()</td>
<td align="left">dplyr</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">aes()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">coord_flip()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">cut_width()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">element_blank()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">element_rect()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">element_text()</td>
<td align="left">ggplot2</td>
<td align="left">Customise text in GGPLOT2</td>
</tr>
<tr class="even">
<td align="left">facet_grid()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">facet_wrap()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">geom_bar()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">geom_boxplot()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">geom_col()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">geom_density()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">geom_histogram()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">geom_line()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">geom_point()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">geom_smooth()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">geom_violin()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ggplot()</td>
<td align="left">ggplot2</td>
<td align="left">Create a ggplot graph</td>
</tr>
<tr class="even">
<td align="left">ggsave()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">ggtitle()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">labs()</td>
<td align="left">ggplot2</td>
<td align="left">Customise labels in GGPLOT2</td>
</tr>
<tr class="odd">
<td align="left">labs()</td>
<td align="left">ggplot2</td>
<td align="left">Add a vertical line in GGPLOT2</td>
</tr>
<tr class="even">
<td align="left">scale_color_discrete()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">stat_summary()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">theme()</td>
<td align="left">ggplot2</td>
<td align="left">Set theme for GGPLOT2</td>
</tr>
<tr class="odd">
<td align="left">theme_bw()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">theme_classic()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">theme_grey()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">theme_minimal()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">theme_set()</td>
<td align="left">ggplot2</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">rgnorm()</td>
<td align="left">gnorm</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">rnorm()</td>
<td align="left">stats</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">data()</td>
<td align="left">utils</td>
<td align="left">NA</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="exercises-5" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-5"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Consider the plot we have created earlier through the plot_grid function from the cowplot package. Use your knowledge about plot customization to make it more readable, for example by:</li>
</ol>
<ul>
<li>keeping only one legend for the fill variable</li>
<li>rotating the axis tick labels if necessary</li>
<li>changing the axes labels</li>
<li>making the points in the scatter plot smaller</li>
<li>adding a theme</li>
</ul>
<p>Save the final figure to a png file.</p>
<p>You can find the initial code below:</p>
<div class="sourceCode" id="cb609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">Salaries</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">discipline</span>, color <span class="op">=</span> <span class="va">discipline</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt_hist_s</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">salary</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">plt_hist_y</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">plt_bar</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">rank</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plt_sct</span> <span class="op">&lt;-</span> <span class="va">plt</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">yrs.since.phd</span>, y <span class="op">=</span> <span class="va">salary</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">'lm'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">plt_sct</span>, <span class="va">plt_hist_s</span>, <span class="va">plt_hist_y</span>, <span class="va">plt_bar</span><span class="op">)</span></span></code></pre></div>
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
<div class="inline-figure"><img src="main_files/figure-html/unnamed-chunk-346-1.png" width="672"></div>
<p>For the remainder of next exericses, you will need to load the <code>gapminder</code> dataset which is a part of the <code>gapminder</code> package.</p>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">gapminder</span>, package <span class="op">=</span> <span class="st">'gapminder'</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Get an overview of the dataset. How many variables an observations are there? How many unique values does each variable have?</p></li>
<li><p>Visualize the relationship between the per capita gdp and life expectancy in 2007 using a scatter plot. Include <em>one</em> line of best fit and color the markers by continent. Make sure the plot has appropriate axis labels. Does the line offer a good fit to the line? What kind of curve would better? Why?</p></li>
<li><p>Examine the countries which appear to divert from the overall trend in the plot you created in the previous exercise.</p></li>
<li><p>Visualize the difference in GDP per capita distribution between continents (in 2007). Use at least two different methods and compare their advantages and disadvantages. Remember about appropriate labels and title!</p></li>
<li><p>Compare the GDP per capita of each continent in each year using a connected scatter plot. Be careful - taking the group average of each continent is incorrect, as the population sizes differ. You can try presenting the values on a log scale using <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10()</a></code> to make the lines more visible.</p></li>
<li><p>Prepare the same plot, but this time visualizing the average GDP growth rate for each of the continents. HINT: use the <code>groupby()</code> %&gt;% <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> routine with the <code><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag()</a></code> function as in the previous chapter.</p></li>
</ol>
<p><em>The solutions for the exercises will be available here on 2021-01-07.</em></p>
<button class="btn btn-default" onclick="
    async function downloadFile(event) {
      event.preventDefault();
      try {
        const response = await fetch('data:text/plain;base64,IycgIyMgRXhlcmNpc2VzCiMnIAojJyAKIycgMS4gQ29uc2lkZXIgdGhlIHBsb3Qgd2UgaGF2ZSBjcmVhdGVkIGVhcmxpZXIgdGhyb3VnaCB0aGUgcGxvdF9ncmlkIGZ1bmN0aW9uIGZyb20gdGhlIGNvd3Bsb3QgcGFja2FnZS4gVXNlIHlvdXIga25vd2xlZGdlIGFib3V0IHBsb3QgY3VzdG9taXphdGlvbiB0byBtYWtlIGl0IG1vcmUgcmVhZGFibGUsIGZvciBleGFtcGxlIGJ5OgojJyAKIycgLSBrZWVwaW5nIG9ubHkgb25lIGxlZ2VuZCBmb3IgdGhlIGZpbGwgdmFyaWFibGUKIycgLSByb3RhdGluZyB0aGUgYXhpcyB0aWNrIGxhYmVscyBpZiBuZWNlc3NhcnkKIycgLSBjaGFuZ2luZyB0aGUgYXhlcyBsYWJlbHMKIycgLSBtYWtpbmcgdGhlIHBvaW50cyBpbiB0aGUgc2NhdHRlciBwbG90IHNtYWxsZXIKIycgLSBhZGRpbmcgYSB0aGVtZQojJyAKIycgU2F2ZSB0aGUgZmluYWwgZmlndXJlIHRvIGEgcG5nIGZpbGUuCiMnIAojJyBZb3UgY2FuIGZpbmQgdGhlIGluaXRpYWwgY29kZSBiZWxvdzoKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpwbHQgPC0gZ2dwbG90KFNhbGFyaWVzLCBhZXMoZmlsbCA9IGRpc2NpcGxpbmUsIGNvbG9yID0gZGlzY2lwbGluZSkpCnBsdF9oaXN0X3MgPC0gcGx0ICsgZ2VvbV9kZW5zaXR5KGFlcyh4ID0gc2FsYXJ5KSwgYWxwaGEgPSAwLjMpCnBsdF9oaXN0X3kgPC0gcGx0ICsgZ2VvbV9kZW5zaXR5KGFlcyh4ID0geXJzLnNpbmNlLnBoZCksIGFscGhhID0gMC4zKQpwbHRfYmFyIDwtIHBsdCArIGdlb21fYmFyKGFlcyh5ID0gcmFuaykpCnBsdF9zY3QgPC0gcGx0ICsgZ2VvbV9wb2ludChhZXMoeCA9IHlycy5zaW5jZS5waGQsIHkgPSBzYWxhcnkpKSArCiAgZ2VvbV9zbW9vdGgoYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5KSwgbWV0aG9kID0gJ2xtJykKcGxvdF9ncmlkKHBsdF9zY3QsIHBsdF9oaXN0X3MsIHBsdF9oaXN0X3ksIHBsdF9iYXIpCgojJyAKIycgCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KI0FOU1dFUgp0aGVtZV9zZXQodGhlbWVfYncoKSkKcGx0IDwtIGdncGxvdChTYWxhcmllcywgYWVzKGZpbGwgPSBkaXNjaXBsaW5lLCBjb2xvciA9IGRpc2NpcGxpbmUpKSArCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gJ25vbmUnKQoKCnBsdF9oaXN0X3MgPC0gcGx0ICsgZ2VvbV9kZW5zaXR5KGFlcyh4ID0gc2FsYXJ5KSwgYWxwaGEgPSAwLjMpICsKICB4bGFiKCdTYWxhcnkgaW4gVVNEJykKCnBsdF9oaXN0X3kgPC0gcGx0ICsgZ2VvbV9kZW5zaXR5KGFlcyh4ID0geXJzLnNpbmNlLnBoZCksIGFscGhhID0gMC4zKSArCiAgeGxhYignWWVhcnMgc2luY2UgUGhEJykKCnBsdF9iYXIgPC0gcGx0ICsgZ2VvbV9iYXIoYWVzKHkgPSByYW5rKSkgKwogIHhsYWIoTlVMTCkgKyAKICBzY2FsZV95X2Rpc2NyZXRlKGxhYmVscyA9IGMoJ1Byb2YuJywgJ0Fzc29jLiBQcm9mJywgJ0Fzc3QuIFByb2YnKSkgKyAKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAnYm90dG9tJykKCgpwbHRfc2N0IDwtIHBsdCArIGdlb21fcG9pbnQoYWVzKHggPSB5cnMuc2luY2UucGhkLCB5ID0gc2FsYXJ5KSwgc2l6ZSA9IDAuNykgKwogIGdlb21fc21vb3RoKGFlcyh4ID0geXJzLnNpbmNlLnBoZCwgeSA9IHNhbGFyeSksIG1ldGhvZCA9ICdsbScpICsKICBsYWJzKHggPSAnWWVhcnMgc2luY2UgUGhEJywgeSA9ICdTYWxhcnkgaW4gVVNEJykKCgpmaW5hbCA8LSBwbG90X2dyaWQocGx0X3NjdCwgcGx0X2hpc3RfcywgcGx0X2hpc3RfeSwgcGx0X2JhcikKZmluYWwKZ2dzYXZlKHBsb3QgPSBmaW5hbCwgZmlsZSA9ICdmaWxlcy9ncmlkLnBuZycpCgojJyAKIycgCiMnIEZvciB0aGUgcmVtYWluZGVyIG9mIG5leHQgZXhlcmljc2VzLCB5b3Ugd2lsbCBuZWVkIHRvIGxvYWQgdGhlIGBnYXBtaW5kZXJgIGRhdGFzZXQgd2hpY2ggaXMgYSBwYXJ0IG9mIHRoZSBgZ2FwbWluZGVyYCBwYWNrYWdlLgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmRhdGEoZ2FwbWluZGVyLCBwYWNrYWdlID0gJ2dhcG1pbmRlcicpCgojJyAKIycgCiMnIDIuIEdldCBhbiBvdmVydmlldyBvZiB0aGUgZGF0YXNldC4gSG93IG1hbnkgdmFyaWFibGVzIGFuIG9ic2VydmF0aW9ucyBhcmUgdGhlcmU/IEhvdyBtYW55IHVuaXF1ZSB2YWx1ZXMgZG9lcyBlYWNoIHZhcmlhYmxlIGhhdmU/CiMnIAojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdsaW1wc2UoZ2FwbWluZGVyKQojQU5TV0VSCnNhcHBseShnYXBtaW5kZXIsIGZ1bmN0aW9uKHgpIGxlbmd0aCh1bmlxdWUoeCkpKQoKIyBvciB1c2luZyB2YXBwbHkKdmFwcGx5KGdhcG1pbmRlciwgZnVuY3Rpb24oeCkgbGVuZ3RoKHVuaXF1ZSh4KSksIGludGVnZXIoMSkpCgojIG9yIGluIHRpZHl2ZXJzZSBzdHlsZQptYXBfaW50KGdhcG1pbmRlciwgbl9kaXN0aW5jdCkKCiMnIAojJyAzLiBWaXN1YWxpemUgdGhlIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoZSBwZXIgY2FwaXRhIGdkcCBhbmQgbGlmZSBleHBlY3RhbmN5IGluIDIwMDcgdXNpbmcgYSBzY2F0dGVyIHBsb3QuIEluY2x1ZGUgX29uZV8gbGluZSBvZiBiZXN0IGZpdCBhbmQgY29sb3IgdGhlIG1hcmtlcnMgYnkgY29udGluZW50LiBNYWtlIHN1cmUgdGhlIHBsb3QgaGFzIGFwcHJvcHJpYXRlIGF4aXMgbGFiZWxzLiBEb2VzIHRoZSBsaW5lIG9mZmVyIGEgZ29vZCBmaXQgdG8gdGhlIGxpbmU/IFdoYXQga2luZCBvZiBjdXJ2ZSB3b3VsZCBiZXR0ZXI/IFdoeT8gCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KI0FOU1dFUgpnYXAyMDA3IDwtIGdhcG1pbmRlciAlPiUgZmlsdGVyKHllYXIgPT0gMjAwNykKCmdncGxvdChnYXAyMDA3LCBhZXMoeCA9IGdkcFBlcmNhcCwgeSA9IGxpZmVFeHApKSArIAogIGdlb21fcG9pbnQoYWVzKGNvbG9yID0gY29udGluZW50KSkgKyAKICBnZW9tX3Ntb290aChtZXRob2QgPSAnbG0nKSArCiAgbGFicyh4ID0gIkdEUCBwZXIgY2FwaXRhIiwgeSA9ICJMaWZlIGV4cGVjdGFuY3kgYXQgYmlydGgiKSArCiAgZ2d0aXRsZSgiR2xvYmFsIGRldmVsb3BtZW50IGluIDIwMDciKQoKIycgCiMnIDQuIEV4YW1pbmUgdGhlIGNvdW50cmllcyB3aGljaCBhcHBlYXIgdG8gZGl2ZXJ0IGZyb20gdGhlIG92ZXJhbGwgdHJlbmQgaW4gdGhlIHBsb3QgeW91IGNyZWF0ZWQgaW4gdGhlIHByZXZpb3VzIGV4ZXJjaXNlLgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCiNBTlNXRVIKZ2FwMjAwNyAlPiUgZmlsdGVyKGdkcFBlcmNhcCA+IDUwMDAsIGxpZmVFeHAgPCA2MCkKCiMnIAojJyA1LiBWaXN1YWxpemUgdGhlIGRpZmZlcmVuY2UgaW4gR0RQIHBlciBjYXBpdGEgZGlzdHJpYnV0aW9uIGJldHdlZW4gY29udGluZW50cyAoaW4gMjAwNykuIFVzZSBhdCBsZWFzdCB0d28gZGlmZmVyZW50IG1ldGhvZHMgYW5kIGNvbXBhcmUgdGhlaXIgYWR2YW50YWdlcyBhbmQgZGlzYWR2YW50YWdlcy4gUmVtZW1iZXIgYWJvdXQgYXBwcm9wcmlhdGUgbGFiZWxzIGFuZCB0aXRsZSEKIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojQU5TV0VSCmdncGxvdChnYXAyMDA3LCBhZXMoeCA9IGNvbnRpbmVudCwgeSA9IGdkcFBlcmNhcCkpICsgCiAgZ2VvbV9ib3hwbG90KCkgKyAKICBsYWJzKHggPSAnR0RQIHBlciBjYXBpdGEnLCB5ID0gJ0NvbnRpbmVudCcpICsgCiAgZ2d0aXRsZSgnRGlmZmVyZW5jZXMgaW4gR0RQJykKCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2dwbG90KGdhcDIwMDcsIGFlcyh4ID0gY29udGluZW50LCB5ID0gZ2RwUGVyY2FwKSkgKyAKICBnZW9tX3Zpb2xpbigpICsgCiAgbGFicyh4ID0gJ0dEUCBwZXIgY2FwaXRhJywgeSA9ICdDb250aW5lbnQnKSArIAogIGdndGl0bGUoJ0RpZmZlcmVuY2VzIGluIEdEUCcpCgojJyAKIyMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCmdncGxvdChnYXAyMDA3LCBhZXMoeCA9IGdkcFBlcmNhcCwgZmlsbCA9IGNvbnRpbmVudCkpICsgCiAgZ2VvbV9kZW5zaXR5KGFscGhhID0gMC4zKSArIAogIGxhYnMoeCA9ICdHRFAgcGVyIGNhcGl0YScsIHkgPSAnQ29udGluZW50JykKCiMnIAojIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KZ2FwMjAwNyAlPiUKICAjY29udmVydCB0byBVU0QgMTAwMCB0byBtYWtlIHNjYWxlIG1vcmUgcmVhZGFibGUKICBtdXRhdGUoZ2RwUGVyY2FwXzEwMDAgPSBnZHBQZXJjYXAvMTAwMCkgJT4lIAogIGdncGxvdChhZXMoeCA9IGdkcFBlcmNhcF8xMDAwKSkgKyAKICAgIGdlb21faGlzdG9ncmFtKCkgKyAKICAgIGZhY2V0X3dyYXAofmNvbnRpbmVudCkgKyAKICAgIGxhYnMoeCA9ICdHRFAgcGVyIGNhcGl0YSBpbiAxMDAwJCcpICsKICAgIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIGhqdXN0ID0gMC44KSkKCiMnIAojJyAKIycgNi4gQ29tcGFyZSB0aGUgR0RQIHBlciBjYXBpdGEgb2YgZWFjaCBjb250aW5lbnQgaW4gZWFjaCB5ZWFyIHVzaW5nIGEgY29ubmVjdGVkIHNjYXR0ZXIgcGxvdC4gQmUgY2FyZWZ1bCAtIHRha2luZyB0aGUgZ3JvdXAgYXZlcmFnZSBvZiBlYWNoIGNvbnRpbmVudCBpcyBpbmNvcnJlY3QsIGFzIHRoZSBwb3B1bGF0aW9uIHNpemVzIGRpZmZlci4gWW91IGNhbiB0cnkgcHJlc2VudGluZyB0aGUgdmFsdWVzIG9uIGEgbG9nIHNjYWxlIHVzaW5nIGBzY2FsZV95X2xvZzEwKClgIHRvIG1ha2UgdGhlIGxpbmVzIG1vcmUgdmlzaWJsZS4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQpnYXBtaW5kZXIgJT4lCiAgZ3JvdXBfYnkoY29udGluZW50LCB5ZWFyKSAlPiUKICBzdW1tYXJpc2UoZ2RwX3BjID0gc3VtKHBvcCAqIGdkcFBlcmNhcCkvc3VtKHBvcCkpICU+JQogIGdncGxvdChhZXMoeCA9IHllYXIsIHkgPSBnZHBfcGMsIGNvbG9yID0gY29udGluZW50KSkgKyAKICBnZW9tX3BvaW50KCkgKyAKICBnZW9tX2xpbmUoKSArCiAgc2NhbGVfeV9sb2cxMCgpICsKICB4bGFiKCdZZWFyJykgKyAKICB5bGFiKCdBdmVyYWdlIEdEUCBwZXIgY2FwaXRhJykKCiMnIAojJyA3LiBQcmVwYXJlIHRoZSBzYW1lIHBsb3QsIGJ1dCB0aGlzIHRpbWUgdmlzdWFsaXppbmcgdGhlIGF2ZXJhZ2UgR0RQIGdyb3d0aCByYXRlIGZvciBlYWNoIG9mIHRoZSBjb250aW5lbnRzLiBISU5UOiB1c2UgdGhlIGBncm91cGJ5KClgICU+JSBgbXV0YXRlKClgIHJvdXRpbmUgd2l0aCB0aGUgYGxhZygpYCBmdW5jdGlvbiBhcyBpbiB0aGUgcHJldmlvdXMgY2hhcHRlci4KIycgCiMjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQojQU5TV0VSCmdyb3d0aHMgPC0gZ2FwbWluZGVyICU+JQogIG11dGF0ZShnZHAgPSBnZHBQZXJjYXAgKiBwb3ApICU+JQogIGdyb3VwX2J5KGNvdW50cnkpICU+JQogIG11dGF0ZShnZHBfZ3IgPSAoZ2RwIC0gbGFnKGdkcCkpL2xhZyhnZHApKSAlPiUKICBncm91cF9ieSh5ZWFyLCBjb250aW5lbnQpICU+JQogIHN1bW1hcmlzZShnZHBfZ3IgPSBtZWFuKGdkcF9nciwgbmEucm0gPSBUUlVFKSkKCmdncGxvdChncm93dGhzLCBhZXMoeCA9IHllYXIsIHkgPSBnZHBfZ3IsIAogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gY29udGluZW50LCBncm91cCA9IGNvbnRpbmVudCkpKwogIGdlb21fcG9pbnQoKSArIAogIGdlb21fbGluZSgpICsKICBsYWJzKHggPSAnWWVhcicsIHkgPSAnQXZlcmFnZSBHRFAgZ3Jvd3RoIHJhdGUnKQoKIycgCiMnIAojJyAqVGhlIHNvbHV0aW9ucyBmb3IgdGhlIGV4ZXJjaXNlcyB3aWxsIGJlIGF2YWlsYWJsZSBoZXJlIG9uIGByIGNvbmZpZyRkYXRhX3Zpc3VhbGl6YXRpb25gLioKIycgCiMnIAoA');
        if (!response.ok) throw new Error('Network response failed');
        const blob = await response.blob();
        const blobUrl = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = '07-data_visualization-solutions.R';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.dispatchEvent(new MouseEvent('click'));
        document.body.removeChild(a);
        setTimeout(() =&gt; {
          window.URL.revokeObjectURL(blobUrl);
        }, 100);
        return false;
      } catch (error) {
        console.error('Download failed:', error);
        alert('Download failed. Please try again.');
      }
    }
    downloadFile(event);
  "><i class="fa fa-save"></i> Chapter solutions</button>

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="dplyr.html"><span class="header-section-number">6</span> Data Manipulation</a></div>
<div class="next"><a href="association.html"><span class="header-section-number">8</span> Statistical Inference and Association</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#visualization"><span class="header-section-number">7</span> Data Visualization</a></li>
<li>
<a class="nav-link" href="#content-5"><span class="header-section-number">7.1</span> Content</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-plotting-syntax">The plotting syntax</a></li>
<li><a class="nav-link" href="#all-about-geoms---plot-types-in-ggplot2">All about geoms - plot types in ggplot2</a></li>
<li><a class="nav-link" href="#multiple-plots">Multiple plots</a></li>
<li><a class="nav-link" href="#customizing-plots">Customizing plots</a></li>
<li><a class="nav-link" href="#saving-plots">Saving plots</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#summary-5"><span class="header-section-number">7.2</span> Summary</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#functions-list-5">Functions list</a></li></ul>
</li>
<li><a class="nav-link" href="#exercises-5"><span class="header-section-number">7.3</span> Exercises</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong><p><img src="images/Crest_white.png" width="75" style="display:block; margin:auto; margin-bottom:3em;"> Analysing Quantitative Data with R <br></p></strong>" was written by </p>
<p><strong>Dr Flo Reiche &amp; Piotr Bogdański</strong> <br><strong>Department of Politics and International Studies</strong> <br><strong>University of Warwick</strong></p>. It was last built on 23 August, 2025.
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
